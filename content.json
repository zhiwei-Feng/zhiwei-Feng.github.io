{"pages":[{"title":"about","text":"About MeWelcome! 1234// something about meLanguages := []string{&quot;Go&quot;, &quot;Python(pytorch)&quot;, &quot;Java&quot;, &quot;Rust(newbee)&quot;}Interests := []string{&quot;microservices&quot;, &quot;distributed system&quot;} Email := &quot;zhiwei.feng1995@gmail.com&quot;","link":"/about/index.html"},{"title":"interview","text":"ç‚¹æˆ‘","link":"/interview/index.html"},{"title":"å‹æƒ…é“¾æ¥","text":"","link":"/link/index.html"},{"title":"å‹æƒ…é“¾æ¥","text":"","link":"/links/index.html"},{"title":"tags","text":"","link":"/tags/index.html"},{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"Use gRPC with SpringBoot","text":"gRPCç›¸æ¯”äºREST HTTPè¯·æ±‚åœ¨æ¥å£è§„èŒƒã€ä¼ è¾“æ€§èƒ½å’Œæµå¼é€šä¿¡æ–¹é¢æ›´å¥½,å› æ­¤å¹¿æ³›åº”ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡çš„é€šä¿¡è¿‡ç¨‹ä¸­. æœ¬æ–‡ä¸»è¦æ˜¯é’ˆå¯¹ç›®å‰gRPC-Javaå’ŒSpringBootçš„å…¥é—¨çº§æ•™ç¨‹ä¸å¤Ÿç»Ÿä¸€è€Œå†™,ä¹Ÿæ˜¯ä½¿ç”¨è¿‡ç¨‹çš„è®°å½•.æ„Ÿè°¢grpc-spring-boot-starteræä¾›äº†å¼€ç®±å³ç”¨çš„gRPCæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ¥å£å®ç°,å› æ­¤æˆ‘ä»¬å¯ä»¥ä¸“æ³¨ä¸šåŠ¡å®ç°. é¡¹ç›®ç®€è¿°è¯¥Demoä¸»è¦å®ç°ä¸€ä¸ªgRPCæœåŠ¡ç«¯å’Œä¸€ä¸ªgRPCå®¢æˆ·ç«¯,æœåŠ¡ç«¯æä¾›ä¸€ä¸ªapiæ¥æ”¶è¯·æ±‚å‚æ•°name,è¿”å›æ¶ˆæ¯Hello ==&gt; &lt;name&gt;. æœ¬é¡¹ç›®åŸºäºmavenæ„å»ºçš„å¤šmoduleå·¥ç¨‹å®ç°. é¢„å¤‡ä¸ºäº†é¿å…å‡ºç°ç‰ˆæœ¬å…¼å®¹é—®é¢˜,æˆ‘ä»¬åœ¨parent pomæ–‡ä»¶ä¸­å®šä¹‰å¥½springbootã€javaã€grpcå’Œå¯¹åº”grpc-spring-boot-starterç‰ˆæœ¬,å¦‚ä¸‹: 1234567891011&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.8&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt;&lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;grpc.version&gt;1.42.2&lt;/grpc.version&gt; &lt;grpc.starter.version&gt;2.13.1.RELEASE&lt;/grpc.starter.version&gt;&lt;/properties&gt; grpc interface1. protoæ–‡ä»¶å®šä¹‰æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå­moduleä¸ºgrpc, ä½œä¸ºå…¬ç”¨protoæ–‡ä»¶å’Œå¯¹åº”protobufç”Ÿæˆçš„æ–‡ä»¶çš„å­˜æ”¾å¤„(åç»­çš„gRPC serverå’Œclienté¡¹ç›®éƒ½ä»¥æ­¤moduleä½œä¸ºä¾èµ–),å…¶ä¸­protoæ–‡ä»¶æ”¾åœ¨src/main/protoç›®å½•ä¸‹.è¿›è¡Œç›¸å…³å®šä¹‰. 1234567891011121314151617181920212223syntax = &quot;proto3&quot;;package service;option java_multiple_files = true;option java_package = &quot;com.fengzw.minimall.minimalluser.service&quot;;option java_outer_classname = &quot;HelloWorldProto&quot;;// The greeting service definition.service MyService { // Sends a greeting rpc SayHello (HelloRequest) returns (HelloReply) {}}// The request message containing the user's name.message HelloRequest { string name = 1;}// The response message containing the greetingsmessage HelloReply { string message = 1;} 2. mavené…ç½®åŒæ—¶åœ¨moduleçš„pomæ–‡ä»¶ä¸­é…ç½®å¥½mavenæ’ä»¶å’Œç›¸å…³ä¾èµ–,å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;!-- necessary for Java 9+ --&gt; &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt; &lt;artifactId&gt;annotations-api&lt;/artifactId&gt; &lt;version&gt;6.0.53&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;build&gt; &lt;extensions&gt; &lt;extension&gt; &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt; &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.6.2&lt;/version&gt; &lt;/extension&gt; &lt;/extensions&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt; &lt;version&gt;0.6.1&lt;/version&gt; &lt;configuration&gt; &lt;protocArtifact&gt;com.google.protobuf:protoc:3.19.2:exe:${os.detected.classifier}&lt;/protocArtifact&gt; &lt;pluginId&gt;grpc-java&lt;/pluginId&gt; &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:1.45.1:exe:${os.detected.classifier}&lt;/pluginArtifact&gt; &lt;protoSourceRoot&gt;src/main/proto&lt;/protoSourceRoot&gt; &lt;outputDirectory&gt;src/main/java&lt;/outputDirectory&gt; &lt;clearOutputDirectory&gt;false&lt;/clearOutputDirectory&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;goal&gt;compile-custom&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; é€šè¿‡ç¼–è¯‘è¯¥moduleå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„gRPCæ–‡ä»¶åˆ°src/main/javaçš„ç›®å½•ä¸‹. æœåŠ¡ç«¯module1. mavené…ç½®æ–°å»ºä¸€ä¸ªmoduleä½œä¸ºgRPCæœåŠ¡ç«¯,é…ç½®å¥½å¯¹åº”çš„pomæ–‡ä»¶:(åŒ…æ‹¬grpc moduleå’Œserver-starterä¾èµ–) 12345678910&lt;dependency&gt; &lt;groupId&gt;com.fengzw.minimall&lt;/groupId&gt; &lt;artifactId&gt;grpc&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;net.devh&lt;/groupId&gt; &lt;artifactId&gt;grpc-server-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${grpc.starter.version}&lt;/version&gt;&lt;/dependency&gt; 2. å®šä¹‰æœåŠ¡serviceæ„å»ºä¸€ä¸ªserviceæä¾›gRPC serveræœåŠ¡,å¦‚ä¸‹: 12345678910111213141516@GrpcServicepublic class GrpcServerService extends MyServiceGrpc.MyServiceImplBase { @Override public void sayHello(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) { System.out.println(&quot;Hello ==&gt; &quot; + request.getName()); HelloReply reply = HelloReply.newBuilder().setMessage(&quot;Hello ==&gt; &quot; + request.getName()).build(); responseObserver.onNext(reply); responseObserver.onCompleted(); } @Override public void sayHelloAgain(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) { super.sayHelloAgain(request, responseObserver); }} å¦‚æœä½ é¡ºåˆ©ç¼–è¯‘äº†grpc module,é‚£ä¹ˆMyServiceGrpcæ–‡ä»¶å’Œç›¸åº”çš„modelæ–‡ä»¶ä¼šå‡ºç°åœ¨grpcçš„src/main/javaç›®å½•ä¸‹. å¯åŠ¨è¯¥module,ä½ ä¼šåœ¨SpringBootçš„å¯åŠ¨æ—¥å¿—è§åˆ°å¦‚ä¸‹ä¿¡æ¯: 12342022-05-29 20:47:18.223 INFO 16841 --- [ restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory : Registered gRPC service: service.MyService, bean: grpcServerService, class: com.fengzw.minimall.minimalluser.service.GrpcServerService2022-05-29 20:47:18.223 INFO 16841 --- [ restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory : Registered gRPC service: grpc.health.v1.Health, bean: grpcHealthService, class: io.grpc.protobuf.services.HealthServiceImpl2022-05-29 20:47:18.223 INFO 16841 --- [ restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory : Registered gRPC service: grpc.reflection.v1alpha.ServerReflection, bean: protoReflectionService, class: io.grpc.protobuf.services.ProtoReflectionService2022-05-29 20:47:18.281 INFO 16841 --- [ restartedMain] n.d.b.g.s.s.GrpcServerLifecycle : gRPC Server started, listening on address: *, port: 9091 æ­¤æ—¶é€šè¿‡ideaçš„http requestä½ å¯ä»¥è°ƒç”¨grpcè¯·æ±‚æ¥æµ‹è¯•è¯¥grpc serviceçš„çŠ¶æ€. 12345GRPC localhost:9090/service.MyService/SayHello{ &quot;name&quot;: &quot;request&quot;} ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º. 123{ &quot;message&quot;: &quot;Hello \\u003d\\u003d\\u003e request&quot;} è¿™æ ·æˆ‘ä»¬çš„æœåŠ¡ç«¯å°±å®ç°å¥½äº†. å®¢æˆ·ç«¯module1. mavené…ç½®æ–°å»ºä¸€ä¸ªmoduleä½œä¸ºgrpc å®¢æˆ·ç«¯, å¦‚æœåŠ¡ç«¯ä¸€æ ·, æˆ‘ä»¬åŒæ ·éœ€è¦åœ¨maven pomæ–‡ä»¶ä¸­ä¾èµ–grpc module, å¹¶ä¾èµ–client-starterä¾èµ–å¦‚ä¸‹: 12345678910&lt;dependency&gt; &lt;groupId&gt;com.fengzw.minimall&lt;/groupId&gt; &lt;artifactId&gt;gprc&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;net.devh&lt;/groupId&gt; &lt;artifactId&gt;grpc-client-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${grpc.starter.version}&lt;/version&gt;&lt;/dependency&gt; 2. springbooté…ç½®æ–‡ä»¶ä¸­é…ç½®grpc serverä¿¡æ¯é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶application.propertiesä¸­å®šä¹‰å¥½grpc serverçš„ç›¸å…³ä¿¡æ¯: 1234grpc.client.user-server.address=static://127.0.0.1:9091grpc.client.user-server.enable-keep-alive=truegrpc.client.user-server.keep-alive-without-calls=truegrpc.client.user-server.negotiation-type=plaintext WARNING: æ³¨æ„å¦‚æœæ˜¯åŒä¸€å°æœåŠ¡å™¨æ¥è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµ‹è¯•, é‚£ä¹ˆæœåŠ¡ç«¯éœ€è¦è®¾ç½®grpc serverçš„ç«¯å£åœ¨é™¤äº†9090ä¹‹å¤–çš„ç«¯å£, å¦åˆ™ä¼šå¼•èµ·è°ƒç”¨æ—¶æŠ¥é”™INTERNAL: http2 exceptionCaused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 485454502f 3. å®šä¹‰å®¢æˆ·ç«¯æ–¹æ³•ç„¶åæˆ‘ä»¬åœ¨ä¸€ä¸ªspring serviceç»„ä»¶ä¸‹å®šä¹‰æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ–¹æ³•,å¦‚ä¸‹: 12345678910@Servicepublic class DemoService { @GrpcClient(&quot;user-server&quot;) private MyServiceGrpc.MyServiceBlockingStub myServiceStub; public String hello(String name) { HelloRequest request = HelloRequest.newBuilder().setName(name).build(); return myServiceStub.sayHello(request).getMessage(); }} è¿™é‡Œ@GrpcClientä¸­çš„valueè¡¨ç¤ºgrpc serverçš„åç§°, åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œäº†å®šä¹‰. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªcontrolleræ¥å¯¹å¤–æç©ºä¸€ä¸ªrest apiæ¥è¿›è¡Œgrpcå®¢æˆ·ç«¯è°ƒç”¨, å¦‚ä¸‹: 1234567@Autowiredprivate DemoService service;@GetMapping(&quot;/hello&quot;)public String hello() { return service.hello(&quot;demo&quot;);} è¿™æ ·å®¢æˆ·ç«¯å°±å…¨éƒ¨é…ç½®å®Œæˆäº†. æ€»ç»“å¯ä»¥çœ‹åˆ°ç›¸æ¯”äºGoè¯­è¨€ä¸­å¯¹gRPCçš„ä½¿ç”¨, grpc-spring-boot-starteræå¤§åœ°ç®€åŒ–äº†éä¸šåŠ¡ç›¸å…³çš„ä»£ç .","link":"/2022/05/29/Use-gRPC-with-SpringBoot/"},{"title":"[6.824ç³»åˆ—] Outline of lab1 solution","text":"æœ¬æ–‡ä¸»è¦æ€»ç»“äº†å¦‚ä½•å®ç°6.824 lab1çš„å¤§çº², æ–¹ä¾¿è‡ªå·±å’Œè¯»è€…èƒ½å¤Ÿè¿…é€Ÿç†è§£MapReduceå…·ä½“è¦å®ç°äº›ä»€ä¹ˆ. æ¦‚è§ˆé¦–å…ˆæ•´ä¸ªMapReduceçš„è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸‹å›¾, åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: Mapå’ŒReduceé˜¶æ®µ.ä»è¿™ä¸ªå›¾ä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºMapReduceæ•´ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ å°†ä»»åŠ¡çš„è¾“å…¥æ–‡ä»¶æ‹†åˆ†å¤šä¸ªsplitæ–‡ä»¶ åˆ›å»ºå¤šä¸ªMapä»»åŠ¡, æ¯ä¸ªä»»åŠ¡å¯¹åº”è¾“å…¥è‹¥å¹²ä¸ªsplit åœ¨å¤šä¸ªworkeræœåŠ¡å™¨ä¸Šæ‰§è¡ŒMapä»»åŠ¡, å¹¶å°†è¾“å‡ºå†™å…¥åˆ°Intermediate filesä¸­ å½“æ‰€æœ‰Mapå®Œæˆå, MapReduceè¿›å…¥Reduceé˜¶æ®µ, ä¸ºå¤šä¸ªworkeræœåŠ¡å™¨åˆ†é…Reduceä»»åŠ¡ æ¯ä¸ªReduceä»»åŠ¡è¯»å–å¯¹åº”çš„Intermediate fileså®ŒæˆReduceä»»åŠ¡, å¹¶å°†è¾“å‡ºå†™å…¥å¯¹åº”çš„output files é—®é¢˜Q1: ä»€ä¹ˆæ—¶å€™ç”±è°æ¥å¯¹ä»»åŠ¡è¾“å…¥æ–‡ä»¶è¿›è¡Œsplit? å¦‚ä½•split? A: ç”±Masteråœ¨MapReduceä»»åŠ¡åˆå§‹åŒ–çš„è¿‡ç¨‹å®Œæˆ, splitçš„ç›®çš„æ˜¯ä¸ºäº†å°†ä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡ç»™åˆ°å¤šä¸ªworkeræœºå™¨è¿è¡Œ, å®ç°å¹¶å‘åŠ é€Ÿ, å› æ­¤splitæ–‡ä»¶çš„æ•°é‡åº”è¯¥ç­‰åŒäºworkeræœºå™¨æ•°é‡æ¥è®¾ç½®. åŒæ—¶splitåº”è¯¥æŒ‰ç…§é¢„è®¾å¥½çš„æ–‡ä»¶çš„å¤§å°æ¥è¿›è¡Œåˆ’åˆ†(æ¯”å¦‚ä¸€ä¸ªsplitæ–‡ä»¶ä¸º1KBå¤§å°). Q2: Mapæ˜¯ä»€ä¹ˆ? A: æ¥æ”¶ä¸€ä¸ªkey/valueçš„pair, äº§ç”Ÿä¸€ç³»åˆ—çš„key/valueä¸­é—´ç»“æœçš„è¿‡ç¨‹å°±æ˜¯Map, æ¯”å¦‚è¯´ä¸‹é¢æ˜¯ä¸€ä¸ªwordcountçš„mapä¾‹&gt; å­ 12345map(String key, String value): // key: document name // value: document contents for each word w in value: EmitIntermediate(w, &quot;1&quot;); Q3: Reduceæ€ä¹ˆçŸ¥é“è‡ªå·±å¯¹åº”çš„æ˜¯å“ªäº›Intermediate files? A: æˆ‘ä»¬æŠŠå¯¹Mapäº§ç”Ÿçš„æ¯ä¸€ä¸ªkey/value, å¯¹keyè¿›è¡Œhashååˆ†é…åˆ°ä¸€ä¸ªReduceä»»åŠ¡, å…·ä½“æ¥è¯´: ç»™å®šä¸€ä¸ªMapä»»åŠ¡Xä»¥åŠäº§ç”Ÿçš„key/value pair Reduce Y = hash(key) % nReduce write to â€œmr-X-Yâ€ fileå› æ­¤, å¯¹äºç»™å®šçš„Reduceä»»åŠ¡Y, å®ƒå»è¯»å–æ‰€æœ‰çš„mr-?-Yæ–‡ä»¶ä½œä¸ºè¾“å…¥. Q4: å¦‚ä½•å¤„ç†Mapä»»åŠ¡æˆ–è€…Reduceä»»åŠ¡æ‰§è¡Œè¶…æ—¶æˆ–å¤±è´¥çš„é—®é¢˜ A: åˆ©ç”¨è¶…æ—¶æœºåˆ¶å’ŒMasterè¢«åŠ¨åˆ†é…ä»»åŠ¡æ¥å®ç°è¶…æ—¶é‡è¯•, å¯¹æ¯ä¸€ä¸ªä»»åŠ¡éƒ½è®°å½•å…¶å¼€å§‹çš„æ—¶é—´, å½“workerè¯·æ±‚åˆ†é…ä»»åŠ¡çš„æ—¶å€™, éå†æ‰€æœ‰çš„ä»»åŠ¡åˆ¤æ–­æ˜¯å¦è¶…æ—¶, å¦‚æœè¶…æ—¶åˆ™æ˜¯ä¸€ä¸ªå¯ä»¥è¢«åˆ†é…çš„ä»»åŠ¡. å®ç°å¤§çº²å¤§çº²å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: Masterå’ŒWorker 1. Workerå¯¹äºæ¯ä¸€ä¸ªWorker, å®ƒçš„æ‰§è¡Œè¿‡ç¨‹éƒ½å¯ä»¥æ¦‚æ‹¬ä¸º:æ— é™å¾ªç¯è¯·æ±‚ä»»åŠ¡åˆ†é…å¹¶æ‰§è¡Œç›´è‡³MapReduceå…¨éƒ¨ä»»åŠ¡å®Œæˆ. è¿‡ç¨‹å¦‚ä¸‹: å‘Masterç”³è¯·åˆ†é…ä»»åŠ¡(ç”±Masterå†³å®šåˆ†é…Mapè¿˜æ˜¯Reduceä»»åŠ¡) å¦‚æœMasterè¿”å›MapReduceå·²ç»å…¨éƒ¨å®Œæˆåˆ™é€€å‡ºå¾ªç¯ æ ¹æ®è¿”å›çš„ä»»åŠ¡ç±»å‹(Map or Reduce)æ‰§è¡Œå¯¹åº”çš„å¤„ç†è¿‡ç¨‹ é‡å¤ä¸Šè¿° 1.1 Mapå¤„ç†Mapçš„è¾“å…¥: taskId(ä»»åŠ¡ID), nReduce(é¢„è®¾çš„Reduceä¸ªæ•°), fileName(è¾“å…¥æ–‡ä»¶çš„è®¿é—®è·¯å¾„) è¿™é‡Œéœ€è¦æ³¨æ„fileNameçš„å®šä¹‰, åœ¨è¿™ä¸ªä½œä¸šå½“ä¸­, æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ–‡ä»¶åä½œä¸ºfileName, è¿™æ˜¯å› ä¸ºç¨‹åºè·‘åœ¨å•æœºç¯å¢ƒä¸‹, é€šè¿‡å¤šä¸ªè¿›ç¨‹çš„å½¢å¼æ¨¡æ‹Ÿåˆ†å¸ƒå¼ç¯å¢ƒ, å› æ­¤é»˜è®¤æƒ…å†µä¸‹ç›¸å…³æ–‡ä»¶éƒ½å­˜æ”¾åœ¨ä¸»ç¨‹åºçš„å½“å‰ç›®å½•ä¸‹, å› æ­¤å¯ä»¥é€šè¿‡æ–‡ä»¶åå³å¯ä»¥è®¿é—®åˆ°, ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒ, æˆ‘ä»¬å¾€å¾€ä¼šä¾æ‰˜ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ¥å­˜æ”¾è¿™äº›æ–‡ä»¶(æ¯”å¦‚GFS), å› æ­¤æ­¤æ—¶fileNameåº”è¯¥æ˜¯ä¸€ä¸ªæ–‡ä»¶è®¿é—®URL, å¯ä»¥é€šè¿‡URLå»åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¯»å–åˆ°å¯¹åº”æ–‡ä»¶. Mapçš„è¿‡ç¨‹ è¯»å–æ–‡ä»¶å†…å®¹å¹¶ç»mapå‡½æ•°å¤„ç†å¾—åˆ°å¯¹åº”kvå¯¹é›†åˆkva åˆ›å»ºnReduceä¸ªä¸´æ—¶æ–‡ä»¶ å°†kvaæŒ‰ç…§key hashå€¼å†™å…¥åˆ°å¯¹åº”ä¸´æ—¶æ–‡ä»¶ é‡å‘½åä¸´æ—¶æ–‡ä»¶ä¸ºmr-X-Y, Xä¸ºtaskId(mapId), Yä¸ºreduceId. é€šçŸ¥Master, è¯¥ä»»åŠ¡å®Œæˆ è¿™é‡Œé‡‡ç”¨çº¦å®šå¤§äºé…ç½®æ€æƒ³, å› æ­¤ä¸éœ€è¦é€šçŸ¥Masterè¯¥ä»»åŠ¡è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶å, ä½†æ˜¯å¦‚æœæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è¯éœ€è¦ç»™å‡ºç³»ç»Ÿæ¥å£è¿”å›çš„æ–‡ä»¶URLç»™Master. 1.2 Reduceå¤„ç†è¿‡ç¨‹å’ŒMapå¤„ç†ç±»ä¼¼Reduceçš„è¾“å…¥: taskId, intermediateFileNames(ä¸­é—´æ–‡ä»¶è®¿é—®è·¯å¾„çš„é›†åˆ) Reduceçš„è¿‡ç¨‹ éå†è¯»å–ä¸­é—´æ–‡ä»¶, å¹¶ä¿å­˜åˆ°ä¸€ä¸ªå†…å­˜çš„åˆ—è¡¨ä¸­ æŒ‰ç…§keyæ¥æ’åºåˆ—è¡¨ å°†åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªkeyå’Œå¯¹åº”çš„valueé›†åˆäº¤ç»™reduceå‡½æ•°å¤„ç† ç»“æœå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶å¹¶é‡å‘½å é€šçŸ¥Masterä»»åŠ¡å®Œæˆ 2. MasterMasterä½œä¸ºMapReduceçš„åè°ƒè€…, éœ€è¦å¯¹æ‰€æœ‰Mapã€Reduceä»»åŠ¡çš„çŠ¶æ€è¿›è¡Œç®¡ç†, åŒæ—¶åœ¨å¯¹åº”çš„çŠ¶æ€ä¸‹è¿›è¡Œä»»åŠ¡åˆ†é…. æ€»çš„æ¥è¯´éœ€è¦å…·å¤‡ä»¥ä¸‹åŠŸèƒ½: ä»»åŠ¡åˆå§‹åŒ– ä»»åŠ¡åˆ†é… ä»»åŠ¡å®Œæˆå¤„ç† 2.1 ä»»åŠ¡åˆå§‹åŒ–è¿™ä¸€è¿‡ç¨‹å®é™…ä¸Šä¹Ÿæ˜¯Masterçš„åˆå§‹åŒ–è¿‡ç¨‹. è¿™ä¸€è¿‡ç¨‹, Masteréœ€è¦è®¾å®šå¥½éœ€è¦å¤šå°‘ä¸ªReduceå’ŒMap, åŒæ—¶å¯¹ç›¸åº”çš„Mapå’ŒReduceä»»åŠ¡è¿›è¡Œåˆå§‹åŒ–, åŒæ—¶è¿›å…¥æ•´ä¸ªMapReduceè¿›å…¥MappingçŠ¶æ€. 2.2 ä»»åŠ¡åˆ†é…è¿™ä¸ªè¿‡ç¨‹æ ¸å¿ƒåœ¨äºåˆ¤æ–­å½“å‰MapReduce(Master)å¤„äºä»€ä¹ˆçŠ¶æ€ä»è€Œåˆ†é…ç›¸åº”çš„ä»»åŠ¡: å¦‚æœå¤„äºMappingçŠ¶æ€, éå†MapTasksåˆ—è¡¨åˆ¤æ–­æ¯ä¸€ä¸ªä»»åŠ¡æ˜¯å¦å¯ä»¥è¢«åˆ†é… åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦è¶…æ—¶, å¦‚æœè¶…æ—¶åˆ™éœ€è¦å°†å…¶çŠ¶æ€ä¿®æ”¹ä¸ºå¯è¢«åˆ†é… å¦‚æœå¤„äºReducingçŠ¶æ€, éå†ReduceTasksåˆ—è¡¨è¿›è¡Œç±»ä¼¼çš„åˆ†é… å¦‚æœå¤„äºDoneçŠ¶æ€, åˆ™è¿”å›ExitçŠ¶æ€ç ç»™workerå‘ŠçŸ¥æ•´ä¸ªMapReduceå·²ç»ç»“æŸ 2.3 ä»»åŠ¡å®Œæˆå¤„ç† ç»™å®šå®Œæˆçš„ä»»åŠ¡ID: taskId æ ¹æ®é˜¶æ®µMapping/Reducingæ‰¾åˆ°å¯¹åº”çš„Task ä¿®æ”¹Taskçš„çŠ¶æ€ä¸ºFinished å¦‚æœè¯¥é˜¶æ®µæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»å®Œæˆ,åˆ™æ¨è¿›Masterçš„çŠ¶æ€åˆ°ä¸‹ä¸€é˜¶æ®µ","link":"/2022/04/10/outline-of-6-824-lab1-solution/"},{"title":"sliceä½¿ç”¨appendçš„å°å‘","text":"ä»Šå¤©åœ¨åˆ·ä¸€é“ç®—æ³•é¢˜çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå…³äºsliceåœ¨ä½¿ç”¨appendçš„å°ç»†èŠ‚é—®é¢˜ã€‚è¿™ä¸ªç®—æ³•é¢˜å¯ä»¥å‚è€ƒè·¯å¾„æ€»å’ŒIIã€‚é¢˜æ„å¾ˆç®€å•ï¼Œå°±æ˜¯ä»ä¸€ä¸ªäºŒå‰æ ‘ä¸­æ‰€æœ‰ç”±æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æ»¡è¶³è·¯å¾„å’Œç­‰äºtargetçš„è·¯å¾„ã€‚ é—®é¢˜åœ¨å‚è€ƒå®˜æ–¹é¢˜è§£çš„golangç‰ˆæœ¬çš„æ—¶å€™ï¼Œå‘ç°äº†æœ‰ä¸€æ®µä»£ç æ˜¯æˆ‘ä¸€å¼€å§‹æ²¡å¼„æ˜ç™½çš„ã€‚å®Œæ•´ä»£ç å¯å‚è€ƒ 1234567891011121314151617181920func pathSum(root *TreeNode, targetSum int) (ans [][]int) { path := []int{} var dfs func(*TreeNode, int) dfs = func(root *TreeNode, left int) { if root == nil { return } left -= root.Val path = append(path, root.Val) defer func() { path = path[:len(path)-1] }() if left == 0 &amp;&amp; root.Left == nil &amp;&amp; root.Right == nil { ans = append(ans, append([]int{}, path...)) return } dfs(root.Left, left) dfs(root.Right, left) } dfs(root, targetSum) return} å…¶ä¸­çš„ans = append(ans, append([]int{}, path...))åˆ™æ˜¯æˆ‘å…³æ³¨çš„åœ°æ–¹ï¼Œä¸€å¼€å§‹æˆ‘ç–‘æƒ‘ä¸ºä»€ä¹ˆä¸ç›´æ¥ans = append(ans, path))ï¼Œä½†æ˜¯å®éªŒè¯æ˜ç»“æœä¼šéå¸¸å¥‡æ€ªï¼Œæ¯”å¦‚å¯¹äºè¿™æ ·ä¸€ä¸ªä¾‹å­æˆ‘ä»¬æƒ³è¦çš„æ˜¯[[5,4,11,2],[5,8,4,5]]ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯[[5,8,4,1],[5,8,4,1]]. è§£æè¿™é‡Œå…¶å®æ˜¯æˆ‘å¿˜äº†golangä¸­çš„sliceåº•å±‚å®ç°å¦‚ä¸‹å›¾æ‰€ç¤º 12345type slice struct { array unsafe.Pointer len int cap int} å› æ­¤å¦‚æœåƒans = append(ans, path))è¿™æ ·åšï¼Œå…¶å®åœ¨anså­˜æ”¾çš„æ˜¯pathè¿™ä¸ªsliceï¼Œåœ¨åç»­ä»£ç è¿è¡Œä¸­çš„æ”¹å˜ä¼šå¯¼è‡´ansçš„ç»“æœæ”¹å˜ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªé”™è¯¯çš„ç»“æœã€‚è€Œans = append(ans, append([]int{}, path...))åˆ™æ˜¯åœ¨ansä¸­å­˜æ”¾äº†ä¸€ä¸ªpathçš„å‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬ä¸ä¼šè¢«å…¶ä»–ä»£ç ä¿®æ”¹åˆ°ã€‚å› æ­¤ç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚ ä¸€è¡Œä»£ç å°±æ­ç¤ºgolangä¸­sliceçš„æœ¬è´¨~ï¼ŒçœŸå®å¦™å•Šã€‚ REFERENCE[1] leetcode 113é¢˜[2] æ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°","link":"/2021/04/22/be-careful-when-use-append-to-add-slice-to-slice/"},{"title":"GormåŠ æ‚²è§‚é”çš„æœ€æ–°ç”¨æ³•","text":"å› ä¸ºgoogleäº†â€œgorm for updateâ€æˆ–è€…æ˜¯â€œgorm å¼€å¯æ’ä»–é”â€å‡ºæ¥çš„æ–‡ç« æ¸…ä¸€è‰²çš„ä½¿ç”¨ç€å¦‚ä¸‹ç”¨æ³•æ¥å¼€å¯è¡¨çš„è¡Œ/è¡¨é” 1tx.Set(&quot;gorm:query_option&quot;, &quot;FOR UPDATE&quot;).First(&amp;employee, id) ä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œæˆ‘åŠ äº†æ²¡æœ‰ä½œç”¨ï¼Œæœç´¢gormå®˜æ–¹æ–‡æ¡£ï¼Œç»“æœç”¨æ³•å·²ç»å˜æˆå¦‚ä¸‹ 12345678db.Clauses(clause.Locking{Strength: &quot;UPDATE&quot;}).Find(&amp;users)// SELECT * FROM `users` FOR UPDATEdb.Clauses(clause.Locking{ Strength: &quot;SHARE&quot;, Table: clause.Table{Name: clause.CurrentTable},}).Find(&amp;users)// SELECT * FROM `users` FOR SHARE OF `users` æœç„¶æœ‰é—®é¢˜å…ˆæ‰¾å®˜æ–¹æ–‡æ¡£ã€‚ğŸ˜‚","link":"/2021/11/30/gorm-for-update/"},{"title":"bugfix of pytorch out of memory","text":"è®°å½•ä¸€æ¬¡æ¨¡å‹æ¨ç†è¿‡ç¨‹ä¸­æ˜¾å­˜ä¸æ–­å¢åŠ ç›´è‡³Out-of-Memoryçš„è§£å†³è¿‡ç¨‹. åœºæ™¯å½“æˆ‘åœ¨ç®—æ³•ä¸­åŠ å…¥äº†ä¸€ä¸ªè¿ç®—é‡ä¸å¤§çš„æ“ä½œå, æ¨¡å‹æ¨ç†è¿‡ç¨‹ç›´æ¥ä»åŸæ¥çš„æ˜¾å­˜å ç”¨ä¸åˆ°11Gç›´æ¥çˆ†äº†3090çš„æ˜¾å­˜. æ˜¾å­˜å¢åŠ å®šä½é¦–å…ˆéœ€è¦åˆ¤æ–­æ˜¯ä»€ä¹ˆåœ°æ–¹é€ æˆäº†æ˜¾å­˜çš„å¢åŠ . è¿™é‡Œæ¨èä¸€ä¸ªåº“Pytorch-Memory-Utils.è¯¥åº“å¯ä»¥é€šè¿‡ä¾µå…¥å¼çš„trackæ–¹æ³•è®°å½•ä¸¤ä¸ªtrackæ–¹æ³•ä¹‹é—´çš„æ˜¾å­˜å˜åŒ–. å…¶è®°å½•çš„æ ¼å¼å¦‚ä¸‹ 1234At main.py line 18: &lt;module&gt; Total Tensor Used Memory:466.4 Mb Total Allocated Memory:466.4 Mb+ | 1 * Size:(120, 3, 512, 512) | Memory: 360.0 M | &lt;class 'torch.Tensor'&gt; | torch.float32+ | 1 * Size:(80, 3, 512, 512) | Memory: 240.0 M | &lt;class 'torch.Tensor'&gt; | torch.float32At main.py line 23: &lt;module&gt; Total Tensor Used Memory:1066.4 Mb Total Allocated Memory:1066.4 Mb æœ€ç»ˆæ˜¯å‘ç°åœ¨æ¨¡å‹decoderéƒ¨åˆ†å¯¼è‡´äº†æ˜¾å­˜çš„æ¿€å¢, å¹¶ä¸”éšç€æ¨ç†çš„è¿›è¡Œ,ä¸æ–­ç´¯åŠ . è§£å†³è§£å†³è¿™é‡Œå‚è€ƒäº†Pytorchæ¨¡å‹æµ‹è¯•æ—¶æ˜¾å­˜ä¸€ç›´ä¸Šå‡å¯¼è‡´çˆ†æ˜¾å­˜, åŸå› åº”è¯¥æ˜¯decoderä¸­çš„æ¢¯åº¦åœ¨ä¸€ç›´è®¡ç®—å¹¶ç´¯ç§¯å¯¼è‡´æ˜¾å­˜çš„ä¸åˆç†ç´¯åŠ . å› æ­¤è§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç›´æ¥: 12with torch.no_grad(): y = torch.sigmoid(self.refiner(s, features, im_size)) å°†decoderçš„è¿‡ç¨‹ç”¨torch.no_grad() wrapèµ·æ¥. bugå°±è§£å†³å¥½äº†.","link":"/2022/04/21/bugfix-of-pytorch-out-of-memory/"},{"title":"[6.824ç³»åˆ—] Outline of lab2A solution","text":"æœ¬æ–‡ä¸»è¦æ€»ç»“äº†å¦‚ä½•å®ç°6.824 lab2A. ä¸»è¦ä»»åŠ¡å¦‚ä¸‹: å®ç°Raft Leader Election å®ç°leaderå’Œfollowerä¹‹é—´çš„å¿ƒè·³æœºåˆ¶(ä¸å¸¦log)è¿™ä¸ªlabå…³é”®æ˜¯è¦å¤„ç†å¥½å¤šä¸ªgoroutineå¯¹RaftçŠ¶æ€æœºçš„å¹¶å‘å†™. å¤„ç†ä¸å¥½, å®¹æ˜“é€ æˆæ­»é”/æœ‰é™æ—¶é—´å†…é€‰ä¸å‡ºleader/é€‰å‡ºå¤šä¸ªleaderç­‰å¤šç§é—®é¢˜. ä¸»è¦å®ç°å‚è€ƒè®ºæ–‡ä¸­çš„Figure 2 RaftçŠ¶æ€æœºæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰å‡º leader election å’Œ heartbeat ä¸¤ä¸ªè¿‡ç¨‹ä¸­Raftéœ€è¦ç»´æŠ¤çš„æ•°æ®, è¿™ä¸€ç‚¹åœ¨Raftè®ºæ–‡ä¸­çš„Figure 2å·²ç»è¯´æ˜äº†, æˆ‘ä»¬åœ¨å®ƒçš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€äº›è¿è¡Œæ—¶æ•°æ®.å…·ä½“å¦‚ä¸‹: 12345678910type Raft struct { ... // other currentTerm int // latest term server has seen votedFor int // é€‰ä¸¾è¿‡ç¨‹æŠ•ç»™è°ä¸€ç¥¨, åˆå§‹åŒ–æˆ–resetåä¸º-1è¡¨ç¤ºæœªæŠ•ç¥¨ roleState int // è¡¨ç¤ºserverå½“å‰å¤„äºä¸‰è§’è‰²ä¹‹ä¸€: leader, candidate, follower electionTimeout time.Duration // å½“å‰termæ‰€è®¾ç½®çš„é€‰ä¸¾è¶…æ—¶, åŒæ—¶ä¹Ÿæ˜¯å¿ƒè·³è¶…æ—¶ lastTickTime time.Time // ä¸Šä¸€æ¬¡åˆ·æ–°å¿ƒè·³çš„æ—¶é—´} RPCè°ƒç”¨AppendEntriesåœ¨Lab2Aä¸­, AppendEntriesä¸»è¦ç”¨äºå¿ƒè·³æœºåˆ¶, å› æ­¤ä¸»è¦ç”¨äºé€šçŸ¥followerå½“å‰çš„termæ˜¯ä»€ä¹ˆ, ä»¥ä¾¿äºfollowerè¿›è¡Œtermçš„æ›´æ–°å’Œtimeoutçš„é‡ç½®.å…·ä½“æ¥è¯´, AppendEntriesè°ƒç”¨å¤„ç†çš„è¿‡ç¨‹åˆ†ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†: ä¸Šé”, å› ä¸ºåç»­éœ€è¦è¯»å†™raftçŠ¶æ€å’Œæ•°æ® åˆ¤æ–­å¿ƒè·³ä¼ é€’è¿‡æ¥çš„termæ˜¯å¦æ¯”å½“å‰èŠ‚ç‚¹çš„termæ–°, å¦‚æœä¸æ–°çš„è¯, è¡¨ç¤ºè¯¥å¿ƒè·³æ— æ•ˆ, è¿”å›false æœ‰æ•ˆåˆ™åˆ·æ–° lastTickTime æ»¡è¶³ä»¥ä¸‹ä¸‰ç§æƒ…å†µåˆ™é‡ç½®èŠ‚ç‚¹çŠ¶æ€ [leader with older term] [candidate with older or same term] [follower with older term] é‡ç½®èŠ‚ç‚¹çŠ¶æ€å®é™…ä¸Šå°±æ˜¯ æ›´æ–°termåˆ°æœ€æ–° votedFor=-1 roleState=Follower RequestVoteRequestVoteç”¨äºå½“èŠ‚ç‚¹æå‡ä¸ºcandidateçš„æ—¶å€™, å‘å…¶ä»–èŠ‚ç‚¹ç´¢è¦æŠ•ç¥¨æ—¶è°ƒç”¨. å…·ä½“æ¥è¯´, candidateéœ€è¦å°†è‡ªå·±çš„termå’Œidå‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹, è€Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°RequestVoteå, éœ€è¦å¯¹termçš„åˆæ³•æ€§(newer)è¿›è¡ŒéªŒè¯, å¦‚æœtermåˆæ³•ä¸”èŠ‚ç‚¹æœªæŠ•ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹æˆ–è€…å·²ç»æŠ•ç¥¨ç»™candidate, åˆ™æŠ•ç¥¨ç»™è¯¥candidate. å¤§è‡´å¤„ç†è¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†: åŠ é” å¦‚æœå‘é€è¿‡æ¥çš„termæ›´æ—©, è¯´æ˜è¯¥é€‰ä¸¾è¿‡ç¨‹å·²è¿‡æ—¶, ç›´æ¥è¿”å›false å¦‚æœtermæ›´æ–°, è¯´æ˜æ˜¯æ–°ä¸€è½®çš„é€‰ä¸¾, æ­¤æ—¶èŠ‚ç‚¹éœ€è¦é‡ç½®çŠ¶æ€ åˆ¤æ–­æ˜¯å¦æœªæŠ•è¿‡ç¥¨æˆ–è€…è¯¥è¯·æ±‚çš„candidateIdæ˜¯å·²é€‰è¿‡çš„å€™é€‰è€…, åˆ™ç»™è¯¥å€™é€‰è€…æŠ•ç¥¨ åˆ·æ–° lastTickTime å¿ƒè·³æœºåˆ¶æ¯ä¸ªraftèŠ‚ç‚¹å¦‚æœæ˜¯leaderçŠ¶æ€çš„è¯,ä¼šå‘¨æœŸæ€§åœ°å‘å…¶ä»–èŠ‚ç‚¹å‘é€å¿ƒè·³. åœ¨Lab2Aä¸­, å¿ƒè·³æœºåˆ¶åœ¨å‘é€æ–¹å…¶å®ä¸éœ€è¦åšä»€ä¹ˆäº‹æƒ…, å”¯ä¸€éœ€è¦åšçš„æ˜¯åœ¨å¿ƒè·³ackçš„termæ¯”è‡ªå·±çš„termå¤§çš„æƒ…å†µä¸‹, éœ€è¦é‡ç½®è‡ªå·±çš„çŠ¶æ€, è¿™å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å…¶ä»–èŠ‚ç‚¹è¶…æ—¶æ”¶ä¸åˆ°å¿ƒè·³è€Œå‘èµ·äº†æ–°çš„é€‰ä¸¾. å„ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªå…±åŒçš„peersæ•°ç»„, è¡¨ç¤ºé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œè®¿é—®åœ°å€ é€‰ä¸¾æ¯ä¸ªraftèŠ‚ç‚¹ä¼šåœ¨ä¸æ˜¯leaderçš„çŠ¶æ€ä¸”é€‰ä¸¾è¶…æ—¶çš„æƒ…å†µä¸‹å‘èµ·é€‰ä¸¾, æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹è½¬å˜ä¸ºä¸€ä¸ªå‘¨æœŸæ€§è¿‡ç¨‹: å³æ¯éš” election timeout å°±å°è¯•å‘èµ·æ–°çš„é€‰ä¸¾, å¦‚æœå·²ç»æ˜¯leaderçŠ¶æ€(ä¸Šä¸€æ¬¡é€‰ä¸¾æˆåŠŸ)æˆ–è€…é€‰ä¸¾è¿˜æœªè¶…æ—¶(å…¶ä»–leaderåˆ·æ–°äº†èŠ‚ç‚¹çš„lastTickTime)åˆ™sleep, å¦åˆ™å‘èµ·é€‰ä¸¾. å…·ä½“é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹: å‘å…¶ä»–èŠ‚ç‚¹ç´¢è¦æŠ•ç¥¨ æ£€æŸ¥è¿”å›ç»“æœå’Œå½“å‰çŠ¶æ€ å¦‚æœä¸æ˜¯candidate(è¯´æ˜æœ‰æ–°çš„leaderé‡ç½®äº†å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€)æˆ–è€…å½“å‰çš„termå·²ç»è¢«å…¶ä»–é€‰ä¸¾æ›´æ–°è¿‡, åˆ™ç›´æ¥é€€å‡ºé€‰ä¸¾ è¿”å›çš„termæ›´æ–°, åˆ™è¯´æ˜å½“å‰candidateçŠ¶æ€æ— æ•ˆ, é‡ç½®å½“å‰çŠ¶æ€å¹¶é€€å‡ºé€‰ä¸¾ è¿”å›ç»“æœä¸ºtrue, åˆ™è®°ä¸€ç¥¨, è¶…è¿‡åŠæ•°çš„ç¥¨çš„æƒ…å†µ, å½“å‰èŠ‚ç‚¹å½“é€‰leaderå¹¶ç«‹åˆ»å‘èµ·å¿ƒè·³ç»™å…¶ä»–èŠ‚ç‚¹åŒæ­¥çŠ¶æ€. æ³¨æ„ç‚¹ ä»»ä½•éœ€è¦æŸ¥è¯¢å’Œä¿®æ”¹raftçŠ¶æ€çš„æ“ä½œéƒ½éœ€è¦åŠ é” é¿å…åœ¨æŒæœ‰é”çš„è¿‡ç¨‹ä¸­è¯·æ±‚å…¶ä»–çš„é”, ææ˜“å‘ç”Ÿæ­»é” é¿å…åœ¨æŒæœ‰é”çš„è¿‡ç¨‹ä¸­è¿›è¡ŒRPCè°ƒç”¨, åº”åœ¨rpcè°ƒç”¨ä¹‹å‰é‡Šæ”¾é”. æ¥æ”¶è¿”å›ç»“æœååœ¨åŠ é”å¤„ç†åç»­é€»è¾‘ è¿™æ˜¯å› ä¸ºåœ¨è¿™ä¸ªä½œä¸šä¸­, è¢«è°ƒæ–¹å’Œè°ƒç”¨æ–¹å®é™…ä¸Šå…±äº«é”, è¿™ä¼šå¯¼è‡´å…¶ä¸­ä¸€ä¸ªåç¨‹AæŒæœ‰é”è¿›è¡ŒRPCè°ƒç”¨è€Œè¢«è°ƒç”¨æ–¹å¤„äºåç¨‹Bç”±äºé”è¢«å ç”¨è€Œé˜»å¡.","link":"/2022/04/26/outline-of-6-824-lab2A-solution/"},{"title":"é¢è¯•16ç§ä»£ç æ¨¡å¼æ€»ç»“(1) - æ»‘åŠ¨çª—å£","text":"æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹Grokking the Coding Interview: Patterns for Coding Questionsè¯¾ç¨‹çš„æ€»ç»“ï¼Œç¼–ç¨‹è¯­è¨€ä½¿ç”¨Goã€‚è¯»è€…å¦‚æœæƒ³è¦æ›´ç»†è‡´çš„äº†è§£ï¼Œè¯·è‡ªè¡Œè´­ä¹°è¯¾ç¨‹å­¦ä¹ ã€‚ é—®é¢˜èƒŒæ™¯åœ¨å¤„ç†æ•°ç»„å’Œé“¾è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦æ‰¾å‡ºæ»¡è¶³æŸäº›æ¡ä»¶çš„è¿ç»­å­åˆ—, æ¯”å¦‚å­åˆ—çš„å’Œæœ€å¤§ç­‰ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£çš„æ€æƒ³æ¥è¿›è¡Œè§£ç­”ã€‚è¿™é‡Œæ³¨æ„çš„æ˜¯å­åˆ—å¯ä»¥æ˜¯å›ºå®šå¤§å°ä¹Ÿå¯ä»¥æ˜¯å¯å˜å¤§å°ï¼Œä¸¤ç§æƒ…å†µæœ‰ç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚ ä¸‹é¢å…ˆç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åœ¨ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ¯ä¸ªsizeä¸ºKçš„è¿ç»­å­åˆ—çš„å¹³å‡å€¼ã€‚ 123Array: [1, 3, 2, 6, -1, 4, 1, 8, 2], K=5Output: [2.2, 2.8, 2.4, 3.6, 2.8] æ»‘åŠ¨çª—å£çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹: 123456789101112131415161718func findAveragesOfSubArraysBySlidingWindow(K int, arr []int) []float64 { results := make([]float64, len(arr)-K+1) windowSum := 0 windowStart := 0 for windowEnd := 0; windowEnd &lt; len(arr); windowEnd++ { // æŠŠä¸‹ä¸ªå…ƒç´ åŠ ä¸Š windowSum += arr[windowEnd] // æ»‘åŠ¨çª—å£ï¼Œç‰¹åˆ«åœ°ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°Kä¸ªåˆ™ä¸æ»‘åŠ¨ if windowEnd &gt;= K-1 { // å½“å‰windowSumè®¡ç®—äº†æ•´ä¸ªçª—å£çš„å’Œ results[windowStart] = float64(windowSum) / float64(K) // å½“å‰çª—å£è®¡ç®—å®Œåï¼Œç§»åŠ¨çª—å£éœ€è¦å…ˆå‡å»åŸæ¥çª—å£å¤´éƒ¨çš„å…ƒç´  windowSum -= arr[windowStart] windowStart++ } } return results} è§£æ³•æ€»ç»“æ ¹æ®çª—å£å¤§å°æ˜¯å¦å›ºå®šï¼Œåˆ†ä¸ºå›ºå®šå¤§å°å’Œå¯å˜å¤§å° å›ºå®šå¤§å°è¿™é‡Œæ‹¿ æ‰¾å‡ºsize=kçš„æœ€å¤§è¿ç»­å­åºåˆ—å’Œ ä½œä¸ºä¾‹å­ 12345678910Given an array of positive numbers and a positive number k,find the maximum sum of any contiguous subarray of size k.Input: [2, 1, 5, 1, 3, 2], k=3Output: 9Explanation: Subarray with maximum sum is [5, 1, 3].Input: [2, 3, 4, 1, 5], k=2Output: 7Explanation: Subarray with maximum sum is [3, 4]. è§£å†³æ–¹æ¡ˆ 123456789101112131415161718192021222324252627282930func max(x, y int) int { if x &gt; y { return x } else { return y }}func solution(arr []int, k int) int { var ( windowStart = 0 windowSum = 0 // ç”¨äºè®°å½•å½“å‰çª—å£çš„çŠ¶æ€ maxSum = 0 // ç”¨äºè®°å½•æœ€å¥½çš„çŠ¶æ€ ) for windowEnd:=0;windowEnd&lt;len(arr);windowEnd++{ // è¿™ä¸€æ­¥æ˜¯çª—å£çš„å³ä¾§è¿›è¡Œä¸€æ ¼æ‰©å¼ ï¼ŒåŒæ—¶æ›´æ–°å½“å‰çª—å£çš„çŠ¶æ€ windowSum += arr[windowEnd] // åˆ¤æ–­å½“å‰çª—å£æ˜¯å¦æ»¡è¶³ç›¸åº”æ¡ä»¶ if windowEnd &gt;= k-1{ // æ›´æ–°æœ€å¥½çš„çŠ¶æ€ maxSum = max(maxSum, windowSum) // æ”¶ç¼©çª—å£å·¦ä¾§ windowSum -= arr[windowStart] windowStart-- } } return maxSum} ç›¸å…³ç»ƒä¹ : [1][2][3] å¯å˜å¤§å°è¿™é‡Œé€šè¿‡é•¿åº¦æœ€å°çš„å­æ•°ç»„æ¥è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142func min(i, j int) int { if i&lt;j { return i }else{ return j }}func minSubArrayLen(target int, nums []int) int { var( windowStart = 0 windowSum = 0 minSize = -1 ) for windowEnd:=0;windowEnd&lt;len(nums);windowEnd++{ // çª—å£å³ä¾§æ‰©å¼ ï¼Œè¿™ä¸ªéƒ¨åˆ†å’Œå›ºå®šå¤§å°æ˜¯ä¸€æ ·çš„ windowSum+=nums[windowEnd] // è¿™ä¸ªéƒ¨åˆ†æ˜¯ä¸å›ºå®šå¤§å°ç±»å‹æœ€å¤§çš„åŒºåˆ« // ä¸åŒäºå›ºå®šå¤§å°æ¯æ¬¡çš„å³ä¾§æ‰©å¼ å’Œå·¦ä¾§æ”¶ç¼©æ˜¯åŒæ­¥çš„ // å¯å˜å¤§å°çš„å·¦ä¾§æ”¶ç¼©éœ€è¦å¾ªç¯åˆ¤æ–­çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶ // å¯èƒ½å³ä¾§æ‰©å¼ äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯å·¦ä¾§æ‰æ”¶ç¼©ä¸€å› // ä¹Ÿå¯èƒ½å³ä¾§æ‰©å¼ ä¸€æ¬¡ï¼Œå·¦ä¾§éœ€è¦æ”¶ç¼©å‡ å› for windowSum&gt;=target{ if minSize==-1{ minSize = windowEnd-windowStart+1 }else{ minSize = min(minSize, windowEnd-windowStart+1) } windowSum-=nums[windowStart] windowStart++ } // å¯¹äºä¸€äº›æƒ…å†µæ¡ä»¶éœ€è¦è¿›è¡Œåå¤„ç†ï¼Œæ¯”å¦‚å½“æ”¶ç¼©çª—å£ç›´åˆ°çª—å£å†…å•ä¸€å­—ç¬¦æ•°é‡&lt;k // ç„¶åå†æ¯”è¾ƒå½“å‰çª—å£çš„å¤§å° } if minSize==-1{ return 0 } return minSize} ç›¸å…³ç»ƒä¹ é¢˜: [1][2][3][4][5][6][7] ç‰¹æ®Šä¾‹å­æœ€å°è¦†ç›–å­ä¸²åŸé¢˜è§leetcode 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051func findSubstring(str, pattern string) string { // è¾¹ç•Œ if len(pattern)&gt;len(str){ return &quot;&quot; } var ( windowStart = 0 matched = 0 minLength = len(str) + 1 subStrStart = 0 patternMap = make(map[byte]int) ) for i := 0; i &lt; len(pattern); i++ { patternMap[pattern[i]]++ } for windowEnd := 0; windowEnd &lt; len(str); windowEnd++ { wright := str[windowEnd] if _, ok := patternMap[wright]; ok { patternMap[wright]-- // å…³é”®ç‚¹1, ä¸å†æ˜¯==0ï¼Œè€Œæ˜¯&gt;=0ï¼Œå› ä¸ºåŒ…å«æ‰€æœ‰çš„å­—ç¬¦ if patternMap[wright] &gt;= 0 { matched++ } } // å¦‚æœå½“å‰windowåŒ…å«patternæ‰€æœ‰çš„å­—ç¬¦ï¼Œåˆ™ä»å·¦æ”¶ç¼©çª—å£è‡³ä¸å®Œå…¨åŒ…å«çŠ¶æ€ // æ³¨æ„è¿™é‡Œç­‰å·å³ä¾§ä¸æ˜¯len(patternMap)ï¼Œå› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰å­—ç¬¦ for matched == len(pattern) { if minLength &gt; windowEnd-windowStart+1 { minLength = windowEnd - windowStart + 1 subStrStart = windowStart } wleft := str[windowStart] if _, ok := patternMap[wleft]; ok { // å…³é”®ç‚¹2ï¼Œåªè¦æœ‰ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ç§»é™¤äº†çª—å£ï¼Œåˆ™åœæ­¢æ”¶ç¼© if patternMap[wleft] == 0 { matched-- } patternMap[wleft]++ } windowStart++ } } if minLength &gt; len(str) { return &quot;&quot; } else { return str[subStrStart : subStrStart+minLength] }} FAQ: è¿™é‡Œå¯¹ä¸Šè¿°ä»£ç åšä¸€å®šçš„è§£é‡Šï¼Œä¸»è¦å›°æƒ‘ç‚¹åœ¨äºä¸¤ä¸ªå…³é”®ç‚¹Q: ä¸ºä»€ä¹ˆå…³é”®ç‚¹1å¤„æ˜¯&gt;=0ï¼ŸA: å› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œå› ä¸ºæ¯é‡åˆ°ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å­—ç¬¦ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹patternMapä¸­å¯¹åº”å€¼åšå‡æ³•å¹¶matched++, ç›´åˆ°æˆ‘ä»¬åŒ¹é…å®Œäº†patternæ‰€æœ‰è¯¥å­—ç¬¦ï¼Œæ­¤æ—¶å¯¹äºå¤šä½™è¯¥å­—ç¬¦æˆ‘ä»¬åªéœ€è¦æ›´æ–°patternMapï¼Œä½†æ˜¯ä¸å¿…å†æ›´æ–°matchedã€‚ Q: ä¸ºä»€ä¹ˆå…³é”®ç‚¹2å¤„æ˜¯==0ï¼ŸA: è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœçª—å£åŒä¸€ä¸ªå­—ç¬¦æ²¡æœ‰å†—ä½™ï¼Œé‚£ä¹ˆç§»é™¤äº†ä¸€ä¸ªè¯¥å­—ç¬¦åˆ™æ„å‘³ç€åŒ¹é…ä¸å®Œå…¨ï¼Œä½†æ˜¯å¦‚æœçª—å£å†…è¯¥å­—ç¬¦æœ‰å†—ä½™ï¼Œæ¯”å¦‚patternæ˜¯aabï¼Œè€Œçª—å£å†…æœ‰3ä¸ªaï¼Œæ­¤æ—¶aæœ‰å†—ä½™ï¼Œå¦‚æœæ”¶ç¼©çª—å£åªç§»å‡ºäº†ä¸€ä¸ªaï¼Œé‚£ä¹ˆæ­¤æ—¶çª—å£ä¾ç„¶æ˜¯æ»¡è¶³åŒ¹é…å®Œå…¨æ¡ä»¶çš„ï¼Œåæ˜ åˆ°ä»£ç ä¸Šï¼Œæ”¶ç¼©å‰patternMap['a'] = -1 (åœ¨2çš„åŸºç¡€-3)ï¼Œæ”¶ç¼©åpatternMap['a']=0ï¼Œå› æ­¤å¦‚æœæ”¶ç¼©æ‰ä¸‹ä¸€ä¸ªaï¼Œåˆ™éœ€è¦matchedâ€“äº†ã€‚ ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²åŸé¢˜è§leetcodeè¿™ä¸ªé¢˜ç›®ä¸»è¦è¦å¯¹é¢˜æ„ç†è§£æ¸…æ¥šï¼Œé¦–å…ˆç›®æ ‡å­ä¸²éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š é•¿åº¦ç­‰äºå•è¯åˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯é•¿åº¦*å•è¯ä¸ªæ•° å­ä¸²ä¸å¯ä»¥å‡ºç°ä¸åœ¨åˆ—è¡¨ä¸Šçš„å…¶ä»–å•è¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748func findWordConcatenation(str string, words []string) []int { if len(words)==0||len(str)==0{ return []int{} } var ( wordFreqMap = make(map[string]int) wordsCount = len(words) wordLength = len(words[0]) // å­˜å‚¨æ»¡è¶³æ¡ä»¶çš„index startIndex = make([]int, 0, 10) ) // è®°å½•æ¯ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡ for _, v := range words { wordFreqMap[v]++ } // æ³¨æ„è¿™ä¸ªä¸æ˜¯å¸¸è§„çš„sliding window pattern // iè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå­ä¸²çš„èµ·å§‹ä½ç½®ï¼Œä»æ¡ä»¶å¯çŸ¥æ¯ä¸ªå­ä¸²æ˜¯å›ºå®šé•¿åº¦çš„ // æ‰€ä»¥iæœ€å¤§ä¸ºlen(str)-wordLength*wordsCount for i := 0; i &lt;= len(str)-wordLength*wordsCount; i++ { wordsSeenMap := make(map[string]int) // key1: ä¿å­˜çœ‹è¿‡çš„wordçš„æ•°é‡ // å¯¹ä»å½“å‰index iå¼€å§‹çš„é•¿åº¦ä¸ºwordLength*wordsCountçš„stringè¿›è¡Œåˆ¤å®š for j := 0; j &lt; wordsCount; j++ { nextWordIndex := i + j*wordLength // å½“å‰wordçš„å¼€å§‹index word := str[nextWordIndex : nextWordIndex+wordLength] // å¦‚æœå‡ºç°ä¸åœ¨wordsæ•°ç»„ä¸­çš„wordï¼Œåˆ™ç›´æ¥è·³å‡º if _, ok := wordFreqMap[word]; !ok { break } wordsSeenMap[word]++ // å¦‚æœwordsæ•°ç»„ä¸­æŸä¸ªwordæ•°é‡å‡ºç°æ¬¡æ•°è¿‡å¤šæ„å‘³ç€ä¸€å®šä¼šæœ‰å…¶ä»–å•è¯ä¸åœ¨ï¼Œåˆ™ä¹Ÿç›´æ¥è·³å‡º if wordsSeenMap[word] &gt; wordFreqMap[word] { break } // å¦‚æœéå†åˆ°è¯¥stringçš„æœ€åä¸€ä¸ªå­—ç¬¦éƒ½æ²¡è·³å‡ºå¾ªç¯ï¼Œæ„å‘³è¯¥stringæ˜¯æ»¡è¶³æ¡ä»¶çš„ if j == wordsCount-1 { startIndex = append(startIndex, i) } } // ===end=== } return startIndex} REFERENCE[1] https://www.educative.io/courses/grokking-the-coding-interview[2] https://github.com/zhiwei-Feng/Golang-Grokking-the-Coding-Interview-Patterns-for-Coding-Questions","link":"/2021/04/04/sliding-window/"},{"title":"ä»6.824çš„kv.goç†è§£tcpåè®®","text":"æœ¬æ–‡æ˜¯åœ¨å­¦ä¹ 6.824è¯¾ç¨‹æ—¶ï¼Œå¯¹Lec 2çš„kv.goäº§ç”Ÿçš„å›°æƒ‘çš„è§£é‡Šå’Œæ€»ç»“ã€‚ kv.goé¦–å…ˆå¯¹kv.goçš„æƒ…å†µè¿›è¡Œè§£é‡Šã€‚è¿™é‡Œåªä¼šå–ä¸€äº›é‡ç‚¹ç‰‡æ®µè¿›è¡Œè§£é‡Šï¼Œéœ€è¦\bäº†è§£å®Œæ•´ä»£ç ç»†èŠ‚çš„ï¼Œè¯»è€…å¯è‡ªè¡Œé€‰æ‹©æ–‡ç« æœ€åçš„å‚è€ƒæ¡ç›®è¿›è¡Œè¯¦ç»†äº†è§£ã€‚ ä¸»é€»è¾‘12345678910func main() { //å¯åŠ¨rpcæœåŠ¡ï¼Œä¸€ä¸ªkvå­˜å‚¨ server() //å†™å…¥ä¸€ä¸ªkvé”®å€¼å¯¹ put(&quot;subject&quot;, &quot;6.824&quot;) fmt.Printf(&quot;Put(subject, 6.824) done\\n&quot;) //è¯»å‡ºåˆšæ‰å­˜å‚¨çš„keyçš„value fmt.Printf(&quot;get(subject) -&gt; %s\\n&quot;, get(&quot;subject&quot;))} ä¸»é€»è¾‘éå¸¸ç®€å•ï¼Œå¯åŠ¨ä¸€ä¸ªkvå­˜å‚¨çš„rpcæœåŠ¡ï¼Œç„¶åè¿è¡Œç®€å•çš„è¯»å†™åŠŸèƒ½æµ‹è¯•ã€‚ server()123456789101112131415161718192021func server() { kv := new(KV) kv.data = map[string]string{} rpcs := rpc.NewServer() rpcs.Register(kv) l, e := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;) if e != nil { log.Fatal(&quot;listen error:&quot;, e) } go func() { for { conn, err := l.Accept() if err == nil { go rpcs.ServeConn(conn) } else { break } } l.Close() }()} å¯åŠ¨æœåŠ¡ï¼Œç›‘å¬1234ç«¯å£ï¼Œå¹¶å¼€å§‹æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ client12345678910111213141516171819202122func get(key string) string { client := connect() args := GetArgs{key} reply := GetReply{} err := client.Call(&quot;KV.Get&quot;, &amp;args, &amp;reply) if err != nil { log.Fatal(&quot;error:&quot;, err) } client.Close() return reply.Value}func put(key string, val string) { client := connect() args := PutArgs{key, val} reply := PutReply{} err := client.Call(&quot;KV.Put&quot;, &amp;args, &amp;reply) if err != nil { log.Fatal(&quot;error:&quot;, err) } client.Close()} å®¢æˆ·ç«¯æ–¹æ³•æ€»ä½“é€»è¾‘æ˜¯ä¸€è‡´ï¼Œé¦–å…ˆè¿›è¡Œtcpè¿æ¥çš„å»ºç«‹ï¼Œç„¶åè¿›è¡Œrpcæ–¹æ³•è°ƒç”¨ï¼Œæœ€åå…³é—­è¿æ¥ è§£æè¿‡ç¨‹å¦‚æœä½ è¿è¡Œè¯¥ç¨‹åºï¼Œä¼šå‘ç°æ‰“å°å¦‚ä¸‹ï¼š 12345$ go run kv.goPut(subject, 6.824) doneget(subject) -&gt; 6.824$ ä¸ºä»€ä¹ˆç¨‹åºæœ€åä¼šé€€å‡ºï¼Œè€Œä¸æ˜¯å› ä¸ºserveråœ¨ç›‘å¬é˜»å¡ä½ã€‚æˆ‘è‡ªå·±çš„è§£é‡Šæ˜¯ï¼šé¦–å…ˆæ˜¯å› ä¸ºserver()ä¸­çš„æ— é™æ¥æ”¶è¯·æ±‚çš„å¾ªç¯æ˜¯è¿è¡Œåœ¨goroutineå½“ä¸­ï¼Œæ‰€ä»¥ä¹‹åçš„å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥å¹¶å‘çš„è¿è¡Œï¼›å…¶æ¬¡å› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰å…¶ä»–æ–¹æ³•çš„é˜»å¡ï¼Œæ‰€ä»¥ä¼šåœ¨æ‰€æœ‰é€»è¾‘ç»“æŸåé€€å‡ºï¼Œä¹Ÿæ„å‘³è¯¥è¿›ç¨‹é€€å‡ºäº†ï¼Œè¿™æ ·å…¶ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç»“æŸï¼ŒåŒ…æ‹¬å…¶ä¸­åˆ›å»ºçš„goroutineã€‚ å¦‚æœè¯»è€…æœ‰æ›´å¥½çš„è§£é‡Šæ¬¢è¿ç•™è¨€è®¨è®ºã€‚ åœ¨è¯¥ç¨‹åºçš„ä¸»é€»è¾‘ä¸­ï¼Œå®é™…å‘ç”Ÿäº†ä¸¤æ¬¡tcpè¿æ¥ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€æ¬¡tcpåè®®çš„è¿è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥åˆ›å»ºã€æ•°æ®ä¼ é€å’Œè¿æ¥ç»ˆæ­¢ã€‚server()ä¸‹å¼€å¯çš„rpcæœåŠ¡ç›‘å¬ç€1234ç«¯å£ï¼Œè€Œgetå’Œput()ä¸­çš„connect()åˆ™å®Œæˆä¸€æ¬¡tcpè¿æ¥åˆ›å»ºçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚å›¾ä¸‹ æ­¤æ—¶é€šè¿‡netstatå‘½ä»¤æŸ¥çœ‹ä¼šå‡ºç°æœ‰ä¸¤ä¸ªè¿æ¥ä»¥åŠä¸€ä¸ªç›‘å¬ å½“æ•°æ®ä¼ é€å®Œæ¯•ï¼Œgetå’Œput()è°ƒç”¨Close()æ–¹æ³•è¿›å…¥è¿æ¥ç»ˆæ­¢é˜¶æ®µï¼ˆå››æ¬¡æ¡æ‰‹ï¼‰åï¼Œå®¢æˆ·ç«¯çŠ¶æ€åˆ™ä¼šè¿›å…¥TIME_WAITçŠ¶æ€ ç­‰å¾…2MSLåï¼Œå®¢æˆ·ç«¯Closeã€‚ å¦‚æœå¸Œæœ›å¯¹TCPçš„è®¾è®¡æƒ³è¦æ›´æ·±å…¥äº†è§£ï¼Œå¯ä»¥å‚è€ƒ ä¸ºä»€ä¹ˆ TCP åè®®æœ‰ TIME_WAIT çŠ¶æ€ ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ Why is the TCP connection terminated in a 4-way handshake? REFERENCE[1] 6.824 kv.go[2] ç»´åŸºç™¾ç§‘","link":"/2021/04/11/socket-analysis-for-6-824-kv-go/"},{"title":"Leetcode ç»„åˆæ€»å’Œé—®é¢˜æ€»ç»“","text":"ç»„åˆæ€»å’Œç³»åˆ—é¢˜æ€»ç»“. 39. ç»„åˆæ€»å’Œ 40. ç»„åˆæ€»å’ŒII 216. ç»„åˆæ€»å’ŒIII 377. ç»„åˆæ€»å’ŒIV ç»„åˆæ€»å’Œæœ¬é¢˜æ³¨æ„candidatesæ˜¯æ— é‡å¤å…ƒç´ ,ä¸”å…ƒç´ éƒ½å¤§äº0, åˆ©ç”¨backtraceçš„æ€æƒ³æ±‚è§£å³å¯ 1234567891011121314151617181920212223242526272829303132func combinationSum(candidates []int, target int) [][]int { ans := [][]int{} path := []int{} pathSum := 0 var backtrace func(idx int) backtrace = func(idx int) { if idx == len(candidates) || pathSum &gt;= target { if pathSum == target { tmp := make([]int, len(path)) copy(tmp, path) ans = append(ans, tmp) } return } backtrace(idx+1) for i:=1;i&lt;=target/candidates[idx];i++{ if candidates[idx]*i+pathSum&lt;=target { pathSum+=candidates[idx]*i for k:=0;k&lt;i;k++{ path = append(path, candidates[idx]) } backtrace(idx+1) pathSum-=candidates[idx]*i path = path[:len(path)-i] }else { break } } } backtrace(0) return ans} ç»„åˆæ€»å’ŒIIæœ¬é¢˜çš„å…³é”®æ˜¯å¦‚ä½•å»é‡, æ€è·¯ä¾æ—§æ˜¯backtrace. å…·ä½“å»é‡çš„æ€æƒ³å¦‚ä¸‹: å¯¹äºcandidateså’Œtargetä»¥åŠå½“å‰ç´¢å¼•idx, æˆ‘ä»¬ä¿è¯candidates[idx]åªèƒ½è¢«é€‰å–ä¸€æ¬¡æ¥æ‰£å‡target, ä»è€Œä¿è¯å½“å‰æƒ…å†µä¸‹æ²¡æœ‰é‡å¤, å¹¶å°†é—®é¢˜è½¬åŒ–ä¸ºcandidates[idx+1:]å‡‘æˆtarget-candicates[idx]çš„å­é—®é¢˜. ä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿çš„é¿å…é‡å¤candidatesçš„é€‰å–, æˆ‘ä»¬å°†candidatesé¦–å…ˆè¿›è¡Œæ’åº 123456789101112131415161718192021222324252627282930313233func combinationSum2(candidates []int, target int) [][]int { var ( ans = make([][]int, 0) path = make([]int, 0) backtrace func(int, int) n = len(candidates) ) sort.Ints(candidates) backtrace = func(begin int, remain int) { if remain==0 { ans = append(ans, append([]int{}, path...)) return } for i:=begin;i&lt;n;i++{ if candidates[i]&gt;remain{ // å½“å‰å€™é€‰å€¼å¤ªå¤§ï¼Œå‰ªæ break } if i&gt;begin&amp;&amp;candidates[i]==candidates[i-1]{ // å› ä¸ºcandidates[i-1]å­˜åœ¨è¢«é€‰å–çš„æƒ…å†µ, ä¸ºé¿å…é‡å¤è·³è¿‡åç»­çš„é‡å¤å…ƒç´  continue } path = append(path, candidates[i]) backtrace(i+1, remain-candidates[i]) path = path[:len(path)-1] } } backtrace(0, target) return ans} ç»„åˆæ€»å’ŒIIIæ³¨æ„æ¡ä»¶ä¸­éœ€è¦ç»„åˆåˆ—è¡¨ä¸ªæ•°ç­‰äºk, å› æ­¤å›æº¯çš„è¿”å›æ¡ä»¶å› åŠ å…¥åˆ¤æ–­. 12345678910111213141516171819202122232425func combinationSum3(k int, n int) (ans [][]int) { path := []int{} var backtrace func(idx, remain int) backtrace = func(idx, remain int) { if idx &gt; 9 || remain == 0 || len(path) == k { // idxè¡¨ç¤ºå½“å‰éå†åˆ°çš„æ•°å­—, å¤§äº9åˆ™è¿‡ç•Œ // åŒæ—¶å¦‚æœremainç­‰äº0, æˆ–è€…pathçš„é•¿åº¦è¾¾åˆ°käº†éƒ½å±äºåˆ°è¾¾è¾¹ç•Œçš„æƒ…å†µ if remain == 0 &amp;&amp; len(path) == k { ans = append(ans, append([]int{}, path...)) } return } for i:=idx;i&lt;=9;i++{ if i&gt;remain { break } path = append(path, i) backtrace(i+1, remain-i) path = path[:len(path)-1] } } backtrace(1, n) return} ç»„åˆæ€»å’ŒIV(*)æœ¬é¢˜ä½¿ç”¨backtraceä¼šè¶…æ—¶, å› æ­¤éœ€è¦ä½¿ç”¨dpæ¥è§£, æœ¬é¢˜çš„dpè§£æ³•ç±»ä¼¼äºå®Œå…¨èƒŒåŒ…é—®é¢˜, ä½†éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºtarget=7, nums=[1,2,3]çš„è¾“å…¥, å®Œå…¨èƒŒåŒ…è®¤ä¸º[1,2,3], [1,3,2], [2,1,3], [2,3,1], [3,1,2], [3,2,1]å…­ç§æƒ…å†µæ˜¯ä¸€ç§æ–¹æ¡ˆ, è€Œæœ¬é¢˜è®¤ä¸ºæ˜¯å…­ç§æ–¹æ¡ˆ, è¿™ä¸€ç‚¹æ˜¯æœ¬é¢˜è§£æ³•çš„å…³é”®. 1234567891011121314151617181920212223func combinationSum4(nums []int, target int) int { n := target // dpçš„å«ä¹‰, dp[i][j]å¯¹äºé•¿åº¦içš„ç»„åˆ, æ€»å’Œä¸ºjçš„æ–¹æ¡ˆæ•°, æœ¬é¢˜ç”±äºnumså…¨éƒ¨ä¸ºæ­£æ•°, å› æ­¤iæœ€å¤§ä¸ºtarget dp := make([][]int, n+1) for i:=range dp { dp[i] = make([]int, target+1) } dp[0][0]=1 ans := 0 for i:=1;i&lt;=n;i++{ for j:=0;j&lt;=target;j++{ for _, u := range nums { if j&gt;=u { dp[i][j]+=dp[i-1][j-u] } } } // å¯¹äºä¸åŒé•¿åº¦çš„ç»„åˆ, æ€»å’Œä¸ºtargetçš„æ–¹æ¡ˆ, æˆ‘ä»¬ç´¯åŠ  ans += dp[i][target] } return ans} æ•°ç»„é™ç»´, å‡å°‘ç©ºé—´å¤æ‚åº¦ 12345678910111213141516171819func combinationSum4(nums []int, target int) int { n := target dp := make([]int, target+1) dp[0]=1 ans := 0 for i:=1;i&lt;=n;i++{ for j:=target;j&gt;=0;j--{ dp[j] = 0 for _, u := range nums { if j&gt;=u { dp[j]+=dp[j-u] } } } ans += dp[target] } return ans} è¿›ä¸€æ­¥å‡å°‘æ—¶é—´å¤æ‚åº¦ 123456789101112131415func combinationSum4(nums []int, target int) int { // è¿™ä¸ªè§£æ³•ç±»ä¼¼äºçˆ¬æ¥¼æ¢¯, å¯¹äºæ¯ä¸ªæ€»å’Œjè€Œè¨€, numsä¸ºæ¯æ¬¡æ”€çˆ¬çš„æ¥¼æ¢¯æ•° // æ‰€ä»¥ dp[j] = sum of { dp[j-nums[i]] for each i belong to 0..len(nums) } dp := make([]int, target+1) dp[0]=1 for j:=1;j&lt;=target;j++{ for _, u := range nums { if j&gt;=u { dp[j]+=dp[j-u] } } } return dp[target]}","link":"/2022/04/18/summary-of-combination-sum/"},{"title":"Leetcode æœ€å¤§çŸ©å½¢é—®é¢˜æ€»ç»“","text":"æ¦‚è¿°è¯¥èŠ‚æ¶‰åŠçš„Leetcodeé¢˜ç›®ä¸º: 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ 85. æœ€å¤§çŸ©å½¢ å®é™…ä¸Š, 85é¢˜å¯ä»¥çœ‹ä½œæ˜¯åŸºäº84é¢˜æ¥æ‹“å±•äº†ä¸€ç»´çš„é—®é¢˜.é¦–å…ˆæ¥çœ‹84é¢˜,å¦‚ä¸‹å›¾,å¯ä»¥çœ‹åˆ°é¢˜ç›®çš„æ„æ€å°±æ˜¯ç»™å®šä¸€ç»„å®½åº¦ä¸º1çš„çŸ©å½¢å—,æ±‚å‡ºå…¶ä¸­å¯ä»¥æ„æˆçš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯. 84.æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ä¸éš¾çœ‹å‡º,è¿™é‡Œé¢æœ‰ä¸ªéšå«çš„æç¤º,åŠå¯¹äºæŸä¸ªçŸ©å½¢å—(é«˜åº¦ä¸ºx)è€Œè¨€,è¦æƒ³ä»¥å®ƒä½œä¸ºæœ€å¤§çŸ©å½¢çš„é«˜åº¦,é‚£ä¹ˆå°±å¿…é¡»ä¿è¯æ„æˆçŸ©é˜µçš„ç›¸é‚»é«˜åº¦éƒ½å¤§äºç­‰äºx. æ¯”å¦‚è¯´ä¸Šå›¾ä¸­,æˆ‘ä»¬å¦‚æœè¦ä»¥çŸ©å½¢é«˜åº¦ä¸º5çš„å—ä½œä¸ºæœ€å¤§çŸ©å½¢çš„é«˜,åˆ™å·¦ä¾§å·²ç»æ²¡æœ‰å—é«˜åº¦å¤§äºç­‰äº5,æ‰€ä»¥å·¦ä¾§æ— æ³•æ‹“å±•,è€Œå³ä¾§å› ä¸ºæœ‰é«˜åº¦6çš„å—,æ‰€ä»¥å¯ä»¥æ‹“å±•ä¸€æ¬¡,æœ€ç»ˆæ„é€ å‡ºæ¥çš„çŸ©å½¢é¢ç§¯ä¸º2*5=10. å› æ­¤è§£æ³•å³ä¸ºéå†æ¯ä¸€ä¸ªå—é«˜åº¦,å¹¶ä»¥å®ƒä¸ºä¸­å¿ƒå‘ä¸¤ä¾§æ‹“å±•å¹¶è®¡ç®—å…¶æ‹“å±•åçš„çŸ©å½¢é¢ç§¯,å–å…¶ä¸­æœ€å¤§å€¼.ä½†æ˜¯æ˜¾ç„¶è¿™ç§åšæ³•æ—¶é—´å¤æ‚åº¦è¾ƒé«˜,å› ä¸ºå®ƒé‡å¤éå†ä¸¤ä¾§çš„å…ƒç´ . ä¸Šè¿°è¿™ç§è§£æ³•æ¢ä¸ªè§’åº¦çœ‹å¯ä»¥è®¤ä¸ºæ˜¯æ‰¾åˆ°æŸä¸ªé«˜åº¦ä¸ºxçš„çŸ©å½¢å—å·¦ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºxçš„å—iå’Œå³ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºxå—j,åˆ™æ„æˆçš„çŸ©å½¢é¢ç§¯ä¸ºarea = x*(j-i-1).å¯å‘è‡ªå•è°ƒæ ˆçš„æ€æƒ³,æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªä¸¥æ ¼é€’å¢çš„æ ˆ,è¯¥æ ˆé‡Œé¢å­˜å‚¨çŸ©å½¢å—çš„ç´¢å¼•index,æ ˆä¸­å…ƒç´ æ»¡è¶³ä»åº•åˆ°é¡¶çš„çŸ©å½¢å—é«˜åº¦ä¸¥æ ¼é€’å¢. å•è°ƒæ ˆå¦‚ä½•å®ç°ä¸Šè¿°è§£æ³•? ä¿è¯æ ˆå•è°ƒçš„åŒæ—¶å…¥æ ˆå½“å‰çš„çŸ©é˜µå—ç´¢å¼•i, è¿™æ ·å¯ä»¥ä¿è¯å·¦ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºheights[i]çš„çŸ©å½¢å—ç´¢å¼•å°±æ˜¯åº•ä¸‹çš„é‚£ä¸ªå…ƒç´  å¦ä¸€æ–¹é¢,å•è°ƒæ ˆå…¥æ ˆå‰éœ€è¦å¼¹å‡ºå…¶ä¸­é«˜åº¦å¤§äºç­‰äºå½“å‰å—ié«˜åº¦çš„ç´¢å¼•,è¿™ä¸€æ­¥å®é™…ä¸Šå¯¹äºæ¯ä¸ªå¼¹å‡ºçš„çŸ©é˜µå—kæ˜¯æ‰¾åˆ°äº†å³ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºheights[k]çš„çŸ©å½¢å—ç´¢å¼•,å³i. å› æ­¤,è§£æ³•å°±å¾ˆç›´æ¥,ç»´æŠ¤å•è°ƒæ ˆçš„è¿‡ç¨‹ä¸­,æ¯å¼¹å‡ºä¸€ä¸ªçŸ©å½¢å—ç´¢å¼•i,åˆ™ä»¥å…¶é«˜åº¦heights[i]ä¸ºçŸ©å½¢é«˜åº¦,å®½åº¦ä¸º(i-peek()-1)æ¥è®¡ç®—å½“å‰é¢ç§¯,å¦‚æ­¤å…¶ä¸­çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆ.å…·ä½“ä»£ç è¿‡ç¨‹å¦‚ä¸‹: 12345678910111213141516171819public int largestRectangleArea(int[] heights) { Deque&lt;Integer&gt; stk = new ArrayDeque&lt;&gt;(); var ans = 0; for (int i = 0; i &lt; heights.length; i++) { while (!stk.isEmpty() &amp;&amp; heights[stk.peek()] &gt;= heights[i]) { var curIdx = stk.pop(); var leftIdx = stk.isEmpty() ? -1 : stk.peek(); ans = Math.max(ans, heights[curIdx] * (i - leftIdx - 1)); } stk.push(i); } var rightIdx = heights.length; while (!stk.isEmpty()) { var curIdx = stk.pop(); var leftIdx = stk.isEmpty() ? -1 : stk.peek(); ans = Math.max(ans, heights[curIdx] * (rightIdx - leftIdx - 1)); } return ans;} ç¨å¾®æ³¨æ„ä¸€ä¸‹è¾¹ç•Œé—®é¢˜, å½“å¼¹å‡ºæ ˆé¡¶çš„æ—¶å€™, å¦‚æœå·¦ä¾§æ²¡æœ‰å…ƒç´ ,å³æ ˆç©ºçš„æƒ…å†µä¸‹,å·¦ä¾§ç´¢å¼•å–-1. è€Œåœ¨éå†å®Œæˆå,æ ˆä¸ä¸ºç©º,åˆ™è¯´æ˜æ ˆä¸­æ¯ä¸ªå…ƒç´ çš„å³ä¾§ç´¢å¼•ä¸ºæ•°ç»„é•¿åº¦n(n=heights.length). 85.æœ€å¤§çŸ©å½¢è¿™ä¸€é¢˜æˆ‘ä»¬å°†å…¶æ¯ä¸€è¡Œçœ‹ä½œä¸€ä¸ª84é¢˜ä¸­çš„heightsæ•°ç»„,å› æ­¤åªéœ€è¦éå†æ¯ä¸€è¡Œçš„å­—ç¬¦,å¦‚æœä¸ºâ€™1â€™åˆ™æ›´æ–°heightsä¸­å¯¹åº”ç´¢å¼•çš„é«˜åº¦(+1),å¦‚æœä¸ºâ€™0â€™,åˆ™ç½®0.ç„¶ååº”ç”¨84çš„ç®—æ³•è®¡ç®—è¯¥è¡Œçš„æœ€å¤§çŸ©å½¢é¢ç§¯.æœ€ç»ˆå–æ¯ä¸€è¡Œè®¡ç®—çš„é¢ç§¯æœ€å¤§å€¼ä¸ºç­”æ¡ˆ. ä»£ç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839public int maximalRectangle(char[][] matrix) { if (matrix.length == 0) { return 0; } var heights = new int[matrix[0].length]; var ans = 0; for (int i = 0; i &lt; matrix.length; i++) { for (int j = 0; j &lt; matrix[i].length; j++) { if (matrix[i][j] == '1') { heights[j]++; } else { heights[j] = 0; } } ans = Math.max(ans, maxRec(heights)); } return ans;}// 84.int maxRec(int[] heights) { var ans = 0; Deque&lt;Integer&gt; stk = new ArrayDeque&lt;&gt;(); for (int i = 0; i &lt; heights.length; i++) { while (!stk.isEmpty() &amp;&amp; heights[stk.peek()] &gt;= heights[i]) { var curIdx = stk.pop(); var leftIdx = stk.isEmpty() ? -1 : stk.peek(); ans = Math.max(ans, heights[curIdx] * (i - leftIdx - 1)); } stk.push(i); } var rightIdx = heights.length; while (!stk.isEmpty()) { var curIdx = stk.pop(); var leftIdx = stk.isEmpty() ? -1 : stk.peek(); ans = Math.max(ans, heights[curIdx] * (rightIdx - leftIdx - 1)); } return ans;}","link":"/2022/05/27/summary-of-largest-rectangle/"},{"title":"Leetcode æ—‹è½¬æ’åºæ•°ç»„æœç´¢é—®é¢˜æ€»ç»“","text":"æœ¬ç¯‡æ–‡ç« ä¸»è¦å¯¹leetcodeä¸Šå…³äºæ—‹è½¬æ’åºæ•°ç»„æœç´¢é—®é¢˜çš„äºŒåˆ†è§£æ³•ä¸€ä¸ªæ€»ç»“, å…·ä½“é¢˜ç›®é›†æœ‰ä»¥ä¸‹å‡ ä¸ªé¢˜ç›® 33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ 81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II 153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ 154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II æˆ‘ä»¬å¯ä»¥æ ¹æ®æ’åºæ•°ç»„æ˜¯å¦å…è®¸é‡å¤å…ƒç´ å°†å…¶åˆ†ä¸ºå…ƒç´ ä¸å¯é‡å¤å’Œå¯é‡å¤ä¸¤ç±». å…ƒç´ ä¸å¯é‡å¤æ‰¾ç›®æ ‡å€¼å¯¹äºæ¯ä¸ªmidä½ç½®,æˆ‘ä»¬éƒ½æ ¹æ®ä»–å·¦ä¾§æœ‰åºè¿˜æ˜¯å³ä¾§æœ‰åºæ¥è€ƒè™‘æ˜¯å¦ç¼©å‡å·¦è¾¹ç•Œè¿˜æ˜¯å³è¾¹ç•Œ,æ¯”å¦‚è¯´å¯¹äºmidçš„å·¦ä¾§æœ‰åº(æ»¡è¶³nums[l]&lt;=nums[mid])åˆ™åˆ¤æ–­targetæ˜¯å¦è½åœ¨è¿™ä¸ªæœ‰åºåŒºé—´ä¸­,å¦‚æœæ˜¯åˆ™æ”¶ç¼©å³è¾¹ç•Œ,å¦åˆ™æ”¶ç¼©å·¦è¾¹ç•Œ,å…¶ä»–æƒ…å†µåŒç†. 12345678910111213141516171819202122232425262728// [33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„](https://leetcode-cn.com/problems/search-in-rotated-sorted-array/)func search(nums []int, target int) int { l, r := 0, len(nums)-1 for l &lt; r { mid := l + (r-l)/2 if nums[mid]==target { return mid } if nums[l]&lt;=nums[mid] { if target&lt;nums[mid]&amp;&amp;target&gt;=nums[l] { r = mid-1 }else { l = mid+1 } }else { if nums[mid]&lt;target&amp;&amp;target&lt;=nums[r]{ l = mid+1 }else { r = mid-1 } } } if target!=nums[l] { return -1 } return l} æ‰¾æœ€å°å€¼ä¸æ‰¾ç›®æ ‡å€¼ä¸åŒ,æ‰¾æœ€å°å€¼æˆ‘ä»¬åº”è¯¥å°†æ•°ç»„çœ‹ä½œä¸ºå±±,æ²¿ç€ä¸‹å¡çš„æ–¹å‘è¿›è¡Œç§»åŠ¨,å¯¹äºä¸€ä¸ªmid,å¦‚æœå·¦ä¾§æœ‰åº,å·¦ä¾§å’Œå³ä¾§éƒ½å¯èƒ½æ˜¯æœ€å°å€¼å­˜åœ¨çš„åŒºé—´,å› æ­¤æˆ‘ä»¬åº”è¯¥é€šè¿‡åˆ¤æ–­å³ä¾§æ˜¯å¦æœ‰åº,å¦‚æœæœ‰åº,åˆ™å½“å‰midåŠå·¦ä¾§ä¸ºæœ€å°å€¼å­˜åœ¨çš„åŒºé—´,å› æ­¤æ”¶ç¼©å³è¾¹ç•Œå³å¯.åä¹‹å½“å‰midåŠå·¦ä¾§å¿…å®šä¸å¯èƒ½ä¸ºæœ€å°å€¼å­˜åœ¨çš„åŒºé—´. 1234567891011121314// [153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/)func findMin(nums []int) int { l, r := 0, len(nums)-1 for l &lt; r { mid := l + (r-l)/2 if nums[mid]&lt;nums[r] { r = mid } else { l = mid+1 } } return nums[l]} å…ƒç´ å¯é‡å¤æ‰¾ç›®æ ‡å€¼åœ¨ä¸å¯é‡å¤çš„åŸºç¡€ä¸Šåªéœ€è¦å¤šåˆ¤æ–­ä¸€ä¸‹mid, l, rä¸‰è€…ä½ç½®çš„å€¼æ˜¯ä¸æ˜¯ä¸€æ ·, å½“ä¸€æ ·çš„æ—¶å€™æ— æ³•åˆ¤æ–­æ”¶ç¼©å·¦ä¾§è¿˜æ˜¯å³ä¾§, ä½†æ˜¯å¯ä»¥ç¡®å®šl, rä¸¤ä¸ªä½ç½®è‚¯å®šä¸æ˜¯target, å› æ­¤ç›´æ¥å·¦ç§»lå’Œå³ç§»rå³å¯ 1234567891011121314151617181920212223242526272829// [81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II](https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/)func search(nums []int, target int) bool { l, r := 0, len(nums)-1 for l &lt; r { mid := l + (r-l)/2 if nums[mid]==target { return true } if nums[mid]==nums[l]&amp;&amp;nums[mid]==nums[r] { l++ r-- }else if nums[l]&lt;=nums[mid] { if nums[l]&lt;=target &amp;&amp; target &lt; nums[mid] { r = mid-1 }else{ l = mid+1 } }else { if nums[mid]&lt;target&amp;&amp;target&lt;=nums[r] { l = mid+1 }else { r = mid-1 } } } return nums[l]==target} æ‰¾æœ€å°å€¼å’Œæ‰¾ç›®æ ‡å€¼ç±»ä¼¼,åœ¨ä¸å¯é‡å¤çš„åŸºç¡€,åŠ ä¸€ä¸ªmid, l, rä¸‰è€…çš„åˆ¤æ–­å³å¯. 1234567891011121314151617// [154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/)func findMin(nums []int) int { l, r := 0, len(nums)-1 for l &lt; r { mid := l + (r-l)/2 if nums[l]==nums[mid]&amp;&amp;nums[r]==nums[mid]{ l++ r-- }else if nums[mid]&lt;=nums[r]{ r = mid }else { l = mid+1 } } return nums[l]}","link":"/2022/04/14/summary-of-search-in-rotated-sorted-array/"},{"title":"ä¸¤ç§ç¿»è½¬sliceçš„æ–¹å¼å¯¹æ¯”","text":"åˆ·é¢˜æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼šå¯¹ä¸€ä¸ªsliceè¿›è¡Œç¿»è½¬ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä½¿ç”¨äº†ä¸¤ç§æ–¹å¼ï¼š æ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œä½¿ç”¨appendå·¦æ’å…¥çš„æ–¹å¼ å…ˆæ­£å¸¸appendå³æ’å…¥ï¼Œæœ€åå†å¯¹è¿™ä¸ªsliceè¿›è¡Œç¿»è½¬ ä¸¤ç§æ–¹å¼çš„å®ç°åŠæ—¶é—´å’Œç©ºé—´æ¶ˆè€—çš„å¯¹æ¯”å®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å®ç°çš„åŠŸèƒ½æ˜¯ä¸€è‡´çš„ æ–¹æ³•1ä½¿ç”¨å·¦æ’å…¥æ³•æ¥å®ç°ç¿»è½¬ï¼Œå¦‚ä¸‹æ‰€ç¤º 123456789101112func method1() { result := make([][]int, 0) for i := 0; i &lt; 100; i++ { item := make([]int, 0) for j := 0; j &lt; 10; j++ { item = append(item, i*j) } // å·¦æ’å…¥ join := [][]int{item} result = append(join, result...) }} æ–¹æ³•2å…ˆæ­£å¸¸appendï¼Œå†ç¿»è½¬ 123456789101112131415func method2() { result := make([][]int, 0) for i := 0; i &lt; 100; i++ { item := make([]int, 0) for j := 0; j &lt; 10; j++ { item = append(item, i*j) } result = append(result, item) } tmp := result result = make([][]int, 0) for i := len(tmp) - 1; i &gt;= 0; i-- { result = append(result, tmp[i]) }} æ€§èƒ½å¯¹æ¯” æ—¶é—´ 1234goos: darwingoarch: amd64BenchmarkMethod1-4 17006 69558 ns/opBenchmarkMethod2-4 43002 27851 ns/op æ—¶é—´ä¸Šï¼Œæ–¹æ³•2è¦å¥½äºæ–¹æ³•1 ç©ºé—´ ç©ºé—´ä¸Šï¼Œæ–¹æ³•2ä¹Ÿè¦ä¼˜äºæ–¹æ³•1 åˆ†æé€šè¿‡pprofå·¥å…·å¯¹å…¶æºç è¿›è¡Œåˆ†æå¦‚ä¸‹ ä»ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼Œresult = append(join, result...)è¯­å¥çš„å†…å­˜æ¶ˆè€—éå¸¸ä¸¥é‡ï¼ŒåŒæ—¶è¿™ç§æ–¹æ³•è¿›è¡Œappendï¼Œä¼šä½¿å¾—åœ°å€é‡æ–°åˆ†é…ï¼ˆå› ä¸ºé¦–åœ°å€æ”¹å˜äº†ï¼‰è‡´ä½¿å¤šä½™å†…å­˜å’Œæ—¶é—´çš„æ¶ˆè€—ã€‚ è¡¥å……æ–¹æ³•2çš„ç¿»è½¬å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•å®ç° å¦‚ä¸Šé¢æ‰€ç¤ºï¼Œé€šè¿‡sliceåå‘éå†æ’å…¥å®Œæˆç¿»è½¬ è¿˜å¯ä»¥é€šè¿‡åŒæŒ‡é’ˆæ³•æ¥ç¿»è½¬ è¿™é‡Œé€šè¿‡ä¸€ä¸ªç®€å•ä¾‹å­æ¯”è¾ƒä¸‹åŒæ–¹çš„æ€§èƒ½ 123456789101112131415161718192021222324func method1() { var input = make([]int, 0, 100) for i := 0; i &lt; len(input); i++ { input = append(input, i) } // method1 for i := 0; i &lt; len(input)/2; i++ { j := len(input) - 1 - i input[i], input[j] = input[j], input[i] }}func method2() { var input = make([]int, 0, 100) for i := 0; i &lt; len(input); i++ { input = append(input, i) } // method2 tmp := input input = make([]int, 0, 100) for i := len(tmp) - 1; i &gt;= 0; i-- { input = append(input, tmp[i]) }} ç»“æœè¡¨ç¤ºï¼ŒåŒæŒ‡é’ˆæ³•ä¼šæ›´å¥½ä¸€äº›ï¼Œç†ç”±å¾ˆç®€å•ï¼Œå› ä¸ºåŒæŒ‡é’ˆæ˜¯O(N/2)çš„ 123456$ go test -run=. -bench=. -benchmemgoos: darwingoarch: amd64BenchmarkMethod1-4 71840024 16.9 ns/op 0 B/op 0 allocs/opBenchmarkMethod2-4 26362216 39.7 ns/op 0 B/op 0 allocs/opPASS ç»“è®ºè¿™ç§æƒ…å†µä¸‹æ¨èä½¿ç”¨æ–¹æ³•2ï¼ŒåŒæ—¶å¯¹äºæ–¹æ³•1(å·¦æ’å…¥)çš„ä½¿ç”¨è¦æ ¼å¤–è°¨æ…ï¼Œä¸å½“çš„ä½¿ç”¨ä¼šä½¿å¾—ç¨‹åºçš„æ—¶/ç©ºé—´æ¶ˆè€—åŠ å‰§ã€‚","link":"/2021/04/16/two-way-to-reverse-slice/"},{"title":"unexpected error in pytorch backward","text":"åœ¨å†™æ¨¡å‹è®­ç»ƒçš„æ—¶å€™é‡åˆ°å¥‡æ€ªçš„æŠ¥é”™: 1RuntimeError: Trying to backward through the graph a second time, but the saved intermediate results have already been freed. Specify retain_graph=True when calling backward the first time. å‚è€ƒä¸€äº›ç½‘ä¸Šçš„è§£ç­”å’ŒæŠ¥é”™æç¤º,æ„æ€å°±æ˜¯æ‰§è¡Œbackwardçš„æ—¶å€™,ä¸­é—´ç»“æœå·²ç»è¢«é‡Šæ”¾äº†.ä¸€å¼€å§‹æ¯”è¾ƒçº³é—·åœ¨äº,æˆ‘ä»…ä»…å¢åŠ äº†ä¸€äº›å·ç§¯å±‚å’Œæ“ä½œåœ¨trainæ–¹æ³•é‡Œé¢,æ€ä¹ˆçªç„¶å°±ä¼šè¿›è¡Œè¯¥æŠ¥é”™å‘¢,å¹¶ä¸”ä¸­é—´ç»“æœéƒ½æ˜¯åœ¨trainæ–¹æ³•ä¸­,ä¸ä¼šå‡ºç°backwardçš„æ—¶å€™å·²ç»è¢«é‡Šæ”¾. ç»è¿‡ä»”ç»†å®¡æŸ¥,æœ‰ä¸ªåœ°æ–¹å­˜åœ¨æ¯”è¾ƒå¤§çš„é—®é¢˜, åœ¨æˆ‘çš„ä»£ç å‡ºæœ‰è¿™æ ·ä¸€ä¸ªé€»è¾‘ 12345678910for j, batch in enumerate(loader, 1): self.optimizer.zero_grad() # pre-handle some thing for i in range(1, len(images)): s = self.model(images[i]) y = label[i] acc = self.compute_accuracy(s.detach(), y) loss = self.compute_loss(s, y) loss.backward() self.optimizer.step() ä¸Šé¢è¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡å•¥é—®é¢˜, ä½†æ˜¯æ³¨æ„å¦‚æœpre-handleéƒ¨åˆ†å­˜åœ¨æœ‰è®¡ç®—å›¾çš„æ¢¯åº¦è®¡ç®—, è¿™ä¸€éƒ¨åˆ†ä¸­é—´ç»“æœåœ¨loss.backwardçš„æ—¶å€™å°±å·²ç»freeæ‰äº†,ç”±æ­¤ä¼šå¯¼è‡´ä¸€å¼€å§‹çš„é‚£ä¸ªæŠ¥é”™,è€Œæˆ‘æ­£å¥½åœ¨è¿™ä¸€éƒ¨åˆ†ä½œäº†ä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„æ“ä½œ: 123456789101112for j, batch in enumerate(loader, 1): self.optimizer.zero_grad() # pre-handle some thing # warning: æ³¨æ„è¿™ä¸€æ­¥ self.prev_ft = self.feature_extractor(images[0]) for i in range(1, len(images)): s = self.model(images[i]) y = label[i] acc = self.compute_accuracy(s.detach(), y) loss = self.compute_loss(s, y) loss.backward() self.optimizer.step() ä¸Šè¿°ä½¿ç”¨feature_extractoræŠ½å–images[0]çš„ç‰¹å¾, å› ä¸ºä¸æ˜¯å¤„äºtorch.no_grad()çš„wrapç¯å¢ƒä¸‹,å› æ­¤ä¼šè¿›è¡Œæ¢¯åº¦è®¡ç®—. è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•, å°†pre-handleçš„éƒ¨åˆ†ç”¨torch.no_grad()åŒ…æ‹¬èµ·æ¥å³å¯. 12345678910111213for j, batch in enumerate(loader, 1): self.optimizer.zero_grad() # pre-handle some thing with torch.no_grad(): self.prev_ft = self.feature_extractor(images[0]) for i in range(1, len(images)): s = self.model(images[i]) y = label[i] acc = self.compute_accuracy(s.detach(), y) loss = self.compute_loss(s, y) loss.backward() self.optimizer.step()","link":"/2022/05/18/unexpected-error-in-pytorch-backward/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","link":"/tags/SpringBoot/"},{"name":"gRPC","slug":"gRPC","link":"/tags/gRPC/"},{"name":"go","slug":"go","link":"/tags/go/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","link":"/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"æŒ‡é’ˆ","slug":"æŒ‡é’ˆ","link":"/tags/%E6%8C%87%E9%92%88/"},{"name":"gorm","slug":"gorm","link":"/tags/gorm/"},{"name":"pytorch","slug":"pytorch","link":"/tags/pytorch/"},{"name":"gpu","slug":"gpu","link":"/tags/gpu/"},{"name":"oom","slug":"oom","link":"/tags/oom/"},{"name":"algorithm","slug":"algorithm","link":"/tags/algorithm/"},{"name":"sliding window","slug":"sliding-window","link":"/tags/sliding-window/"},{"name":"network","slug":"network","link":"/tags/network/"},{"name":"socket","slug":"socket","link":"/tags/socket/"},{"name":"tcp","slug":"tcp","link":"/tags/tcp/"},{"name":"leetcode","slug":"leetcode","link":"/tags/leetcode/"},{"name":"backtrace","slug":"backtrace","link":"/tags/backtrace/"},{"name":"å•è°ƒæ ˆ","slug":"å•è°ƒæ ˆ","link":"/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"},{"name":"binary search","slug":"binary-search","link":"/tags/binary-search/"},{"name":"python","slug":"python","link":"/tags/python/"}],"categories":[{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"6.824","slug":"6-824","link":"/categories/6-824/"},{"name":"Golang","slug":"Golang","link":"/categories/Golang/"},{"name":"pytorch","slug":"pytorch","link":"/categories/pytorch/"},{"name":"é¢è¯•","slug":"é¢è¯•","link":"/categories/%E9%9D%A2%E8%AF%95/"},{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","link":"/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/categories/%E7%AE%97%E6%B3%95/"},{"name":"16ç§ä»£ç æ¨¡å¼","slug":"é¢è¯•/16ç§ä»£ç æ¨¡å¼","link":"/categories/%E9%9D%A2%E8%AF%95/16%E7%A7%8D%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%BC%8F/"}]}