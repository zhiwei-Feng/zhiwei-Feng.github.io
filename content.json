{"pages":[{"title":"about","text":"å…³äºæˆ‘æ­£åœ¨æ”»è¯»è®¡ç®—æœºç¡•å£«ï¼Œä¸»è¦ç ”ç©¶$\\mathtt{Video\\ Object\\ Segmentation}$ ä¸è¿‡AIå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¤ªç„å­¦äº†ï¼Œæˆ‘é€‰æ‹©è€å®æå¼€å‘ğŸ˜‘ |Program Lang| = Go/Python|Contact Me| = zhiwei.feng1995@gmail.com|University| = Fudan University|å…´è¶£| = ä¸­é—´ä»¶/åˆ†å¸ƒå¼/å¾®æœåŠ¡/äº‘åŸç”Ÿ/åŸºç¡€æ¶æ„","link":"/about/index.html"}],"posts":[{"title":"sliceä½¿ç”¨appendçš„å°å‘","text":"ä»Šå¤©åœ¨åˆ·ä¸€é“ç®—æ³•é¢˜çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå…³äºsliceåœ¨ä½¿ç”¨appendçš„å°ç»†èŠ‚é—®é¢˜ã€‚è¿™ä¸ªç®—æ³•é¢˜å¯ä»¥å‚è€ƒè·¯å¾„æ€»å’ŒIIã€‚é¢˜æ„å¾ˆç®€å•ï¼Œå°±æ˜¯ä»ä¸€ä¸ªäºŒå‰æ ‘ä¸­æ‰€æœ‰ç”±æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æ»¡è¶³è·¯å¾„å’Œç­‰äºtargetçš„è·¯å¾„ã€‚ é—®é¢˜åœ¨å‚è€ƒå®˜æ–¹é¢˜è§£çš„golangç‰ˆæœ¬çš„æ—¶å€™ï¼Œå‘ç°äº†æœ‰ä¸€æ®µä»£ç æ˜¯æˆ‘ä¸€å¼€å§‹æ²¡å¼„æ˜ç™½çš„ã€‚å®Œæ•´ä»£ç å¯å‚è€ƒ 1234567891011121314151617181920func pathSum(root *TreeNode, targetSum int) (ans [][]int) { path := []int{} var dfs func(*TreeNode, int) dfs = func(root *TreeNode, left int) { if root == nil { return } left -= root.Val path = append(path, root.Val) defer func() { path = path[:len(path)-1] }() if left == 0 &amp;&amp; root.Left == nil &amp;&amp; root.Right == nil { ans = append(ans, append([]int{}, path...)) return } dfs(root.Left, left) dfs(root.Right, left) } dfs(root, targetSum) return} å…¶ä¸­çš„ans = append(ans, append([]int{}, path...))åˆ™æ˜¯æˆ‘å…³æ³¨çš„åœ°æ–¹ï¼Œä¸€å¼€å§‹æˆ‘ç–‘æƒ‘ä¸ºä»€ä¹ˆä¸ç›´æ¥ans = append(ans, path))ï¼Œä½†æ˜¯å®éªŒè¯æ˜ç»“æœä¼šéå¸¸å¥‡æ€ªï¼Œæ¯”å¦‚å¯¹äºè¿™æ ·ä¸€ä¸ªä¾‹å­æˆ‘ä»¬æƒ³è¦çš„æ˜¯[[5,4,11,2],[5,8,4,5]]ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯[[5,8,4,1],[5,8,4,1]]. è§£æè¿™é‡Œå…¶å®æ˜¯æˆ‘å¿˜äº†golangä¸­çš„sliceåº•å±‚å®ç°å¦‚ä¸‹å›¾æ‰€ç¤º 12345type slice struct { array unsafe.Pointer len int cap int} å› æ­¤å¦‚æœåƒans = append(ans, path))è¿™æ ·åšï¼Œå…¶å®åœ¨anså­˜æ”¾çš„æ˜¯pathè¿™ä¸ªsliceï¼Œåœ¨åç»­ä»£ç è¿è¡Œä¸­çš„æ”¹å˜ä¼šå¯¼è‡´ansçš„ç»“æœæ”¹å˜ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªé”™è¯¯çš„ç»“æœã€‚è€Œans = append(ans, append([]int{}, path...))åˆ™æ˜¯åœ¨ansä¸­å­˜æ”¾äº†ä¸€ä¸ªpathçš„å‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬ä¸ä¼šè¢«å…¶ä»–ä»£ç ä¿®æ”¹åˆ°ã€‚å› æ­¤ç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚ ä¸€è¡Œä»£ç å°±æ­ç¤ºgolangä¸­sliceçš„æœ¬è´¨~ï¼ŒçœŸå®å¦™å•Šã€‚ REFERENCE[1] leetcode 113é¢˜[2] æ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°","link":"/2021/04/22/be-careful-when-use-append-to-add-slice-to-slice/"},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2021/04/03/hello-world/"},{"title":"é¢è¯•16ç§ä»£ç æ¨¡å¼æ€»ç»“(1) - æ»‘åŠ¨çª—å£","text":"æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹Grokking the Coding Interview: Patterns for Coding Questionsè¯¾ç¨‹çš„æ€»ç»“ï¼Œç¼–ç¨‹è¯­è¨€ä½¿ç”¨Goã€‚è¯»è€…å¦‚æœæƒ³è¦æ›´ç»†è‡´çš„äº†è§£ï¼Œè¯·è‡ªè¡Œè´­ä¹°è¯¾ç¨‹å­¦ä¹ ã€‚ é—®é¢˜èƒŒæ™¯åœ¨å¤„ç†æ•°ç»„å’Œé“¾è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦æ‰¾å‡ºæ»¡è¶³æŸäº›æ¡ä»¶çš„è¿ç»­å­åˆ—, æ¯”å¦‚å­åˆ—çš„å’Œæœ€å¤§ç­‰ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£çš„æ€æƒ³æ¥è¿›è¡Œè§£ç­”ã€‚è¿™é‡Œæ³¨æ„çš„æ˜¯å­åˆ—å¯ä»¥æ˜¯å›ºå®šå¤§å°ä¹Ÿå¯ä»¥æ˜¯å¯å˜å¤§å°ï¼Œä¸¤ç§æƒ…å†µæœ‰ç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚ ä¸‹é¢å…ˆç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åœ¨ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ¯ä¸ªsizeä¸ºKçš„è¿ç»­å­åˆ—çš„å¹³å‡å€¼ã€‚ 123Array: [1, 3, 2, 6, -1, 4, 1, 8, 2], K=5Output: [2.2, 2.8, 2.4, 3.6, 2.8] æ»‘åŠ¨çª—å£çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹: 123456789101112131415161718func findAveragesOfSubArraysBySlidingWindow(K int, arr []int) []float64 { results := make([]float64, len(arr)-K+1) windowSum := 0 windowStart := 0 for windowEnd := 0; windowEnd &lt; len(arr); windowEnd++ { // æŠŠä¸‹ä¸ªå…ƒç´ åŠ ä¸Š windowSum += arr[windowEnd] // æ»‘åŠ¨çª—å£ï¼Œç‰¹åˆ«åœ°ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°Kä¸ªåˆ™ä¸æ»‘åŠ¨ if windowEnd &gt;= K-1 { // å½“å‰windowSumè®¡ç®—äº†æ•´ä¸ªçª—å£çš„å’Œ results[windowStart] = float64(windowSum) / float64(K) // å½“å‰çª—å£è®¡ç®—å®Œåï¼Œç§»åŠ¨çª—å£éœ€è¦å…ˆå‡å»åŸæ¥çª—å£å¤´éƒ¨çš„å…ƒç´  windowSum -= arr[windowStart] windowStart++ } } return results} è§£æ³•æ€»ç»“æ ¹æ®çª—å£å¤§å°æ˜¯å¦å›ºå®šï¼Œåˆ†ä¸ºå›ºå®šå¤§å°å’Œå¯å˜å¤§å° å›ºå®šå¤§å°è¿™é‡Œæ‹¿ æ‰¾å‡ºsize=kçš„æœ€å¤§è¿ç»­å­åºåˆ—å’Œ ä½œä¸ºä¾‹å­ 12345678910Given an array of positive numbers and a positive number k,find the maximum sum of any contiguous subarray of size k.Input: [2, 1, 5, 1, 3, 2], k=3Output: 9Explanation: Subarray with maximum sum is [5, 1, 3].Input: [2, 3, 4, 1, 5], k=2Output: 7Explanation: Subarray with maximum sum is [3, 4]. è§£å†³æ–¹æ¡ˆ 123456789101112131415161718192021222324252627282930func max(x, y int) int { if x &gt; y { return x } else { return y }}func solution(arr []int, k int) int { var ( windowStart = 0 windowSum = 0 // ç”¨äºè®°å½•å½“å‰çª—å£çš„çŠ¶æ€ maxSum = 0 // ç”¨äºè®°å½•æœ€å¥½çš„çŠ¶æ€ ) for windowEnd:=0;windowEnd&lt;len(arr);windowEnd++{ // è¿™ä¸€æ­¥æ˜¯çª—å£çš„å³ä¾§è¿›è¡Œä¸€æ ¼æ‰©å¼ ï¼ŒåŒæ—¶æ›´æ–°å½“å‰çª—å£çš„çŠ¶æ€ windowSum += arr[windowEnd] // åˆ¤æ–­å½“å‰çª—å£æ˜¯å¦æ»¡è¶³ç›¸åº”æ¡ä»¶ if windowEnd &gt;= k-1{ // æ›´æ–°æœ€å¥½çš„çŠ¶æ€ maxSum = max(maxSum, windowSum) // æ”¶ç¼©çª—å£å·¦ä¾§ windowSum -= arr[windowStart] windowStart-- } } return maxSum} ç›¸å…³ç»ƒä¹ : [1][2][3] å¯å˜å¤§å°è¿™é‡Œé€šè¿‡é•¿åº¦æœ€å°çš„å­æ•°ç»„æ¥è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142func min(i, j int) int { if i&lt;j { return i }else{ return j }}func minSubArrayLen(target int, nums []int) int { var( windowStart = 0 windowSum = 0 minSize = -1 ) for windowEnd:=0;windowEnd&lt;len(nums);windowEnd++{ // çª—å£å³ä¾§æ‰©å¼ ï¼Œè¿™ä¸ªéƒ¨åˆ†å’Œå›ºå®šå¤§å°æ˜¯ä¸€æ ·çš„ windowSum+=nums[windowEnd] // è¿™ä¸ªéƒ¨åˆ†æ˜¯ä¸å›ºå®šå¤§å°ç±»å‹æœ€å¤§çš„åŒºåˆ« // ä¸åŒäºå›ºå®šå¤§å°æ¯æ¬¡çš„å³ä¾§æ‰©å¼ å’Œå·¦ä¾§æ”¶ç¼©æ˜¯åŒæ­¥çš„ // å¯å˜å¤§å°çš„å·¦ä¾§æ”¶ç¼©éœ€è¦å¾ªç¯åˆ¤æ–­çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶ // å¯èƒ½å³ä¾§æ‰©å¼ äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯å·¦ä¾§æ‰æ”¶ç¼©ä¸€å› // ä¹Ÿå¯èƒ½å³ä¾§æ‰©å¼ ä¸€æ¬¡ï¼Œå·¦ä¾§éœ€è¦æ”¶ç¼©å‡ å› for windowSum&gt;=target{ if minSize==-1{ minSize = windowEnd-windowStart+1 }else{ minSize = min(minSize, windowEnd-windowStart+1) } windowSum-=nums[windowStart] windowStart++ } // å¯¹äºä¸€äº›æƒ…å†µæ¡ä»¶éœ€è¦è¿›è¡Œåå¤„ç†ï¼Œæ¯”å¦‚å½“æ”¶ç¼©çª—å£ç›´åˆ°çª—å£å†…å•ä¸€å­—ç¬¦æ•°é‡&lt;k // ç„¶åå†æ¯”è¾ƒå½“å‰çª—å£çš„å¤§å° } if minSize==-1{ return 0 } return minSize} ç›¸å…³ç»ƒä¹ é¢˜: [1][2][3][4][5][6][7] ç‰¹æ®Šä¾‹å­æœ€å°è¦†ç›–å­ä¸²åŸé¢˜è§leetcode 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051func findSubstring(str, pattern string) string { // è¾¹ç•Œ if len(pattern)&gt;len(str){ return &quot;&quot; } var ( windowStart = 0 matched = 0 minLength = len(str) + 1 subStrStart = 0 patternMap = make(map[byte]int) ) for i := 0; i &lt; len(pattern); i++ { patternMap[pattern[i]]++ } for windowEnd := 0; windowEnd &lt; len(str); windowEnd++ { wright := str[windowEnd] if _, ok := patternMap[wright]; ok { patternMap[wright]-- // å…³é”®ç‚¹1, ä¸å†æ˜¯==0ï¼Œè€Œæ˜¯&gt;=0ï¼Œå› ä¸ºåŒ…å«æ‰€æœ‰çš„å­—ç¬¦ if patternMap[wright] &gt;= 0 { matched++ } } // å¦‚æœå½“å‰windowåŒ…å«patternæ‰€æœ‰çš„å­—ç¬¦ï¼Œåˆ™ä»å·¦æ”¶ç¼©çª—å£è‡³ä¸å®Œå…¨åŒ…å«çŠ¶æ€ // æ³¨æ„è¿™é‡Œç­‰å·å³ä¾§ä¸æ˜¯len(patternMap)ï¼Œå› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰å­—ç¬¦ for matched == len(pattern) { if minLength &gt; windowEnd-windowStart+1 { minLength = windowEnd - windowStart + 1 subStrStart = windowStart } wleft := str[windowStart] if _, ok := patternMap[wleft]; ok { // å…³é”®ç‚¹2ï¼Œåªè¦æœ‰ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ç§»é™¤äº†çª—å£ï¼Œåˆ™åœæ­¢æ”¶ç¼© if patternMap[wleft] == 0 { matched-- } patternMap[wleft]++ } windowStart++ } } if minLength &gt; len(str) { return &quot;&quot; } else { return str[subStrStart : subStrStart+minLength] }} FAQ: è¿™é‡Œå¯¹ä¸Šè¿°ä»£ç åšä¸€å®šçš„è§£é‡Šï¼Œä¸»è¦å›°æƒ‘ç‚¹åœ¨äºä¸¤ä¸ªå…³é”®ç‚¹Q: ä¸ºä»€ä¹ˆå…³é”®ç‚¹1å¤„æ˜¯&gt;=0ï¼ŸA: å› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œå› ä¸ºæ¯é‡åˆ°ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å­—ç¬¦ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹patternMapä¸­å¯¹åº”å€¼åšå‡æ³•å¹¶matched++, ç›´åˆ°æˆ‘ä»¬åŒ¹é…å®Œäº†patternæ‰€æœ‰è¯¥å­—ç¬¦ï¼Œæ­¤æ—¶å¯¹äºå¤šä½™è¯¥å­—ç¬¦æˆ‘ä»¬åªéœ€è¦æ›´æ–°patternMapï¼Œä½†æ˜¯ä¸å¿…å†æ›´æ–°matchedã€‚ Q: ä¸ºä»€ä¹ˆå…³é”®ç‚¹2å¤„æ˜¯==0ï¼ŸA: è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœçª—å£åŒä¸€ä¸ªå­—ç¬¦æ²¡æœ‰å†—ä½™ï¼Œé‚£ä¹ˆç§»é™¤äº†ä¸€ä¸ªè¯¥å­—ç¬¦åˆ™æ„å‘³ç€åŒ¹é…ä¸å®Œå…¨ï¼Œä½†æ˜¯å¦‚æœçª—å£å†…è¯¥å­—ç¬¦æœ‰å†—ä½™ï¼Œæ¯”å¦‚patternæ˜¯aabï¼Œè€Œçª—å£å†…æœ‰3ä¸ªaï¼Œæ­¤æ—¶aæœ‰å†—ä½™ï¼Œå¦‚æœæ”¶ç¼©çª—å£åªç§»å‡ºäº†ä¸€ä¸ªaï¼Œé‚£ä¹ˆæ­¤æ—¶çª—å£ä¾ç„¶æ˜¯æ»¡è¶³åŒ¹é…å®Œå…¨æ¡ä»¶çš„ï¼Œåæ˜ åˆ°ä»£ç ä¸Šï¼Œæ”¶ç¼©å‰patternMap['a'] = -1 (åœ¨2çš„åŸºç¡€-3)ï¼Œæ”¶ç¼©åpatternMap['a']=0ï¼Œå› æ­¤å¦‚æœæ”¶ç¼©æ‰ä¸‹ä¸€ä¸ªaï¼Œåˆ™éœ€è¦matchedâ€“äº†ã€‚ ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²åŸé¢˜è§leetcodeè¿™ä¸ªé¢˜ç›®ä¸»è¦è¦å¯¹é¢˜æ„ç†è§£æ¸…æ¥šï¼Œé¦–å…ˆç›®æ ‡å­ä¸²éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š é•¿åº¦ç­‰äºå•è¯åˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯é•¿åº¦*å•è¯ä¸ªæ•° å­ä¸²ä¸å¯ä»¥å‡ºç°ä¸åœ¨åˆ—è¡¨ä¸Šçš„å…¶ä»–å•è¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748func findWordConcatenation(str string, words []string) []int { if len(words)==0||len(str)==0{ return []int{} } var ( wordFreqMap = make(map[string]int) wordsCount = len(words) wordLength = len(words[0]) // å­˜å‚¨æ»¡è¶³æ¡ä»¶çš„index startIndex = make([]int, 0, 10) ) // è®°å½•æ¯ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡ for _, v := range words { wordFreqMap[v]++ } // æ³¨æ„è¿™ä¸ªä¸æ˜¯å¸¸è§„çš„sliding window pattern // iè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå­ä¸²çš„èµ·å§‹ä½ç½®ï¼Œä»æ¡ä»¶å¯çŸ¥æ¯ä¸ªå­ä¸²æ˜¯å›ºå®šé•¿åº¦çš„ // æ‰€ä»¥iæœ€å¤§ä¸ºlen(str)-wordLength*wordsCount for i := 0; i &lt;= len(str)-wordLength*wordsCount; i++ { wordsSeenMap := make(map[string]int) // key1: ä¿å­˜çœ‹è¿‡çš„wordçš„æ•°é‡ // å¯¹ä»å½“å‰index iå¼€å§‹çš„é•¿åº¦ä¸ºwordLength*wordsCountçš„stringè¿›è¡Œåˆ¤å®š for j := 0; j &lt; wordsCount; j++ { nextWordIndex := i + j*wordLength // å½“å‰wordçš„å¼€å§‹index word := str[nextWordIndex : nextWordIndex+wordLength] // å¦‚æœå‡ºç°ä¸åœ¨wordsæ•°ç»„ä¸­çš„wordï¼Œåˆ™ç›´æ¥è·³å‡º if _, ok := wordFreqMap[word]; !ok { break } wordsSeenMap[word]++ // å¦‚æœwordsæ•°ç»„ä¸­æŸä¸ªwordæ•°é‡å‡ºç°æ¬¡æ•°è¿‡å¤šæ„å‘³ç€ä¸€å®šä¼šæœ‰å…¶ä»–å•è¯ä¸åœ¨ï¼Œåˆ™ä¹Ÿç›´æ¥è·³å‡º if wordsSeenMap[word] &gt; wordFreqMap[word] { break } // å¦‚æœéå†åˆ°è¯¥stringçš„æœ€åä¸€ä¸ªå­—ç¬¦éƒ½æ²¡è·³å‡ºå¾ªç¯ï¼Œæ„å‘³è¯¥stringæ˜¯æ»¡è¶³æ¡ä»¶çš„ if j == wordsCount-1 { startIndex = append(startIndex, i) } } // ===end=== } return startIndex} REFERENCE[1] https://www.educative.io/courses/grokking-the-coding-interview[2] https://github.com/zhiwei-Feng/Golang-Grokking-the-Coding-Interview-Patterns-for-Coding-Questions","link":"/2021/04/04/sliding-window/"},{"title":"ä»6.824çš„kv.goç†è§£tcpåè®®","text":"æœ¬æ–‡æ˜¯åœ¨å­¦ä¹ 6.824è¯¾ç¨‹æ—¶ï¼Œå¯¹Lec 2çš„kv.goäº§ç”Ÿçš„å›°æƒ‘çš„è§£é‡Šå’Œæ€»ç»“ã€‚ kv.goé¦–å…ˆå¯¹kv.goçš„æƒ…å†µè¿›è¡Œè§£é‡Šã€‚è¿™é‡Œåªä¼šå–ä¸€äº›é‡ç‚¹ç‰‡æ®µè¿›è¡Œè§£é‡Šï¼Œéœ€è¦\bäº†è§£å®Œæ•´ä»£ç ç»†èŠ‚çš„ï¼Œè¯»è€…å¯è‡ªè¡Œé€‰æ‹©æ–‡ç« æœ€åçš„å‚è€ƒæ¡ç›®è¿›è¡Œè¯¦ç»†äº†è§£ã€‚ ä¸»é€»è¾‘12345678910func main() { //å¯åŠ¨rpcæœåŠ¡ï¼Œä¸€ä¸ªkvå­˜å‚¨ server() //å†™å…¥ä¸€ä¸ªkvé”®å€¼å¯¹ put(&quot;subject&quot;, &quot;6.824&quot;) fmt.Printf(&quot;Put(subject, 6.824) done\\n&quot;) //è¯»å‡ºåˆšæ‰å­˜å‚¨çš„keyçš„value fmt.Printf(&quot;get(subject) -&gt; %s\\n&quot;, get(&quot;subject&quot;))} ä¸»é€»è¾‘éå¸¸ç®€å•ï¼Œå¯åŠ¨ä¸€ä¸ªkvå­˜å‚¨çš„rpcæœåŠ¡ï¼Œç„¶åè¿è¡Œç®€å•çš„è¯»å†™åŠŸèƒ½æµ‹è¯•ã€‚ server()123456789101112131415161718192021func server() { kv := new(KV) kv.data = map[string]string{} rpcs := rpc.NewServer() rpcs.Register(kv) l, e := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;) if e != nil { log.Fatal(&quot;listen error:&quot;, e) } go func() { for { conn, err := l.Accept() if err == nil { go rpcs.ServeConn(conn) } else { break } } l.Close() }()} å¯åŠ¨æœåŠ¡ï¼Œç›‘å¬1234ç«¯å£ï¼Œå¹¶å¼€å§‹æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ client12345678910111213141516171819202122func get(key string) string { client := connect() args := GetArgs{key} reply := GetReply{} err := client.Call(&quot;KV.Get&quot;, &amp;args, &amp;reply) if err != nil { log.Fatal(&quot;error:&quot;, err) } client.Close() return reply.Value}func put(key string, val string) { client := connect() args := PutArgs{key, val} reply := PutReply{} err := client.Call(&quot;KV.Put&quot;, &amp;args, &amp;reply) if err != nil { log.Fatal(&quot;error:&quot;, err) } client.Close()} å®¢æˆ·ç«¯æ–¹æ³•æ€»ä½“é€»è¾‘æ˜¯ä¸€è‡´ï¼Œé¦–å…ˆè¿›è¡Œtcpè¿æ¥çš„å»ºç«‹ï¼Œç„¶åè¿›è¡Œrpcæ–¹æ³•è°ƒç”¨ï¼Œæœ€åå…³é—­è¿æ¥ è§£æè¿‡ç¨‹å¦‚æœä½ è¿è¡Œè¯¥ç¨‹åºï¼Œä¼šå‘ç°æ‰“å°å¦‚ä¸‹ï¼š 12345$ go run kv.goPut(subject, 6.824) doneget(subject) -&gt; 6.824$ ä¸ºä»€ä¹ˆç¨‹åºæœ€åä¼šé€€å‡ºï¼Œè€Œä¸æ˜¯å› ä¸ºserveråœ¨ç›‘å¬é˜»å¡ä½ã€‚æˆ‘è‡ªå·±çš„è§£é‡Šæ˜¯ï¼šé¦–å…ˆæ˜¯å› ä¸ºserver()ä¸­çš„æ— é™æ¥æ”¶è¯·æ±‚çš„å¾ªç¯æ˜¯è¿è¡Œåœ¨goroutineå½“ä¸­ï¼Œæ‰€ä»¥ä¹‹åçš„å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥å¹¶å‘çš„è¿è¡Œï¼›å…¶æ¬¡å› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰å…¶ä»–æ–¹æ³•çš„é˜»å¡ï¼Œæ‰€ä»¥ä¼šåœ¨æ‰€æœ‰é€»è¾‘ç»“æŸåé€€å‡ºï¼Œä¹Ÿæ„å‘³è¯¥è¿›ç¨‹é€€å‡ºäº†ï¼Œè¿™æ ·å…¶ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç»“æŸï¼ŒåŒ…æ‹¬å…¶ä¸­åˆ›å»ºçš„goroutineã€‚ å¦‚æœè¯»è€…æœ‰æ›´å¥½çš„è§£é‡Šæ¬¢è¿ç•™è¨€è®¨è®ºã€‚ åœ¨è¯¥ç¨‹åºçš„ä¸»é€»è¾‘ä¸­ï¼Œå®é™…å‘ç”Ÿäº†ä¸¤æ¬¡tcpè¿æ¥ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€æ¬¡tcpåè®®çš„è¿è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥åˆ›å»ºã€æ•°æ®ä¼ é€å’Œè¿æ¥ç»ˆæ­¢ã€‚server()ä¸‹å¼€å¯çš„rpcæœåŠ¡ç›‘å¬ç€1234ç«¯å£ï¼Œè€Œgetå’Œput()ä¸­çš„connect()åˆ™å®Œæˆä¸€æ¬¡tcpè¿æ¥åˆ›å»ºçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚å›¾ä¸‹ æ­¤æ—¶é€šè¿‡netstatå‘½ä»¤æŸ¥çœ‹ä¼šå‡ºç°æœ‰ä¸¤ä¸ªè¿æ¥ä»¥åŠä¸€ä¸ªç›‘å¬ å½“æ•°æ®ä¼ é€å®Œæ¯•ï¼Œgetå’Œput()è°ƒç”¨Close()æ–¹æ³•è¿›å…¥è¿æ¥ç»ˆæ­¢é˜¶æ®µï¼ˆå››æ¬¡æ¡æ‰‹ï¼‰åï¼Œå®¢æˆ·ç«¯çŠ¶æ€åˆ™ä¼šè¿›å…¥TIME_WAITçŠ¶æ€ ç­‰å¾…2MSLåï¼Œå®¢æˆ·ç«¯Closeã€‚ å¦‚æœå¸Œæœ›å¯¹TIME_WAITçš„è®¾è®¡æƒ³è¦æ›´æ·±å…¥äº†è§£ï¼Œå¯ä»¥å‚è€ƒä¸ºä»€ä¹ˆ TCP åè®®æœ‰ TIME_WAIT çŠ¶æ€ REFERENCE[1] 6.824 kv.go[2] ç»´åŸºç™¾ç§‘","link":"/2021/04/11/socket-analysis-for-6-824-kv-go/"},{"title":"ä¸¤ç§ç¿»è½¬sliceçš„æ–¹å¼å¯¹æ¯”","text":"åˆ·é¢˜æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼šå¯¹ä¸€ä¸ªsliceè¿›è¡Œç¿»è½¬ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä½¿ç”¨äº†ä¸¤ç§æ–¹å¼ï¼š æ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œä½¿ç”¨appendå·¦æ’å…¥çš„æ–¹å¼ å…ˆæ­£å¸¸appendå³æ’å…¥ï¼Œæœ€åå†å¯¹è¿™ä¸ªsliceè¿›è¡Œç¿»è½¬ ä¸¤ç§æ–¹å¼çš„å®ç°åŠæ—¶é—´å’Œç©ºé—´æ¶ˆè€—çš„å¯¹æ¯”å®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å®ç°çš„åŠŸèƒ½æ˜¯ä¸€è‡´çš„ æ–¹æ³•1ä½¿ç”¨å·¦æ’å…¥æ³•æ¥å®ç°ç¿»è½¬ï¼Œå¦‚ä¸‹æ‰€ç¤º 123456789101112func method1() { result := make([][]int, 0) for i := 0; i &lt; 100; i++ { item := make([]int, 0) for j := 0; j &lt; 10; j++ { item = append(item, i*j) } // å·¦æ’å…¥ join := [][]int{item} result = append(join, result...) }} æ–¹æ³•2å…ˆæ­£å¸¸appendï¼Œå†ç¿»è½¬ 123456789101112131415func method2() { result := make([][]int, 0) for i := 0; i &lt; 100; i++ { item := make([]int, 0) for j := 0; j &lt; 10; j++ { item = append(item, i*j) } result = append(result, item) } tmp := result result = make([][]int, 0) for i := len(tmp) - 1; i &gt;= 0; i-- { result = append(result, tmp[i]) }} æ€§èƒ½å¯¹æ¯” æ—¶é—´ 1234goos: darwingoarch: amd64BenchmarkMethod1-4 17006 69558 ns/opBenchmarkMethod2-4 43002 27851 ns/op æ—¶é—´ä¸Šï¼Œæ–¹æ³•2è¦å¥½äºæ–¹æ³•1 ç©ºé—´ ç©ºé—´ä¸Šï¼Œæ–¹æ³•2ä¹Ÿè¦ä¼˜äºæ–¹æ³•1 åˆ†æé€šè¿‡pprofå·¥å…·å¯¹å…¶æºç è¿›è¡Œåˆ†æå¦‚ä¸‹ ä»ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼Œresult = append(join, result...)è¯­å¥çš„å†…å­˜æ¶ˆè€—éå¸¸ä¸¥é‡ï¼ŒåŒæ—¶è¿™ç§æ–¹æ³•è¿›è¡Œappendï¼Œä¼šä½¿å¾—åœ°å€é‡æ–°åˆ†é…ï¼ˆå› ä¸ºé¦–åœ°å€æ”¹å˜äº†ï¼‰è‡´ä½¿å¤šä½™å†…å­˜å’Œæ—¶é—´çš„æ¶ˆè€—ã€‚ è¡¥å……æ–¹æ³•2çš„ç¿»è½¬å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•å®ç° å¦‚ä¸Šé¢æ‰€ç¤ºï¼Œé€šè¿‡sliceåå‘éå†æ’å…¥å®Œæˆç¿»è½¬ è¿˜å¯ä»¥é€šè¿‡åŒæŒ‡é’ˆæ³•æ¥ç¿»è½¬ è¿™é‡Œé€šè¿‡ä¸€ä¸ªç®€å•ä¾‹å­æ¯”è¾ƒä¸‹åŒæ–¹çš„æ€§èƒ½ 123456789101112131415161718192021222324func method1() { var input = make([]int, 0, 100) for i := 0; i &lt; len(input); i++ { input = append(input, i) } // method1 for i := 0; i &lt; len(input); i++ { j := len(input) - 1 - i input[i], input[j] = input[j], input[j] }}func method2() { var input = make([]int, 0, 100) for i := 0; i &lt; len(input); i++ { input = append(input, i) } // method2 tmp := input input = make([]int, 0, 100) for i := len(tmp) - 1; i &gt;= 0; i-- { input = append(input, tmp[i]) }} ç»“æœè¡¨ç¤ºï¼ŒåŒæŒ‡é’ˆæ³•ä¼šæ›´å¥½ä¸€äº›ï¼Œç†ç”±å¾ˆç®€å•ï¼Œå› ä¸ºåŒæŒ‡é’ˆæ˜¯O(N/2)çš„ 1234goos: darwingoarch: amd64BenchmarkMethod1-4 64120593 17.6 ns/op BenchmarkMethod2-4 29222400 40.8 ns/op ç»“è®ºè¿™ç§æƒ…å†µä¸‹æ¨èä½¿ç”¨æ–¹æ³•2ï¼ŒåŒæ—¶å¯¹äºæ–¹æ³•1(å·¦æ’å…¥)çš„ä½¿ç”¨è¦æ ¼å¤–è°¨æ…ï¼Œä¸å½“çš„ä½¿ç”¨ä¼šä½¿å¾—ç¨‹åºçš„æ—¶/ç©ºé—´æ¶ˆè€—åŠ å‰§ã€‚ å¦‚æœæœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…å¯¹ä¸Šè¿°ç¨‹åºæœ‰æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿ä¸‹æ–¹è¯„è®º~","link":"/2021/04/16/two-way-to-reverse-slice/"}],"tags":[{"name":"go","slug":"go","link":"/tags/go/"},{"name":"æŒ‡é’ˆ","slug":"æŒ‡é’ˆ","link":"/tags/%E6%8C%87%E9%92%88/"},{"name":"hello","slug":"hello","link":"/tags/hello/"},{"name":"algorithm","slug":"algorithm","link":"/tags/algorithm/"},{"name":"sliding window","slug":"sliding-window","link":"/tags/sliding-window/"},{"name":"network","slug":"network","link":"/tags/network/"},{"name":"socket","slug":"socket","link":"/tags/socket/"},{"name":"tcp","slug":"tcp","link":"/tags/tcp/"}],"categories":[{"name":"Golang","slug":"Golang","link":"/categories/Golang/"},{"name":"hello","slug":"hello","link":"/categories/hello/"},{"name":"é¢è¯•","slug":"é¢è¯•","link":"/categories/%E9%9D%A2%E8%AF%95/"},{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","link":"/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"16ç§ä»£ç æ¨¡å¼","slug":"é¢è¯•/16ç§ä»£ç æ¨¡å¼","link":"/categories/%E9%9D%A2%E8%AF%95/16%E7%A7%8D%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%BC%8F/"}]}