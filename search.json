[{"title":"2021å¹´ä¸ªäººæ€»ç»“","url":"/2022/01/01/2021summary/","content":"2021å¹´å°±è¿™æ ·æ‚„æ‚„è¿‡å»äº†ï¼Œå›é¦–è¿™ä¸€å¹´ï¼Œæ„Ÿè§‰é—æ†¾å¤šäºæ”¶è´§ï¼Œè‹¦é—·å¤§äºå¹¸ç¦å§ã€‚è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡åšè¿™æ ·ä¸€ä¸ªä¸ªäººçš„å¹´åº¦æ€»ç»“ï¼Œå¸Œæœ›èƒ½å°†è¿™ä¸ªä¹ æƒ¯å»¶ç»­ä¸‹å»ï¼ŒèŠ±çŸ­çŸ­çš„å‡ ä¸ªå°æ—¶æ¥å¯¹è¿‡å»ä¸€å¹´è‡ªå·±çš„è¡¨ç°è¿›è¡Œè‡ªè¯„è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œä¸‹é¢å°±å¼€å§‹å§ã€‚\nä¸ŠåŠå¹´åº”è¯¥è¯´æ•´ä¸ªä¸ŠåŠå¹´æ˜¯é™·å…¥äº†æ¾æ‡ˆçš„é™·é˜±äº†ï¼Œè¿™ä¸€ç‚¹å¹¶ä¸æ˜¯è¯´æˆ‘æŠŠå¿ƒæ€èŠ±åœ¨ç©å„¿æˆ–è€…ä»€ä¹ˆå…¶ä»–çš„äº‹æƒ…ä¸Šäº†ï¼Œè€Œæ˜¯å•çº¯åœ°åœ¨è‡ªå·±åº”è¯¥åšçš„äº‹æƒ…ä¸Šå˜å¾—ä½æ•ˆã€‚é¦–å…ˆä¸ŠåŠå¹´æ˜¯ä¸ªäººä»ç ”ä¸€åˆ°ç ”äºŒçš„ä¸ŠåŠæˆªçš„ä¸€ä¸ªè¿‡ç¨‹å§ï¼Œè¿™ä¸ªé˜¶æ®µå…¶å®ç§‘ç ”ä»»åŠ¡æ˜¯æ¯”è¾ƒç¹é‡ã€åˆæœ‰ä¸€å †è¯¾ç¨‹å’Œå¯¼å¸ˆåŠ©æ•™çš„ä»»åŠ¡ï¼Œæ‰€ä»¥å…¶å®åœ¨ä¸€å¤©æ—¶é—´é‡Œæ˜¯æœ‰ç¢ç‰‡åŒ–ï¼Œæ¯”è¾ƒå¸¸è§çš„çŠ¶æ€å°±æ˜¯ä¸Šåˆåˆšå¼„å®ŒåŠ©æ•™çš„äº‹æƒ…ï¼Œç„¶åä¸‹åˆå°±è¦ä¸Šè¯¾ï¼Œæ™šä¸Šå†ç»§ç»­å›å®éªŒå®¤æå®éªŒã€‚åŠ©æ•™çš„è¿‡ç¨‹ä¸­å› ä¸ºä¸€äº›å½•è¯¾æ–¹é¢çš„è¦æ±‚å…¶å®åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰æ—¶é—´å»åˆ†ç»™å…¶ä»–çš„äº‹æƒ…çš„ï¼ˆæƒ³å»å†™å†™ä»£ç å•¥çš„ï¼Œä½†æ˜¯æ¯5åˆ†é’Ÿå°±è¦æŠ¬å¤´å»æ‹ç…§å¹¶å‘åˆ°è¯¾ç¨‹ç¾¤ï¼Œå®åœ¨æ˜¯ä½æ•ˆï¼Œåˆ°åæœŸå°±æ¼”å˜ä¸ºéšä¾¿çœ‹ç‚¹ä¸œè¥¿æ··äº†ï¼‰ã€‚è€Œä¸‹åˆä¸€èˆ¬ç ”ç©¶ç”Ÿçš„è¯¾å€’è¿˜æ˜¯ä¸é”™çš„ï¼Œå¯ä»¥åšåšè‡ªå·±çš„äº‹æƒ…ï¼Œå½“ç„¶å…¶å®åé¢å› ä¸ºä¸€äº›åŸå› ï¼Œåœ¨æŸäº›è¯¾ç¨‹ä»»åŠ¡æ¯”è¾ƒé‡ï¼Œè€Œç»„å‘˜åˆå‡ ä¹çš„æ‘†çƒ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¹Ÿå…¨æƒè´Ÿè´£äº†ä¸€ä¸ªå°ç»„æ•´ä¸ªè¯¾ç¨‹çš„æ‰€æœ‰ä½œä¸šï¼ŒåŒ…æ‹¬æœŸæœ«çš„projectï¼Œè¿™ä¸€ç‚¹å…¶å®ä¹Ÿè€—è´¹äº†æˆ‘å¹³æ—¶æ¯”è¾ƒå¤šçš„æ—¶é—´å§ã€‚\næœ€åè¯´è¯´è®©æˆ‘è§‰å¾—æ‰å…¥æ¾æ‡ˆé™·é˜±çš„æœ€ç›´æ¥æºå¤´ï¼šç§‘ç ”å®éªŒã€‚è¯´å®è¯ï¼Œæœ€åˆè¿˜æ˜¯æƒ³å¥½å¥½åœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šåšç‚¹ä¸œè¥¿å‡ºæ¥çš„ï¼Œç»“æœå¯¼å¸ˆçš„ä¸€è¨€å ‚å’Œæ¯«æ— å®æ“æ ¹æ®çš„æƒ³æ³•ï¼Œç£¨ç­äº†æˆ‘å¯¹ç§‘ç ”æˆ–è€…è¯´æ˜¯ç®—æ³•çš„å…´è¶£å§ï¼Œå…¶å®æˆ‘ä¹Ÿæ¸…æ¥šä¼ä¸šé‡Œçš„ç®—æ³•å·¥ç¨‹ä¼šå®å®åœ¨åœ¨çš„å¤šï¼Œä¹Ÿæ›´æœ‰è¶£çš„å¤šï¼ˆå› ä¸ºæˆ‘å¯¹èƒ½å¤Ÿè½åœ°èƒ½å¤Ÿåº”ç”¨äº§ç”Ÿä»·å€¼çš„ä¸œè¥¿æœ‰å¤©ç”Ÿçš„å¥½æ„Ÿï¼‰ã€‚ä½†æ˜¯å¯èƒ½å’Œå¿ƒæ€æœ‰å…³å§ï¼Œåœ¨å’Œå¯¼å¸ˆç–¯ç‹‚æ‹‰æ‰¯çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿä»æœ€å¼€å§‹ä¸åœæ€è€ƒå¯ä»¥è§£å†³éš¾é¢˜çš„ç‚¹ï¼ˆå½“ç„¶ä¸€èˆ¬æ¥è¯´æ˜¯ä¸workï¼Œå³ä¾¿workï¼Œä¹Ÿå¸¸å¸¸ä¼šè¢«è€å¸ˆè¯´æ²¡ä»€ä¹ˆåˆ›æ–°ç‚¹ï¼‰ï¼Œåˆ°æœ€åå˜å¾—ä¸ºäº†åŠ ä¸€äº›æ‰€è°“çš„åˆ›æ–°ç‚¹è€Œè„±ç¦»äº†å¯¹å®é™…é—®é¢˜çš„æ€è€ƒã€‚å¿ƒæ€çš„è½¬å˜ä¹Ÿè®©æˆ‘æ²¡æœ‰åŠ¨åŠ›å»åšæ›´å¤šçš„æ€è€ƒï¼Œæˆä¸ºäº†æ— æƒ…çš„è°ƒå‚ä¾ ï¼Œè€Œè°ƒå‚çš„è¿‡ç¨‹ä¹Ÿå› ä¸ºå¯¼å¸ˆæœºå™¨èµ„æºçš„åŒ®ä¹è€Œå˜å¾—å¦‚æ­¤çš„æ¼«é•¿ï¼ŒåŠ¨è¾„å°±æ˜¯è®­ç»ƒä¸€è½®éœ€è¦ä¸€å‘¨ã€‚ç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸ªæœºæ¢°çš„è°ƒå‚è¿‡ç¨‹å®é™…ä¸Šè®©ä¸ªäººçš„æˆé•¿æ˜¯åœæ»çš„ã€‚è¿™æ ·çš„äº‹æƒ…æ¯å¤©é‡å¤ä¸Šæ¼”ï¼Œæœ€åæˆ‘ç¡¬ç”Ÿç”ŸæŠŠæ€§èƒ½è°ƒä¸Šå»äº†ä¸€äº›ï¼Œæƒ³ç€å‡†å¤‡å†™æˆè®ºæ–‡ç»™è¿™ä¸ªå·¥ä½œç”»ä¸ªå¥å·ï¼Œç»“æœå¯¼å¸ˆä¸€å¥ï¼šâ€æˆ‘è§‰å¾—ä½ è¿™ä¸ªå·¥ä½œå¤ªå•è–„äº†ï¼Œè¿˜è¦åŠ ç‚¹ä¸œè¥¿ï¼Œä½†æˆ‘è¿˜æ²¡æƒ³å¥½æ€ä¹ˆåŠ ï¼Œä½ ä¹Ÿå†æƒ³æƒ³â€ï¼Œå°±æŠŠæˆ‘æ‰“å‘äº†ã€‚å°±è¿™æ ·æˆ‘ç»“æŸäº†ä¸ŠåŠå¹´ï¼ŒæœŸé—´é™†é™†ç»­ç»­ä¹Ÿåˆ·äº†äº›leetcodeã€‚\nä¸‹åŠå¹´ä¸‹åŠå¹´çš„å¼€å§‹ï¼ŒåŸºæœ¬ä¸Šå»¶ç»­äº†ä¸ŠåŠå¹´çš„ä¸œè¥¿ï¼Œç»§ç»­æ‰¾æƒ³æ³•å’Œåšå®éªŒï¼Œè¿›åº¦å½“ç„¶å¾ˆæ…¢ï¼Œä½†æ€»å½’æ˜¯æ…¢æ…¢åœ¨æ¨è¿›çš„ã€‚è¿™ä¸ªå…³èŠ‚å£ï¼Œæ¥äº†ä¸ªé¡¹ç›®ç”³æŠ¥çš„äº‹æƒ…ï¼ŒåŸä»¥ä¸ºè¿™ä¸ªäº‹æƒ…ä¼šå¾ˆå¿«å°±ç»“æŸï¼Œå› ä¸ºè®¡åˆ’æ˜¯20æ¥å¤©å°±ç»“æŸçš„ï¼Œç»“æŸæœ€åç¡¬æ˜¯è€—äº†100å¤©å·¦å³ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸çš„ç—›è‹¦ï¼Œæ¯å¤©ä¸æ˜¯å¼€ä¼šå°±æ˜¯æ”¹æ–‡æ¡£ï¼Œåšpptï¼Œæ¯«æ— ä¸ªäººæ—¶é—´ï¼Œè€Œä¸”è¿‡ç€706ï¼ˆæ—©ä¸Š7ç‚¹åˆ°æ™šä¸Š12ç‚¹ï¼‰çš„ç”Ÿæ´»ï¼Œèº«å¿ƒä¿±ç–²ã€‚ä½†æ˜¯æƒ³ç€å¦‚æœé¡¹ç›®ç”³è¯·ä¸‹æ¥å°±å¯ä»¥ç»™åé¢çš„å­¦å¼Ÿå­¦å¦¹åˆ›é€ è‰¯å¥½çš„ç§‘ç ”æ¡ä»¶ï¼Œæ€»å½’æ˜¯æœ‰ä¸ªå¥”å¤´åœ¨åšè¿™ä¸ªäº‹æƒ…ã€‚è¿™æœŸé—´ï¼Œå› ä¸ºåˆä½œçš„å…¬å¸å•ä½ç»å¸¸æ€§çš„åœ¨å·¥ä½œæ¨è¿›ä¸Šæ‹–æ²“ï¼Œå¯¼è‡´å¾ˆå¤šäº‹æƒ…éƒ½è½åˆ°äº†æˆ‘ä»¬å¤´ä¸Šï¼Œéš¾ä¸ŠåŠ éš¾ã€‚åˆ°æœ€åé¡¹ç›®ç”³æŠ¥çš„ç»“æœå½“ç„¶ä¸ä¼šæ˜¯é‚£å¥ç«¥è¯â€åŠªåŠ›å°±ä¼šæœ‰å›æŠ¥â€æ‰€è¯´çš„æ‹‰ï¼Œå¾ˆæ— åŠ›çš„å¤±è´¥äº†ã€‚è¿™ä¸€ä¸‹å°±åˆ°äº†10æœˆä»½ä¸­æ—¬äº†ï¼Œå¤±è´¥å½’å¤±è´¥ï¼Œç”Ÿæ´»è¿˜è¦ç»§ç»­ä¸æ˜¯å—ï¼Œæˆ‘æ•´ç†è‡ªå·±è¦åšçš„äº‹æƒ…ï¼Œå› ä¸ºæ˜å¹´å°±è¦æŠ•å…¥åˆ°æ¯•ä¸šå’Œæ‰¾å·¥ä½œçš„äº‹æƒ…ä¸­äº†ï¼Œæ‰€ä»¥è¦ä¸ºæ­¤åšå¥½å‡†å¤‡ï¼Œåˆ·é¢˜ã€åŸºç¡€çŸ¥è¯†å¤ä¹ å’Œä¸ªäººé¡¹ç›®çš„å‡†å¤‡éƒ½è¦åœ¨è·¯ä¸Šäº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œç§‘ç ”å®éªŒä¹Ÿä¸èƒ½è½ä¸‹ï¼Œäº‹æƒ…è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œä»è¿™ä¹‹åï¼Œæ•ˆç‡ç›¸å¯¹è¿˜æ˜¯å¥½ä¸€äº›äº†ï¼Œåˆ°äº†ç°åœ¨ï¼Œåˆ·é¢˜ä¹Ÿæœ‰äº†ä¸€äº›æ•ˆæœï¼ˆä¸‹å›¾ï¼‰ï¼ŒåŸºç¡€çŸ¥è¯†å¤ä¹ ä¹Ÿè½å®ä¸€äº›ï¼Œä¸ªäººé¡¹ç›®ä¹Ÿåœ¨å‡†å¤‡ä¸­ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå……å®çš„ã€‚å› ä¸ºæ¯•ä¸šä¸ªäººç›®æ ‡æ˜¯åœ¨ç ”å‘å²—è€Œä¸æ˜¯ç®—æ³•å²—ï¼Œæ‰€ä»¥åœ¨ç§‘ç ”å®éªŒå’Œå·¥ä½œå‡†å¤‡ä¸¤ä¸ªè·¯ä¸Šå¾—åšæ›´å¤šçš„æƒè¡¡ã€‚\n\n\næ˜å¹´è®¡åˆ’é¦–å…ˆè‚¯å®šæ˜¯æ¯”è¾ƒå¥½å¥½åˆ©ç”¨è¿™ä¸ªå¯’å‡æ‹‰ï¼Œ2æœˆåº•å°±è¦å¼€å§‹æš‘æœŸå®ä¹ çš„æ‹›è˜äº†ï¼Œå¯’å‡ç®—æ˜¯æœ€åä¸€æ³¢å†²åˆºäº†ï¼Œå‡†å¤‡è®¡åˆ’å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œè¿˜æ˜¯è€ä¸‰æ ·å§ï¼Œç®—æ³•çš„æ¯æ—¥ä¿æŒã€ç½‘ç»œå’Œç³»ç»Ÿç›¸å…³çŸ¥è¯†çš„å¤ä¹ ï¼ˆç›®å‰çœ‹å®Œäº†ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹è¿™æœ¬ä¹¦ï¼‰ã€ä¸ªäººé¡¹ç›®ï¼ˆå•†å“ç§’æ€ä¸ºæ ¸å¿ƒçš„ç³»ç»Ÿï¼Œåç»­åšä¸€ä¸‹6.824çš„labï¼‰ã€‚\nä¸ªäººè½¯å®åŠ›çš„ç¼ºé™·ï¼Œåœ¨å¤šä»»åŠ¡ç¯å¢ƒä¸‹çš„è´Ÿè½½èƒ½åŠ›è¿˜éœ€è¦åŠ å¼ºï¼Œå¾€å¾€æ¯å¤©è¦åš3åˆ°4ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œæ¯”è¾ƒå®¹æ˜“å‡ºç°åˆ‡æ¢è€—æ—¶å¤ªä¹…äº†ï¼ŒåŒæ—¶ä¸ªäººä½œæ¯ä¹Ÿæ˜¯æœ‰å¤§é—®é¢˜ï¼Œæ¯å¤©å‡Œæ™¨3ï¼Œ4ç‚¹æ‰ç¡è§‰ï¼Œå¤ªå½±å“ç™½å¤©çš„çŠ¶æ€äº†ï¼Œæ–°çš„ä¸€å¹´äº‰å–è°ƒæ•´åˆ°2ç‚¹ä»¥å‰ç¡è§‰å§ã€‚\nå°±å†™è¿™ä¹ˆå¤šå§ï¼Œå•°å•°å—¦å—¦è¯´äº†ä¸€å †ï¼Œå¸Œæœ›æ˜å¹´è¿™ä¸ªæ—¶å€™ä¹Ÿæ¯•ä¸šäº†ï¼Œå·¥ä½œä¹Ÿåº”è¯¥æœ‰äº†ï¼Œå¸Œæœ›åˆ°æ—¶å€™æ˜¯å¯¹è‡ªå·±æ»¡æ„çš„è¿™ä¹ˆä¸ªçŠ¶æ€å§ã€‚\n","categories":["ç”Ÿæ´»"]},{"title":"Use gRPC with SpringBoot","url":"/2022/05/29/Use-gRPC-with-SpringBoot/","content":"gRPCç›¸æ¯”äºREST HTTPè¯·æ±‚åœ¨æ¥å£è§„èŒƒã€ä¼ è¾“æ€§èƒ½å’Œæµå¼é€šä¿¡æ–¹é¢æ›´å¥½,å› æ­¤å¹¿æ³›åº”ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡çš„é€šä¿¡è¿‡ç¨‹ä¸­. æœ¬æ–‡ä¸»è¦æ˜¯é’ˆå¯¹ç›®å‰gRPC-Javaå’ŒSpringBootçš„å…¥é—¨çº§æ•™ç¨‹ä¸å¤Ÿç»Ÿä¸€è€Œå†™,ä¹Ÿæ˜¯ä½¿ç”¨è¿‡ç¨‹çš„è®°å½•.æ„Ÿè°¢grpc-spring-boot-starteræä¾›äº†å¼€ç®±å³ç”¨çš„gRPCæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ¥å£å®ç°,å› æ­¤æˆ‘ä»¬å¯ä»¥ä¸“æ³¨ä¸šåŠ¡å®ç°.\né¡¹ç›®ç®€è¿°è¯¥Demoä¸»è¦å®ç°ä¸€ä¸ªgRPCæœåŠ¡ç«¯å’Œä¸€ä¸ªgRPCå®¢æˆ·ç«¯,æœåŠ¡ç«¯æä¾›ä¸€ä¸ªapiæ¥æ”¶è¯·æ±‚å‚æ•°name,è¿”å›æ¶ˆæ¯Hello ==&gt; &lt;name&gt;. æœ¬é¡¹ç›®åŸºäºmavenæ„å»ºçš„å¤šmoduleå·¥ç¨‹å®ç°.\né¢„å¤‡ä¸ºäº†é¿å…å‡ºç°ç‰ˆæœ¬å…¼å®¹é—®é¢˜,æˆ‘ä»¬åœ¨parent pomæ–‡ä»¶ä¸­å®šä¹‰å¥½springbootã€javaã€grpcå’Œå¯¹åº”grpc-spring-boot-starterç‰ˆæœ¬,å¦‚ä¸‹:\n&lt;parent&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;    &lt;version&gt;2.5.8&lt;/version&gt;    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt;&lt;properties&gt;    &lt;java.version&gt;11&lt;/java.version&gt;    &lt;grpc.version&gt;1.42.2&lt;/grpc.version&gt;    &lt;grpc.starter.version&gt;2.13.1.RELEASE&lt;/grpc.starter.version&gt;&lt;/properties&gt;\n\ngrpc interface1. protoæ–‡ä»¶å®šä¹‰æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå­moduleä¸ºgrpc, ä½œä¸ºå…¬ç”¨protoæ–‡ä»¶å’Œå¯¹åº”protobufç”Ÿæˆçš„æ–‡ä»¶çš„å­˜æ”¾å¤„(åç»­çš„gRPC serverå’Œclienté¡¹ç›®éƒ½ä»¥æ­¤moduleä½œä¸ºä¾èµ–),å…¶ä¸­protoæ–‡ä»¶æ”¾åœ¨src/main/protoç›®å½•ä¸‹.è¿›è¡Œç›¸å…³å®šä¹‰.\nsyntax = &quot;proto3&quot;;package service;option java_multiple_files = true;option java_package = &quot;com.fengzw.minimall.minimalluser.service&quot;;option java_outer_classname = &quot;HelloWorldProto&quot;;// The greeting service definition.service MyService &#123;  // Sends a greeting  rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;// The request message containing the user&#x27;s name.message HelloRequest &#123;  string name = 1;&#125;// The response message containing the greetingsmessage HelloReply &#123;  string message = 1;&#125;\n\n2. mavené…ç½®åŒæ—¶åœ¨moduleçš„pomæ–‡ä»¶ä¸­é…ç½®å¥½mavenæ’ä»¶å’Œç›¸å…³ä¾èµ–,å¦‚ä¸‹:\n&lt;dependency&gt;    &lt;groupId&gt;io.grpc&lt;/groupId&gt;    &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt;    &lt;version&gt;$&#123;grpc.version&#125;&lt;/version&gt;    &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;io.grpc&lt;/groupId&gt;    &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;    &lt;version&gt;$&#123;grpc.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;io.grpc&lt;/groupId&gt;    &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;    &lt;version&gt;$&#123;grpc.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;!-- necessary for Java 9+ --&gt;    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;    &lt;artifactId&gt;annotations-api&lt;/artifactId&gt;    &lt;version&gt;6.0.53&lt;/version&gt;    &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;build&gt;    &lt;extensions&gt;        &lt;extension&gt;            &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt;            &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt;            &lt;version&gt;1.6.2&lt;/version&gt;        &lt;/extension&gt;    &lt;/extensions&gt;    &lt;plugins&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;            &lt;version&gt;0.6.1&lt;/version&gt;            &lt;configuration&gt;                &lt;protocArtifact&gt;com.google.protobuf:protoc:3.19.2:exe:$&#123;os.detected.classifier&#125;&lt;/protocArtifact&gt;                &lt;pluginId&gt;grpc-java&lt;/pluginId&gt;                &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:1.45.1:exe:$&#123;os.detected.classifier&#125;&lt;/pluginArtifact&gt;                &lt;protoSourceRoot&gt;src/main/proto&lt;/protoSourceRoot&gt;                &lt;outputDirectory&gt;src/main/java&lt;/outputDirectory&gt;                &lt;clearOutputDirectory&gt;false&lt;/clearOutputDirectory&gt;            &lt;/configuration&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;goals&gt;                        &lt;goal&gt;compile&lt;/goal&gt;                        &lt;goal&gt;compile-custom&lt;/goal&gt;                    &lt;/goals&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;&lt;/build&gt;\né€šè¿‡ç¼–è¯‘è¯¥moduleå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„gRPCæ–‡ä»¶åˆ°src/main/javaçš„ç›®å½•ä¸‹.\næœåŠ¡ç«¯module1. mavené…ç½®æ–°å»ºä¸€ä¸ªmoduleä½œä¸ºgRPCæœåŠ¡ç«¯,é…ç½®å¥½å¯¹åº”çš„pomæ–‡ä»¶:(åŒ…æ‹¬grpc moduleå’Œserver-starterä¾èµ–)\n&lt;dependency&gt;    &lt;groupId&gt;com.fengzw.minimall&lt;/groupId&gt;    &lt;artifactId&gt;grpc&lt;/artifactId&gt;    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;net.devh&lt;/groupId&gt;    &lt;artifactId&gt;grpc-server-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;$&#123;grpc.starter.version&#125;&lt;/version&gt;&lt;/dependency&gt;\n\n2. å®šä¹‰æœåŠ¡serviceæ„å»ºä¸€ä¸ªserviceæä¾›gRPC serveræœåŠ¡,å¦‚ä¸‹:\n@GrpcServicepublic class GrpcServerService extends MyServiceGrpc.MyServiceImplBase &#123;    @Override    public void sayHello(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) &#123;        System.out.println(&quot;Hello ==&gt; &quot; + request.getName());        HelloReply reply = HelloReply.newBuilder().setMessage(&quot;Hello ==&gt; &quot; + request.getName()).build();        responseObserver.onNext(reply);        responseObserver.onCompleted();    &#125;    @Override    public void sayHelloAgain(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) &#123;        super.sayHelloAgain(request, responseObserver);    &#125;&#125;\nå¦‚æœä½ é¡ºåˆ©ç¼–è¯‘äº†grpc module,é‚£ä¹ˆMyServiceGrpcæ–‡ä»¶å’Œç›¸åº”çš„modelæ–‡ä»¶ä¼šå‡ºç°åœ¨grpcçš„src/main/javaç›®å½•ä¸‹. å¯åŠ¨è¯¥module,ä½ ä¼šåœ¨SpringBootçš„å¯åŠ¨æ—¥å¿—è§åˆ°å¦‚ä¸‹ä¿¡æ¯:\n2022-05-29 20:47:18.223  INFO 16841 --- [  restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory    : Registered gRPC service: service.MyService, bean: grpcServerService, class: com.fengzw.minimall.minimalluser.service.GrpcServerService2022-05-29 20:47:18.223  INFO 16841 --- [  restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory    : Registered gRPC service: grpc.health.v1.Health, bean: grpcHealthService, class: io.grpc.protobuf.services.HealthServiceImpl2022-05-29 20:47:18.223  INFO 16841 --- [  restartedMain] n.d.b.g.s.s.AbstractGrpcServerFactory    : Registered gRPC service: grpc.reflection.v1alpha.ServerReflection, bean: protoReflectionService, class: io.grpc.protobuf.services.ProtoReflectionService2022-05-29 20:47:18.281  INFO 16841 --- [  restartedMain] n.d.b.g.s.s.GrpcServerLifecycle          : gRPC Server started, listening on address: *, port: 9091\næ­¤æ—¶é€šè¿‡ideaçš„http requestä½ å¯ä»¥è°ƒç”¨grpcè¯·æ±‚æ¥æµ‹è¯•è¯¥grpc serviceçš„çŠ¶æ€.\nGRPC localhost:9090/service.MyService/SayHello&#123;  &quot;name&quot;: &quot;request&quot;&#125;\nä½ ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º.\n&#123;  &quot;message&quot;: &quot;Hello \\u003d\\u003d\\u003e request&quot;&#125;\nè¿™æ ·æˆ‘ä»¬çš„æœåŠ¡ç«¯å°±å®ç°å¥½äº†.\nå®¢æˆ·ç«¯module1. mavené…ç½®æ–°å»ºä¸€ä¸ªmoduleä½œä¸ºgrpc å®¢æˆ·ç«¯, å¦‚æœåŠ¡ç«¯ä¸€æ ·, æˆ‘ä»¬åŒæ ·éœ€è¦åœ¨maven pomæ–‡ä»¶ä¸­ä¾èµ–grpc module, å¹¶ä¾èµ–client-starterä¾èµ–å¦‚ä¸‹:\n&lt;dependency&gt;    &lt;groupId&gt;com.fengzw.minimall&lt;/groupId&gt;    &lt;artifactId&gt;gprc&lt;/artifactId&gt;    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;net.devh&lt;/groupId&gt;    &lt;artifactId&gt;grpc-client-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;$&#123;grpc.starter.version&#125;&lt;/version&gt;&lt;/dependency&gt;\n\n2. springbooté…ç½®æ–‡ä»¶ä¸­é…ç½®grpc serverä¿¡æ¯é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶application.propertiesä¸­å®šä¹‰å¥½grpc serverçš„ç›¸å…³ä¿¡æ¯:\ngrpc.client.user-server.address=static://127.0.0.1:9091grpc.client.user-server.enable-keep-alive=truegrpc.client.user-server.keep-alive-without-calls=truegrpc.client.user-server.negotiation-type=plaintext\n\nWARNING: æ³¨æ„å¦‚æœæ˜¯åŒä¸€å°æœåŠ¡å™¨æ¥è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµ‹è¯•, é‚£ä¹ˆæœåŠ¡ç«¯éœ€è¦è®¾ç½®grpc serverçš„ç«¯å£åœ¨é™¤äº†9090ä¹‹å¤–çš„ç«¯å£, å¦åˆ™ä¼šå¼•èµ·è°ƒç”¨æ—¶æŠ¥é”™INTERNAL: http2 exceptionCaused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 485454502f\n\n3. å®šä¹‰å®¢æˆ·ç«¯æ–¹æ³•ç„¶åæˆ‘ä»¬åœ¨ä¸€ä¸ªspring serviceç»„ä»¶ä¸‹å®šä¹‰æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ–¹æ³•,å¦‚ä¸‹:\n@Servicepublic class DemoService &#123;    @GrpcClient(&quot;user-server&quot;)    private MyServiceGrpc.MyServiceBlockingStub myServiceStub;    public String hello(String name) &#123;        HelloRequest request = HelloRequest.newBuilder().setName(name).build();        return myServiceStub.sayHello(request).getMessage();    &#125;&#125;\nè¿™é‡Œ@GrpcClientä¸­çš„valueè¡¨ç¤ºgrpc serverçš„åç§°, åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œäº†å®šä¹‰. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªcontrolleræ¥å¯¹å¤–æç©ºä¸€ä¸ªrest apiæ¥è¿›è¡Œgrpcå®¢æˆ·ç«¯è°ƒç”¨, å¦‚ä¸‹:\n@Autowiredprivate DemoService service;@GetMapping(&quot;/hello&quot;)public String hello() &#123;    return service.hello(&quot;demo&quot;);&#125;\nè¿™æ ·å®¢æˆ·ç«¯å°±å…¨éƒ¨é…ç½®å®Œæˆäº†.\næ€»ç»“å¯ä»¥çœ‹åˆ°ç›¸æ¯”äºGoè¯­è¨€ä¸­å¯¹gRPCçš„ä½¿ç”¨, grpc-spring-boot-starteræå¤§åœ°ç®€åŒ–äº†éä¸šåŠ¡ç›¸å…³çš„ä»£ç .\n","categories":["Java"],"tags":["SpringBoot","gRPC"]},{"title":"sliceä½¿ç”¨appendçš„å°å‘","url":"/2021/04/22/be-careful-when-use-append-to-add-slice-to-slice/","content":"ä»Šå¤©åœ¨åˆ·ä¸€é“ç®—æ³•é¢˜çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå…³äºsliceåœ¨ä½¿ç”¨appendçš„å°ç»†èŠ‚é—®é¢˜ã€‚è¿™ä¸ªç®—æ³•é¢˜å¯ä»¥å‚è€ƒè·¯å¾„æ€»å’ŒIIã€‚é¢˜æ„å¾ˆç®€å•ï¼Œå°±æ˜¯ä»ä¸€ä¸ªäºŒå‰æ ‘ä¸­æ‰€æœ‰ç”±æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æ»¡è¶³è·¯å¾„å’Œç­‰äºtargetçš„è·¯å¾„ã€‚\n\n\né—®é¢˜åœ¨å‚è€ƒå®˜æ–¹é¢˜è§£çš„golangç‰ˆæœ¬çš„æ—¶å€™ï¼Œå‘ç°äº†æœ‰ä¸€æ®µä»£ç æ˜¯æˆ‘ä¸€å¼€å§‹æ²¡å¼„æ˜ç™½çš„ã€‚å®Œæ•´ä»£ç å¯å‚è€ƒ\nfunc pathSum(root *TreeNode, targetSum int) (ans [][]int) &#123;    path := []int&#123;&#125;    var dfs func(*TreeNode, int)    dfs = func(root *TreeNode, left int) &#123;        if root == nil &#123;            return        &#125;        left -= root.Val        path = append(path, root.Val)        defer func() &#123; path = path[:len(path)-1] &#125;()        if left == 0 &amp;&amp; root.Left == nil &amp;&amp; root.Right == nil &#123;            ans = append(ans, append([]int&#123;&#125;, path...))            return        &#125;        dfs(root.Left, left)        dfs(root.Right, left)    &#125;    dfs(root, targetSum)    return&#125;\nå…¶ä¸­çš„ans = append(ans, append([]int&#123;&#125;, path...))åˆ™æ˜¯æˆ‘å…³æ³¨çš„åœ°æ–¹ï¼Œä¸€å¼€å§‹æˆ‘ç–‘æƒ‘ä¸ºä»€ä¹ˆä¸ç›´æ¥ans = append(ans, path))ï¼Œä½†æ˜¯å®éªŒè¯æ˜ç»“æœä¼šéå¸¸å¥‡æ€ªï¼Œæ¯”å¦‚å¯¹äºè¿™æ ·ä¸€ä¸ªä¾‹å­æˆ‘ä»¬æƒ³è¦çš„æ˜¯[[5,4,11,2],[5,8,4,5]]ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯[[5,8,4,1],[5,8,4,1]].  \nè§£æè¿™é‡Œå…¶å®æ˜¯æˆ‘å¿˜äº†golangä¸­çš„sliceåº•å±‚å®ç°å¦‚ä¸‹å›¾æ‰€ç¤º\ntype slice struct &#123;    array unsafe.Pointer    len   int    cap   int&#125;\nå› æ­¤å¦‚æœåƒans = append(ans, path))è¿™æ ·åšï¼Œå…¶å®åœ¨anså­˜æ”¾çš„æ˜¯pathè¿™ä¸ªsliceï¼Œåœ¨åç»­ä»£ç è¿è¡Œä¸­çš„æ”¹å˜ä¼šå¯¼è‡´ansçš„ç»“æœæ”¹å˜ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªé”™è¯¯çš„ç»“æœã€‚è€Œans = append(ans, append([]int&#123;&#125;, path...))åˆ™æ˜¯åœ¨ansä¸­å­˜æ”¾äº†ä¸€ä¸ªpathçš„å‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬ä¸ä¼šè¢«å…¶ä»–ä»£ç ä¿®æ”¹åˆ°ã€‚å› æ­¤ç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚\n\nä¸€è¡Œä»£ç å°±æ­ç¤ºgolangä¸­sliceçš„æœ¬è´¨~ï¼ŒçœŸå®å¦™å•Šã€‚\n\nREFERENCE[1] leetcode 113é¢˜[2] æ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°\n","categories":["Golang"],"tags":["go","æŒ‡é’ˆ"]},{"title":"bugfix of pytorch out of memory","url":"/2022/04/21/bugfix-of-pytorch-out-of-memory/","content":"è®°å½•ä¸€æ¬¡æ¨¡å‹æ¨ç†è¿‡ç¨‹ä¸­æ˜¾å­˜ä¸æ–­å¢åŠ ç›´è‡³Out-of-Memoryçš„è§£å†³è¿‡ç¨‹.\n\n\nåœºæ™¯å½“æˆ‘åœ¨ç®—æ³•ä¸­åŠ å…¥äº†ä¸€ä¸ªè¿ç®—é‡ä¸å¤§çš„æ“ä½œå, æ¨¡å‹æ¨ç†è¿‡ç¨‹ç›´æ¥ä»åŸæ¥çš„æ˜¾å­˜å ç”¨ä¸åˆ°11Gç›´æ¥çˆ†äº†3090çš„æ˜¾å­˜.\næ˜¾å­˜å¢åŠ å®šä½é¦–å…ˆéœ€è¦åˆ¤æ–­æ˜¯ä»€ä¹ˆåœ°æ–¹é€ æˆäº†æ˜¾å­˜çš„å¢åŠ . è¿™é‡Œæ¨èä¸€ä¸ªåº“Pytorch-Memory-Utils.è¯¥åº“å¯ä»¥é€šè¿‡ä¾µå…¥å¼çš„trackæ–¹æ³•è®°å½•ä¸¤ä¸ªtrackæ–¹æ³•ä¹‹é—´çš„æ˜¾å­˜å˜åŒ–. å…¶è®°å½•çš„æ ¼å¼å¦‚ä¸‹\nAt main.py line 18: &lt;module&gt;  Total Tensor Used Memory:466.4  Mb Total Allocated Memory:466.4  Mb+ | 1 * Size:(120, 3, 512, 512)   | Memory: 360.0 M | &lt;class &#x27;torch.Tensor&#x27;&gt; | torch.float32+ | 1 * Size:(80, 3, 512, 512)    | Memory: 240.0 M | &lt;class &#x27;torch.Tensor&#x27;&gt; | torch.float32At main.py line 23: &lt;module&gt;  Total Tensor Used Memory:1066.4 Mb Total Allocated Memory:1066.4 Mb\n\næœ€ç»ˆæ˜¯å‘ç°åœ¨æ¨¡å‹decoderéƒ¨åˆ†å¯¼è‡´äº†æ˜¾å­˜çš„æ¿€å¢, å¹¶ä¸”éšç€æ¨ç†çš„è¿›è¡Œ,ä¸æ–­ç´¯åŠ . \nè§£å†³è§£å†³è¿™é‡Œå‚è€ƒäº†Pytorchæ¨¡å‹æµ‹è¯•æ—¶æ˜¾å­˜ä¸€ç›´ä¸Šå‡å¯¼è‡´çˆ†æ˜¾å­˜, åŸå› åº”è¯¥æ˜¯decoderä¸­çš„æ¢¯åº¦åœ¨ä¸€ç›´è®¡ç®—å¹¶ç´¯ç§¯å¯¼è‡´æ˜¾å­˜çš„ä¸åˆç†ç´¯åŠ . å› æ­¤è§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç›´æ¥:\nwith torch.no_grad():    y = torch.sigmoid(self.refiner(s, features, im_size))\nå°†decoderçš„è¿‡ç¨‹ç”¨torch.no_grad() wrapèµ·æ¥. bugå°±è§£å†³å¥½äº†.\n","categories":["pytorch"],"tags":["pytorch","gpu","oom"]},{"title":"GormåŠ æ‚²è§‚é”çš„æœ€æ–°ç”¨æ³•","url":"/2021/11/30/gorm-for-update/","content":"å› ä¸ºgoogleäº†â€œgorm for updateâ€æˆ–è€…æ˜¯â€œgorm å¼€å¯æ’ä»–é”â€å‡ºæ¥çš„æ–‡ç« æ¸…ä¸€è‰²çš„ä½¿ç”¨ç€å¦‚ä¸‹ç”¨æ³•æ¥å¼€å¯è¡¨çš„è¡Œ/è¡¨é”  \ntx.Set(&quot;gorm:query_option&quot;, &quot;FOR UPDATE&quot;).First(&amp;employee, id)\n\nä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œæˆ‘åŠ äº†æ²¡æœ‰ä½œç”¨ï¼Œæœç´¢gormå®˜æ–¹æ–‡æ¡£ï¼Œç»“æœç”¨æ³•å·²ç»å˜æˆå¦‚ä¸‹\ndb.Clauses(clause.Locking&#123;Strength: &quot;UPDATE&quot;&#125;).Find(&amp;users)// SELECT * FROM `users` FOR UPDATEdb.Clauses(clause.Locking&#123;  Strength: &quot;SHARE&quot;,  Table: clause.Table&#123;Name: clause.CurrentTable&#125;,&#125;).Find(&amp;users)// SELECT * FROM `users` FOR SHARE OF `users`\n\næœç„¶æœ‰é—®é¢˜å…ˆæ‰¾å®˜æ–¹æ–‡æ¡£ã€‚ğŸ˜‚\n","categories":["Golang"],"tags":["go","gorm"]},{"title":"[6.824ç³»åˆ—] Outline of lab1 solution","url":"/2022/04/10/outline-of-6-824-lab1-solution/","content":"æœ¬æ–‡ä¸»è¦æ€»ç»“äº†å¦‚ä½•å®ç°6.824 lab1çš„å¤§çº², æ–¹ä¾¿è‡ªå·±å’Œè¯»è€…èƒ½å¤Ÿè¿…é€Ÿç†è§£MapReduceå…·ä½“è¦å®ç°äº›ä»€ä¹ˆ.\n\næ¦‚è§ˆé¦–å…ˆæ•´ä¸ªMapReduceçš„è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸‹å›¾, åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: Mapå’ŒReduceé˜¶æ®µ.ä»è¿™ä¸ªå›¾ä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºMapReduceæ•´ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹\n\nå°†ä»»åŠ¡çš„è¾“å…¥æ–‡ä»¶æ‹†åˆ†å¤šä¸ªsplitæ–‡ä»¶\nåˆ›å»ºå¤šä¸ªMapä»»åŠ¡, æ¯ä¸ªä»»åŠ¡å¯¹åº”è¾“å…¥è‹¥å¹²ä¸ªsplit\nåœ¨å¤šä¸ªworkeræœåŠ¡å™¨ä¸Šæ‰§è¡ŒMapä»»åŠ¡, å¹¶å°†è¾“å‡ºå†™å…¥åˆ°Intermediate filesä¸­\nå½“æ‰€æœ‰Mapå®Œæˆå, MapReduceè¿›å…¥Reduceé˜¶æ®µ, ä¸ºå¤šä¸ªworkeræœåŠ¡å™¨åˆ†é…Reduceä»»åŠ¡\næ¯ä¸ªReduceä»»åŠ¡è¯»å–å¯¹åº”çš„Intermediate fileså®ŒæˆReduceä»»åŠ¡, å¹¶å°†è¾“å‡ºå†™å…¥å¯¹åº”çš„output files\n\né—®é¢˜Q1: ä»€ä¹ˆæ—¶å€™ç”±è°æ¥å¯¹ä»»åŠ¡è¾“å…¥æ–‡ä»¶è¿›è¡Œsplit? å¦‚ä½•split?\n\nA: ç”±Masteråœ¨MapReduceä»»åŠ¡åˆå§‹åŒ–çš„è¿‡ç¨‹å®Œæˆ, splitçš„ç›®çš„æ˜¯ä¸ºäº†å°†ä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡ç»™åˆ°å¤šä¸ªworkeræœºå™¨è¿è¡Œ, å®ç°å¹¶å‘åŠ é€Ÿ, å› æ­¤splitæ–‡ä»¶çš„æ•°é‡åº”è¯¥ç­‰åŒäºworkeræœºå™¨æ•°é‡æ¥è®¾ç½®. åŒæ—¶splitåº”è¯¥æŒ‰ç…§é¢„è®¾å¥½çš„æ–‡ä»¶çš„å¤§å°æ¥è¿›è¡Œåˆ’åˆ†(æ¯”å¦‚ä¸€ä¸ªsplitæ–‡ä»¶ä¸º1KBå¤§å°). \n\nQ2: Mapæ˜¯ä»€ä¹ˆ?\n\nA: æ¥æ”¶ä¸€ä¸ªkey/valueçš„pair, äº§ç”Ÿä¸€ç³»åˆ—çš„key/valueä¸­é—´ç»“æœçš„è¿‡ç¨‹å°±æ˜¯Map, æ¯”å¦‚è¯´ä¸‹é¢æ˜¯ä¸€ä¸ªwordcountçš„mapä¾‹&gt; å­\nmap(String key, String value):    // key: document name    // value: document contents    for each word w in value:        EmitIntermediate(w, &quot;1&quot;);\n\nQ3: Reduceæ€ä¹ˆçŸ¥é“è‡ªå·±å¯¹åº”çš„æ˜¯å“ªäº›Intermediate files?\n\nA: æˆ‘ä»¬æŠŠå¯¹Mapäº§ç”Ÿçš„æ¯ä¸€ä¸ªkey/value, å¯¹keyè¿›è¡Œhashååˆ†é…åˆ°ä¸€ä¸ªReduceä»»åŠ¡, å…·ä½“æ¥è¯´:\n\nç»™å®šä¸€ä¸ªMapä»»åŠ¡Xä»¥åŠäº§ç”Ÿçš„key/value pair\nReduce Y = hash(key) % nReduce\nwrite to â€œmr-X-Yâ€ fileå› æ­¤, å¯¹äºç»™å®šçš„Reduceä»»åŠ¡Y, å®ƒå»è¯»å–æ‰€æœ‰çš„mr-?-Yæ–‡ä»¶ä½œä¸ºè¾“å…¥.\n\n\nQ4: å¦‚ä½•å¤„ç†Mapä»»åŠ¡æˆ–è€…Reduceä»»åŠ¡æ‰§è¡Œè¶…æ—¶æˆ–å¤±è´¥çš„é—®é¢˜\n\nA: åˆ©ç”¨è¶…æ—¶æœºåˆ¶å’ŒMasterè¢«åŠ¨åˆ†é…ä»»åŠ¡æ¥å®ç°è¶…æ—¶é‡è¯•, å¯¹æ¯ä¸€ä¸ªä»»åŠ¡éƒ½è®°å½•å…¶å¼€å§‹çš„æ—¶é—´, å½“workerè¯·æ±‚åˆ†é…ä»»åŠ¡çš„æ—¶å€™, éå†æ‰€æœ‰çš„ä»»åŠ¡åˆ¤æ–­æ˜¯å¦è¶…æ—¶, å¦‚æœè¶…æ—¶åˆ™æ˜¯ä¸€ä¸ªå¯ä»¥è¢«åˆ†é…çš„ä»»åŠ¡.\n\nå®ç°å¤§çº²å¤§çº²å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: Masterå’ŒWorker\n1. Workerå¯¹äºæ¯ä¸€ä¸ªWorker, å®ƒçš„æ‰§è¡Œè¿‡ç¨‹éƒ½å¯ä»¥æ¦‚æ‹¬ä¸º:æ— é™å¾ªç¯è¯·æ±‚ä»»åŠ¡åˆ†é…å¹¶æ‰§è¡Œç›´è‡³MapReduceå…¨éƒ¨ä»»åŠ¡å®Œæˆ. è¿‡ç¨‹å¦‚ä¸‹:\n\nå‘Masterç”³è¯·åˆ†é…ä»»åŠ¡(ç”±Masterå†³å®šåˆ†é…Mapè¿˜æ˜¯Reduceä»»åŠ¡)\nå¦‚æœMasterè¿”å›MapReduceå·²ç»å…¨éƒ¨å®Œæˆåˆ™é€€å‡ºå¾ªç¯\næ ¹æ®è¿”å›çš„ä»»åŠ¡ç±»å‹(Map or Reduce)æ‰§è¡Œå¯¹åº”çš„å¤„ç†è¿‡ç¨‹\né‡å¤ä¸Šè¿°\n\n1.1 Mapå¤„ç†Mapçš„è¾“å…¥: taskId(ä»»åŠ¡ID), nReduce(é¢„è®¾çš„Reduceä¸ªæ•°), fileName(è¾“å…¥æ–‡ä»¶çš„è®¿é—®è·¯å¾„)\n\nè¿™é‡Œéœ€è¦æ³¨æ„fileNameçš„å®šä¹‰, åœ¨è¿™ä¸ªä½œä¸šå½“ä¸­, æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ–‡ä»¶åä½œä¸ºfileName, è¿™æ˜¯å› ä¸ºç¨‹åºè·‘åœ¨å•æœºç¯å¢ƒä¸‹, é€šè¿‡å¤šä¸ªè¿›ç¨‹çš„å½¢å¼æ¨¡æ‹Ÿåˆ†å¸ƒå¼ç¯å¢ƒ, å› æ­¤é»˜è®¤æƒ…å†µä¸‹ç›¸å…³æ–‡ä»¶éƒ½å­˜æ”¾åœ¨ä¸»ç¨‹åºçš„å½“å‰ç›®å½•ä¸‹, å› æ­¤å¯ä»¥é€šè¿‡æ–‡ä»¶åå³å¯ä»¥è®¿é—®åˆ°, ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒ, æˆ‘ä»¬å¾€å¾€ä¼šä¾æ‰˜ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ¥å­˜æ”¾è¿™äº›æ–‡ä»¶(æ¯”å¦‚GFS), å› æ­¤æ­¤æ—¶fileNameåº”è¯¥æ˜¯ä¸€ä¸ªæ–‡ä»¶è®¿é—®URL, å¯ä»¥é€šè¿‡URLå»åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¯»å–åˆ°å¯¹åº”æ–‡ä»¶. \n\nMapçš„è¿‡ç¨‹\n\nè¯»å–æ–‡ä»¶å†…å®¹å¹¶ç»mapå‡½æ•°å¤„ç†å¾—åˆ°å¯¹åº”kvå¯¹é›†åˆkva\nåˆ›å»ºnReduceä¸ªä¸´æ—¶æ–‡ä»¶\nå°†kvaæŒ‰ç…§key hashå€¼å†™å…¥åˆ°å¯¹åº”ä¸´æ—¶æ–‡ä»¶\né‡å‘½åä¸´æ—¶æ–‡ä»¶ä¸ºmr-X-Y, Xä¸ºtaskId(mapId), Yä¸ºreduceId.\né€šçŸ¥Master, è¯¥ä»»åŠ¡å®Œæˆ\n\n\nè¿™é‡Œé‡‡ç”¨çº¦å®šå¤§äºé…ç½®æ€æƒ³, å› æ­¤ä¸éœ€è¦é€šçŸ¥Masterè¯¥ä»»åŠ¡è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶å, ä½†æ˜¯å¦‚æœæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è¯éœ€è¦ç»™å‡ºç³»ç»Ÿæ¥å£è¿”å›çš„æ–‡ä»¶URLç»™Master.\n\n1.2 Reduceå¤„ç†è¿‡ç¨‹å’ŒMapå¤„ç†ç±»ä¼¼Reduceçš„è¾“å…¥: taskId, intermediateFileNames(ä¸­é—´æ–‡ä»¶è®¿é—®è·¯å¾„çš„é›†åˆ)\nReduceçš„è¿‡ç¨‹\n\néå†è¯»å–ä¸­é—´æ–‡ä»¶, å¹¶ä¿å­˜åˆ°ä¸€ä¸ªå†…å­˜çš„åˆ—è¡¨ä¸­\næŒ‰ç…§keyæ¥æ’åºåˆ—è¡¨\nå°†åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªkeyå’Œå¯¹åº”çš„valueé›†åˆäº¤ç»™reduceå‡½æ•°å¤„ç†\nç»“æœå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶å¹¶é‡å‘½å\né€šçŸ¥Masterä»»åŠ¡å®Œæˆ\n\n2. MasterMasterä½œä¸ºMapReduceçš„åè°ƒè€…, éœ€è¦å¯¹æ‰€æœ‰Mapã€Reduceä»»åŠ¡çš„çŠ¶æ€è¿›è¡Œç®¡ç†, åŒæ—¶åœ¨å¯¹åº”çš„çŠ¶æ€ä¸‹è¿›è¡Œä»»åŠ¡åˆ†é…. æ€»çš„æ¥è¯´éœ€è¦å…·å¤‡ä»¥ä¸‹åŠŸèƒ½:\n\nä»»åŠ¡åˆå§‹åŒ–\nä»»åŠ¡åˆ†é…\nä»»åŠ¡å®Œæˆå¤„ç†\n\n2.1 ä»»åŠ¡åˆå§‹åŒ–è¿™ä¸€è¿‡ç¨‹å®é™…ä¸Šä¹Ÿæ˜¯Masterçš„åˆå§‹åŒ–è¿‡ç¨‹. è¿™ä¸€è¿‡ç¨‹, Masteréœ€è¦è®¾å®šå¥½éœ€è¦å¤šå°‘ä¸ªReduceå’ŒMap, åŒæ—¶å¯¹ç›¸åº”çš„Mapå’ŒReduceä»»åŠ¡è¿›è¡Œåˆå§‹åŒ–, åŒæ—¶è¿›å…¥æ•´ä¸ªMapReduceè¿›å…¥MappingçŠ¶æ€.\n2.2 ä»»åŠ¡åˆ†é…è¿™ä¸ªè¿‡ç¨‹æ ¸å¿ƒåœ¨äºåˆ¤æ–­å½“å‰MapReduce(Master)å¤„äºä»€ä¹ˆçŠ¶æ€ä»è€Œåˆ†é…ç›¸åº”çš„ä»»åŠ¡:\n\nå¦‚æœå¤„äºMappingçŠ¶æ€, éå†MapTasksåˆ—è¡¨åˆ¤æ–­æ¯ä¸€ä¸ªä»»åŠ¡æ˜¯å¦å¯ä»¥è¢«åˆ†é…\nåˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦è¶…æ—¶, å¦‚æœè¶…æ—¶åˆ™éœ€è¦å°†å…¶çŠ¶æ€ä¿®æ”¹ä¸ºå¯è¢«åˆ†é…\n\n\nå¦‚æœå¤„äºReducingçŠ¶æ€, éå†ReduceTasksåˆ—è¡¨è¿›è¡Œç±»ä¼¼çš„åˆ†é…\nå¦‚æœå¤„äºDoneçŠ¶æ€, åˆ™è¿”å›ExitçŠ¶æ€ç ç»™workerå‘ŠçŸ¥æ•´ä¸ªMapReduceå·²ç»ç»“æŸ\n\n2.3 ä»»åŠ¡å®Œæˆå¤„ç†\nç»™å®šå®Œæˆçš„ä»»åŠ¡ID: taskId\næ ¹æ®é˜¶æ®µMapping/Reducingæ‰¾åˆ°å¯¹åº”çš„Task\nä¿®æ”¹Taskçš„çŠ¶æ€ä¸ºFinished\nå¦‚æœè¯¥é˜¶æ®µæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»å®Œæˆ,åˆ™æ¨è¿›Masterçš„çŠ¶æ€åˆ°ä¸‹ä¸€é˜¶æ®µ\n\n\n\n","categories":["6.824"],"tags":["go","åˆ†å¸ƒå¼"]},{"title":"[6.824ç³»åˆ—] Outline of lab2A solution","url":"/2022/04/26/outline-of-6-824-lab2A-solution/","content":"æœ¬æ–‡ä¸»è¦æ€»ç»“äº†å¦‚ä½•å®ç°6.824 lab2A.\n\nä¸»è¦ä»»åŠ¡å¦‚ä¸‹:\n\nå®ç°Raft Leader Election\nå®ç°leaderå’Œfollowerä¹‹é—´çš„å¿ƒè·³æœºåˆ¶(ä¸å¸¦log)è¿™ä¸ªlabå…³é”®æ˜¯è¦å¤„ç†å¥½å¤šä¸ªgoroutineå¯¹RaftçŠ¶æ€æœºçš„å¹¶å‘å†™.\nå¤„ç†ä¸å¥½, å®¹æ˜“é€ æˆæ­»é”/æœ‰é™æ—¶é—´å†…é€‰ä¸å‡ºleader/é€‰å‡ºå¤šä¸ªleaderç­‰å¤šç§é—®é¢˜.\n\n\n\nä¸»è¦å®ç°å‚è€ƒè®ºæ–‡ä¸­çš„Figure 2\nRaftçŠ¶æ€æœºæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰å‡º leader election å’Œ heartbeat ä¸¤ä¸ªè¿‡ç¨‹ä¸­Raftéœ€è¦ç»´æŠ¤çš„æ•°æ®, è¿™ä¸€ç‚¹åœ¨Raftè®ºæ–‡ä¸­çš„Figure 2å·²ç»è¯´æ˜äº†, æˆ‘ä»¬åœ¨å®ƒçš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€äº›è¿è¡Œæ—¶æ•°æ®.å…·ä½“å¦‚ä¸‹:\ntype Raft struct &#123;    ... // other    currentTerm     int             // latest term server has seen    votedFor        int             // é€‰ä¸¾è¿‡ç¨‹æŠ•ç»™è°ä¸€ç¥¨, åˆå§‹åŒ–æˆ–resetåä¸º-1è¡¨ç¤ºæœªæŠ•ç¥¨    roleState       int             // è¡¨ç¤ºserverå½“å‰å¤„äºä¸‰è§’è‰²ä¹‹ä¸€: leader, candidate, follower    electionTimeout time.Duration   // å½“å‰termæ‰€è®¾ç½®çš„é€‰ä¸¾è¶…æ—¶, åŒæ—¶ä¹Ÿæ˜¯å¿ƒè·³è¶…æ—¶    lastTickTime    time.Time       // ä¸Šä¸€æ¬¡åˆ·æ–°å¿ƒè·³çš„æ—¶é—´&#125;\n\nRPCè°ƒç”¨AppendEntriesåœ¨Lab2Aä¸­, AppendEntriesä¸»è¦ç”¨äºå¿ƒè·³æœºåˆ¶, å› æ­¤ä¸»è¦ç”¨äºé€šçŸ¥followerå½“å‰çš„termæ˜¯ä»€ä¹ˆ, ä»¥ä¾¿äºfollowerè¿›è¡Œtermçš„æ›´æ–°å’Œtimeoutçš„é‡ç½®.å…·ä½“æ¥è¯´, AppendEntriesè°ƒç”¨å¤„ç†çš„è¿‡ç¨‹åˆ†ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†:\n\nä¸Šé”, å› ä¸ºåç»­éœ€è¦è¯»å†™raftçŠ¶æ€å’Œæ•°æ®\nåˆ¤æ–­å¿ƒè·³ä¼ é€’è¿‡æ¥çš„termæ˜¯å¦æ¯”å½“å‰èŠ‚ç‚¹çš„termæ–°, å¦‚æœä¸æ–°çš„è¯, è¡¨ç¤ºè¯¥å¿ƒè·³æ— æ•ˆ, è¿”å›false\næœ‰æ•ˆåˆ™åˆ·æ–° lastTickTime\næ»¡è¶³ä»¥ä¸‹ä¸‰ç§æƒ…å†µåˆ™é‡ç½®èŠ‚ç‚¹çŠ¶æ€\n[leader with older term]\n[candidate with older or same term]\n[follower with older term]\n\n\n\n\né‡ç½®èŠ‚ç‚¹çŠ¶æ€å®é™…ä¸Šå°±æ˜¯\n\næ›´æ–°termåˆ°æœ€æ–°\nvotedFor=-1\nroleState=Follower\n\n\nRequestVoteRequestVoteç”¨äºå½“èŠ‚ç‚¹æå‡ä¸ºcandidateçš„æ—¶å€™, å‘å…¶ä»–èŠ‚ç‚¹ç´¢è¦æŠ•ç¥¨æ—¶è°ƒç”¨. å…·ä½“æ¥è¯´, candidateéœ€è¦å°†è‡ªå·±çš„termå’Œidå‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹, è€Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°RequestVoteå, éœ€è¦å¯¹termçš„åˆæ³•æ€§(newer)è¿›è¡ŒéªŒè¯, å¦‚æœtermåˆæ³•ä¸”èŠ‚ç‚¹æœªæŠ•ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹æˆ–è€…å·²ç»æŠ•ç¥¨ç»™candidate, åˆ™æŠ•ç¥¨ç»™è¯¥candidate. å¤§è‡´å¤„ç†è¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†:\n\nåŠ é”\nå¦‚æœå‘é€è¿‡æ¥çš„termæ›´æ—©, è¯´æ˜è¯¥é€‰ä¸¾è¿‡ç¨‹å·²è¿‡æ—¶, ç›´æ¥è¿”å›false\nå¦‚æœtermæ›´æ–°, è¯´æ˜æ˜¯æ–°ä¸€è½®çš„é€‰ä¸¾, æ­¤æ—¶èŠ‚ç‚¹éœ€è¦é‡ç½®çŠ¶æ€\nåˆ¤æ–­æ˜¯å¦æœªæŠ•è¿‡ç¥¨æˆ–è€…è¯¥è¯·æ±‚çš„candidateIdæ˜¯å·²é€‰è¿‡çš„å€™é€‰è€…, åˆ™ç»™è¯¥å€™é€‰è€…æŠ•ç¥¨\nåˆ·æ–° lastTickTime\n\n\n\nå¿ƒè·³æœºåˆ¶æ¯ä¸ªraftèŠ‚ç‚¹å¦‚æœæ˜¯leaderçŠ¶æ€çš„è¯,ä¼šå‘¨æœŸæ€§åœ°å‘å…¶ä»–èŠ‚ç‚¹å‘é€å¿ƒè·³. åœ¨Lab2Aä¸­, å¿ƒè·³æœºåˆ¶åœ¨å‘é€æ–¹å…¶å®ä¸éœ€è¦åšä»€ä¹ˆäº‹æƒ…, å”¯ä¸€éœ€è¦åšçš„æ˜¯åœ¨å¿ƒè·³ackçš„termæ¯”è‡ªå·±çš„termå¤§çš„æƒ…å†µä¸‹, éœ€è¦é‡ç½®è‡ªå·±çš„çŠ¶æ€, è¿™å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å…¶ä»–èŠ‚ç‚¹è¶…æ—¶æ”¶ä¸åˆ°å¿ƒè·³è€Œå‘èµ·äº†æ–°çš„é€‰ä¸¾.\n\nå„ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªå…±åŒçš„peersæ•°ç»„, è¡¨ç¤ºé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œè®¿é—®åœ°å€\n\né€‰ä¸¾æ¯ä¸ªraftèŠ‚ç‚¹ä¼šåœ¨ä¸æ˜¯leaderçš„çŠ¶æ€ä¸”é€‰ä¸¾è¶…æ—¶çš„æƒ…å†µä¸‹å‘èµ·é€‰ä¸¾, æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹è½¬å˜ä¸ºä¸€ä¸ªå‘¨æœŸæ€§è¿‡ç¨‹: å³æ¯éš” election timeout å°±å°è¯•å‘èµ·æ–°çš„é€‰ä¸¾, å¦‚æœå·²ç»æ˜¯leaderçŠ¶æ€(ä¸Šä¸€æ¬¡é€‰ä¸¾æˆåŠŸ)æˆ–è€…é€‰ä¸¾è¿˜æœªè¶…æ—¶(å…¶ä»–leaderåˆ·æ–°äº†èŠ‚ç‚¹çš„lastTickTime)åˆ™sleep, å¦åˆ™å‘èµ·é€‰ä¸¾. å…·ä½“é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹:\n\nå‘å…¶ä»–èŠ‚ç‚¹ç´¢è¦æŠ•ç¥¨\næ£€æŸ¥è¿”å›ç»“æœå’Œå½“å‰çŠ¶æ€\nå¦‚æœä¸æ˜¯candidate(è¯´æ˜æœ‰æ–°çš„leaderé‡ç½®äº†å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€)æˆ–è€…å½“å‰çš„termå·²ç»è¢«å…¶ä»–é€‰ä¸¾æ›´æ–°è¿‡, åˆ™ç›´æ¥é€€å‡ºé€‰ä¸¾\nè¿”å›çš„termæ›´æ–°, åˆ™è¯´æ˜å½“å‰candidateçŠ¶æ€æ— æ•ˆ, é‡ç½®å½“å‰çŠ¶æ€å¹¶é€€å‡ºé€‰ä¸¾\n\n\nè¿”å›ç»“æœä¸ºtrue, åˆ™è®°ä¸€ç¥¨, è¶…è¿‡åŠæ•°çš„ç¥¨çš„æƒ…å†µ, å½“å‰èŠ‚ç‚¹å½“é€‰leaderå¹¶ç«‹åˆ»å‘èµ·å¿ƒè·³ç»™å…¶ä»–èŠ‚ç‚¹åŒæ­¥çŠ¶æ€.\n\næ³¨æ„ç‚¹\nä»»ä½•éœ€è¦æŸ¥è¯¢å’Œä¿®æ”¹raftçŠ¶æ€çš„æ“ä½œéƒ½éœ€è¦åŠ é”\né¿å…åœ¨æŒæœ‰é”çš„è¿‡ç¨‹ä¸­è¯·æ±‚å…¶ä»–çš„é”, ææ˜“å‘ç”Ÿæ­»é”\né¿å…æŒæœ‰é”çš„è¿‡ç¨‹ä¸­å‘ç”Ÿrpcç­‰è€—æ—¶çš„ç½‘ç»œè°ƒç”¨, åº”åœ¨rpcè°ƒç”¨ä¹‹å‰é‡Šæ”¾é”. æ¥æ”¶è¿”å›ç»“æœååœ¨åŠ é”å¤„ç†åç»­é€»è¾‘\n\n","categories":["6.824"],"tags":["go","åˆ†å¸ƒå¼"]},{"title":"é¢è¯•16ç§ä»£ç æ¨¡å¼æ€»ç»“(1) - æ»‘åŠ¨çª—å£","url":"/2021/04/04/sliding-window/","content":"æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹Grokking the Coding Interview: Patterns for Coding Questionsè¯¾ç¨‹çš„æ€»ç»“ï¼Œç¼–ç¨‹è¯­è¨€ä½¿ç”¨Goã€‚è¯»è€…å¦‚æœæƒ³è¦æ›´ç»†è‡´çš„äº†è§£ï¼Œè¯·è‡ªè¡Œè´­ä¹°è¯¾ç¨‹å­¦ä¹ ã€‚\né—®é¢˜èƒŒæ™¯åœ¨å¤„ç†æ•°ç»„å’Œé“¾è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦æ‰¾å‡ºæ»¡è¶³æŸäº›æ¡ä»¶çš„è¿ç»­å­åˆ—, æ¯”å¦‚å­åˆ—çš„å’Œæœ€å¤§ç­‰ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£çš„æ€æƒ³æ¥è¿›è¡Œè§£ç­”ã€‚è¿™é‡Œæ³¨æ„çš„æ˜¯å­åˆ—å¯ä»¥æ˜¯å›ºå®šå¤§å°ä¹Ÿå¯ä»¥æ˜¯å¯å˜å¤§å°ï¼Œä¸¤ç§æƒ…å†µæœ‰ç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚\n\n\nä¸‹é¢å…ˆç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åœ¨ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ¯ä¸ªsizeä¸ºKçš„è¿ç»­å­åˆ—çš„å¹³å‡å€¼ã€‚  \nArray: [1, 3, 2, 6, -1, 4, 1, 8, 2], K=5Output: [2.2, 2.8, 2.4, 3.6, 2.8]\n\næ»‘åŠ¨çª—å£çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹:\nfunc findAveragesOfSubArraysBySlidingWindow(K int, arr []int) []float64 &#123;    results := make([]float64, len(arr)-K+1)    windowSum := 0    windowStart := 0    for windowEnd := 0; windowEnd &lt; len(arr); windowEnd++ &#123;        // æŠŠä¸‹ä¸ªå…ƒç´ åŠ ä¸Š        windowSum += arr[windowEnd]        // æ»‘åŠ¨çª—å£ï¼Œç‰¹åˆ«åœ°ï¼Œå¦‚æœæ²¡æœ‰è¾¾åˆ°Kä¸ªåˆ™ä¸æ»‘åŠ¨        if windowEnd &gt;= K-1 &#123;            // å½“å‰windowSumè®¡ç®—äº†æ•´ä¸ªçª—å£çš„å’Œ            results[windowStart] = float64(windowSum) / float64(K)            // å½“å‰çª—å£è®¡ç®—å®Œåï¼Œç§»åŠ¨çª—å£éœ€è¦å…ˆå‡å»åŸæ¥çª—å£å¤´éƒ¨çš„å…ƒç´             windowSum -= arr[windowStart]            windowStart++        &#125;    &#125;    return results&#125;\n\nè§£æ³•æ€»ç»“æ ¹æ®çª—å£å¤§å°æ˜¯å¦å›ºå®šï¼Œåˆ†ä¸ºå›ºå®šå¤§å°å’Œå¯å˜å¤§å°\nå›ºå®šå¤§å°è¿™é‡Œæ‹¿ æ‰¾å‡ºsize=kçš„æœ€å¤§è¿ç»­å­åºåˆ—å’Œ ä½œä¸ºä¾‹å­\nGiven an array of positive numbers and a positive number k,find the maximum sum of any contiguous subarray of size k.Input: [2, 1, 5, 1, 3, 2], k=3Output: 9Explanation: Subarray with maximum sum is [5, 1, 3].Input: [2, 3, 4, 1, 5], k=2Output: 7Explanation: Subarray with maximum sum is [3, 4].\n\nè§£å†³æ–¹æ¡ˆ\nfunc max(x, y int) int &#123;    if x &gt; y &#123;        return x    &#125; else &#123;        return y    &#125;&#125;func solution(arr []int, k int) int &#123;    var (        windowStart = 0        windowSum = 0 // ç”¨äºè®°å½•å½“å‰çª—å£çš„çŠ¶æ€        maxSum = 0 // ç”¨äºè®°å½•æœ€å¥½çš„çŠ¶æ€    )    for windowEnd:=0;windowEnd&lt;len(arr);windowEnd++&#123;        // è¿™ä¸€æ­¥æ˜¯çª—å£çš„å³ä¾§è¿›è¡Œä¸€æ ¼æ‰©å¼ ï¼ŒåŒæ—¶æ›´æ–°å½“å‰çª—å£çš„çŠ¶æ€        windowSum += arr[windowEnd]        // åˆ¤æ–­å½“å‰çª—å£æ˜¯å¦æ»¡è¶³ç›¸åº”æ¡ä»¶        if windowEnd &gt;= k-1&#123;            // æ›´æ–°æœ€å¥½çš„çŠ¶æ€            maxSum = max(maxSum, windowSum)            // æ”¶ç¼©çª—å£å·¦ä¾§            windowSum -= arr[windowStart]            windowStart--        &#125;    &#125;    return maxSum&#125;\n\n\nç›¸å…³ç»ƒä¹ : [1][2][3]\n\nå¯å˜å¤§å°è¿™é‡Œé€šè¿‡é•¿åº¦æœ€å°çš„å­æ•°ç»„æ¥è¯´æ˜\nfunc min(i, j int) int &#123;    if i&lt;j &#123;        return i    &#125;else&#123;        return j    &#125;&#125;func minSubArrayLen(target int, nums []int) int &#123;    var(        windowStart = 0        windowSum = 0        minSize = -1    )    for windowEnd:=0;windowEnd&lt;len(nums);windowEnd++&#123;        // çª—å£å³ä¾§æ‰©å¼ ï¼Œè¿™ä¸ªéƒ¨åˆ†å’Œå›ºå®šå¤§å°æ˜¯ä¸€æ ·çš„        windowSum+=nums[windowEnd]        // è¿™ä¸ªéƒ¨åˆ†æ˜¯ä¸å›ºå®šå¤§å°ç±»å‹æœ€å¤§çš„åŒºåˆ«        // ä¸åŒäºå›ºå®šå¤§å°æ¯æ¬¡çš„å³ä¾§æ‰©å¼ å’Œå·¦ä¾§æ”¶ç¼©æ˜¯åŒæ­¥çš„        // å¯å˜å¤§å°çš„å·¦ä¾§æ”¶ç¼©éœ€è¦å¾ªç¯åˆ¤æ–­çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶        // å¯èƒ½å³ä¾§æ‰©å¼ äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯å·¦ä¾§æ‰æ”¶ç¼©ä¸€å›        // ä¹Ÿå¯èƒ½å³ä¾§æ‰©å¼ ä¸€æ¬¡ï¼Œå·¦ä¾§éœ€è¦æ”¶ç¼©å‡ å›        for windowSum&gt;=target&#123;            if minSize==-1&#123;                minSize = windowEnd-windowStart+1            &#125;else&#123;                minSize = min(minSize, windowEnd-windowStart+1)            &#125;             windowSum-=nums[windowStart]            windowStart++        &#125;        // å¯¹äºä¸€äº›æƒ…å†µæ¡ä»¶éœ€è¦è¿›è¡Œåå¤„ç†ï¼Œæ¯”å¦‚å½“æ”¶ç¼©çª—å£ç›´åˆ°çª—å£å†…å•ä¸€å­—ç¬¦æ•°é‡&lt;k        // ç„¶åå†æ¯”è¾ƒå½“å‰çª—å£çš„å¤§å°    &#125;    if minSize==-1&#123;        return 0    &#125;    return minSize&#125;\n\n\nç›¸å…³ç»ƒä¹ é¢˜: [1][2][3][4][5][6][7]\n\nç‰¹æ®Šä¾‹å­æœ€å°è¦†ç›–å­ä¸²åŸé¢˜è§leetcode\nfunc findSubstring(str, pattern string) string &#123;    // è¾¹ç•Œ     if len(pattern)&gt;len(str)&#123;        return &quot;&quot;    &#125;    var (        windowStart = 0        matched     = 0        minLength   = len(str) + 1        subStrStart = 0        patternMap  = make(map[byte]int)    )    for i := 0; i &lt; len(pattern); i++ &#123;        patternMap[pattern[i]]++    &#125;    for windowEnd := 0; windowEnd &lt; len(str); windowEnd++ &#123;        wright := str[windowEnd]        if _, ok := patternMap[wright]; ok &#123;            patternMap[wright]--             // å…³é”®ç‚¹1, ä¸å†æ˜¯==0ï¼Œè€Œæ˜¯&gt;=0ï¼Œå› ä¸ºåŒ…å«æ‰€æœ‰çš„å­—ç¬¦            if patternMap[wright] &gt;= 0 &#123;                matched++            &#125;        &#125;        // å¦‚æœå½“å‰windowåŒ…å«patternæ‰€æœ‰çš„å­—ç¬¦ï¼Œåˆ™ä»å·¦æ”¶ç¼©çª—å£è‡³ä¸å®Œå…¨åŒ…å«çŠ¶æ€         // æ³¨æ„è¿™é‡Œç­‰å·å³ä¾§ä¸æ˜¯len(patternMap)ï¼Œå› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰å­—ç¬¦        for matched == len(pattern) &#123;             if minLength &gt; windowEnd-windowStart+1 &#123;                minLength = windowEnd - windowStart + 1                subStrStart = windowStart            &#125;            wleft := str[windowStart]            if _, ok := patternMap[wleft]; ok &#123;                // å…³é”®ç‚¹2ï¼Œåªè¦æœ‰ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ç§»é™¤äº†çª—å£ï¼Œåˆ™åœæ­¢æ”¶ç¼©                if patternMap[wleft] == 0 &#123;                    matched--                &#125;                patternMap[wleft]++            &#125;            windowStart++        &#125;    &#125;    if minLength &gt; len(str) &#123;        return &quot;&quot;    &#125; else &#123;        return str[subStrStart : subStrStart+minLength]    &#125;&#125;\nFAQ: è¿™é‡Œå¯¹ä¸Šè¿°ä»£ç åšä¸€å®šçš„è§£é‡Šï¼Œä¸»è¦å›°æƒ‘ç‚¹åœ¨äºä¸¤ä¸ªå…³é”®ç‚¹Q: ä¸ºä»€ä¹ˆå…³é”®ç‚¹1å¤„æ˜¯&gt;=0ï¼ŸA: å› ä¸ºæ˜¯è¦åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œå› ä¸ºæ¯é‡åˆ°ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å­—ç¬¦ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹patternMapä¸­å¯¹åº”å€¼åšå‡æ³•å¹¶matched++, ç›´åˆ°æˆ‘ä»¬åŒ¹é…å®Œäº†patternæ‰€æœ‰è¯¥å­—ç¬¦ï¼Œæ­¤æ—¶å¯¹äºå¤šä½™è¯¥å­—ç¬¦æˆ‘ä»¬åªéœ€è¦æ›´æ–°patternMapï¼Œä½†æ˜¯ä¸å¿…å†æ›´æ–°matchedã€‚\nQ: ä¸ºä»€ä¹ˆå…³é”®ç‚¹2å¤„æ˜¯==0ï¼ŸA: è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœçª—å£åŒä¸€ä¸ªå­—ç¬¦æ²¡æœ‰å†—ä½™ï¼Œé‚£ä¹ˆç§»é™¤äº†ä¸€ä¸ªè¯¥å­—ç¬¦åˆ™æ„å‘³ç€åŒ¹é…ä¸å®Œå…¨ï¼Œä½†æ˜¯å¦‚æœçª—å£å†…è¯¥å­—ç¬¦æœ‰å†—ä½™ï¼Œæ¯”å¦‚patternæ˜¯aabï¼Œè€Œçª—å£å†…æœ‰3ä¸ªaï¼Œæ­¤æ—¶aæœ‰å†—ä½™ï¼Œå¦‚æœæ”¶ç¼©çª—å£åªç§»å‡ºäº†ä¸€ä¸ªaï¼Œé‚£ä¹ˆæ­¤æ—¶çª—å£ä¾ç„¶æ˜¯æ»¡è¶³åŒ¹é…å®Œå…¨æ¡ä»¶çš„ï¼Œåæ˜ åˆ°ä»£ç ä¸Šï¼Œæ”¶ç¼©å‰patternMap[&#39;a&#39;] = -1 (åœ¨2çš„åŸºç¡€-3)ï¼Œæ”¶ç¼©åpatternMap[&#39;a&#39;]=0ï¼Œå› æ­¤å¦‚æœæ”¶ç¼©æ‰ä¸‹ä¸€ä¸ªaï¼Œåˆ™éœ€è¦matchedâ€“äº†ã€‚\nä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²åŸé¢˜è§leetcodeè¿™ä¸ªé¢˜ç›®ä¸»è¦è¦å¯¹é¢˜æ„ç†è§£æ¸…æ¥šï¼Œé¦–å…ˆç›®æ ‡å­ä¸²éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š\n\né•¿åº¦ç­‰äºå•è¯åˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯é•¿åº¦*å•è¯ä¸ªæ•°\nå­ä¸²ä¸å¯ä»¥å‡ºç°ä¸åœ¨åˆ—è¡¨ä¸Šçš„å…¶ä»–å•è¯\n\nfunc findWordConcatenation(str string, words []string) []int &#123;    if len(words)==0||len(str)==0&#123;        return []int&#123;&#125;    &#125;    var (        wordFreqMap = make(map[string]int)        wordsCount  = len(words)        wordLength  = len(words[0])        // å­˜å‚¨æ»¡è¶³æ¡ä»¶çš„index        startIndex  = make([]int, 0, 10)     )    // è®°å½•æ¯ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡    for _, v := range words &#123;        wordFreqMap[v]++    &#125;    // æ³¨æ„è¿™ä¸ªä¸æ˜¯å¸¸è§„çš„sliding window pattern     // iè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå­ä¸²çš„èµ·å§‹ä½ç½®ï¼Œä»æ¡ä»¶å¯çŸ¥æ¯ä¸ªå­ä¸²æ˜¯å›ºå®šé•¿åº¦çš„     // æ‰€ä»¥iæœ€å¤§ä¸ºlen(str)-wordLength*wordsCount    for i := 0; i &lt;= len(str)-wordLength*wordsCount; i++ &#123;        wordsSeenMap := make(map[string]int) // key1: ä¿å­˜çœ‹è¿‡çš„wordçš„æ•°é‡        // å¯¹ä»å½“å‰index iå¼€å§‹çš„é•¿åº¦ä¸ºwordLength*wordsCountçš„stringè¿›è¡Œåˆ¤å®š        for j := 0; j &lt; wordsCount; j++ &#123;            nextWordIndex := i + j*wordLength // å½“å‰wordçš„å¼€å§‹index            word := str[nextWordIndex : nextWordIndex+wordLength]            // å¦‚æœå‡ºç°ä¸åœ¨wordsæ•°ç»„ä¸­çš„wordï¼Œåˆ™ç›´æ¥è·³å‡º            if _, ok := wordFreqMap[word]; !ok &#123;                break            &#125;            wordsSeenMap[word]++             // å¦‚æœwordsæ•°ç»„ä¸­æŸä¸ªwordæ•°é‡å‡ºç°æ¬¡æ•°è¿‡å¤šæ„å‘³ç€ä¸€å®šä¼šæœ‰å…¶ä»–å•è¯ä¸åœ¨ï¼Œåˆ™ä¹Ÿç›´æ¥è·³å‡º            if wordsSeenMap[word] &gt; wordFreqMap[word] &#123;                break            &#125;            // å¦‚æœéå†åˆ°è¯¥stringçš„æœ€åä¸€ä¸ªå­—ç¬¦éƒ½æ²¡è·³å‡ºå¾ªç¯ï¼Œæ„å‘³è¯¥stringæ˜¯æ»¡è¶³æ¡ä»¶çš„            if j == wordsCount-1 &#123;                startIndex = append(startIndex, i)            &#125;        &#125;        // ===end===    &#125;    return startIndex&#125;\n\n\nREFERENCE[1] https://www.educative.io/courses/grokking-the-coding-interview[2] https://github.com/zhiwei-Feng/Golang-Grokking-the-Coding-Interview-Patterns-for-Coding-Questions\n","categories":["é¢è¯•","16ç§ä»£ç æ¨¡å¼"],"tags":["go","algorithm","sliding window"]},{"title":"ä»6.824çš„kv.goç†è§£tcpåè®®","url":"/2021/04/11/socket-analysis-for-6-824-kv-go/","content":"æœ¬æ–‡æ˜¯åœ¨å­¦ä¹ 6.824è¯¾ç¨‹æ—¶ï¼Œå¯¹Lec 2çš„kv.goäº§ç”Ÿçš„å›°æƒ‘çš„è§£é‡Šå’Œæ€»ç»“ã€‚\n\n\nkv.goé¦–å…ˆå¯¹kv.goçš„æƒ…å†µè¿›è¡Œè§£é‡Šã€‚è¿™é‡Œåªä¼šå–ä¸€äº›é‡ç‚¹ç‰‡æ®µè¿›è¡Œè§£é‡Šï¼Œéœ€è¦\bäº†è§£å®Œæ•´ä»£ç ç»†èŠ‚çš„ï¼Œè¯»è€…å¯è‡ªè¡Œé€‰æ‹©æ–‡ç« æœ€åçš„å‚è€ƒæ¡ç›®è¿›è¡Œè¯¦ç»†äº†è§£ã€‚\nä¸»é€»è¾‘func main() &#123;    //å¯åŠ¨rpcæœåŠ¡ï¼Œä¸€ä¸ªkvå­˜å‚¨    server()     //å†™å…¥ä¸€ä¸ªkvé”®å€¼å¯¹    put(&quot;subject&quot;, &quot;6.824&quot;)    fmt.Printf(&quot;Put(subject, 6.824) done\\n&quot;)    //è¯»å‡ºåˆšæ‰å­˜å‚¨çš„keyçš„value    fmt.Printf(&quot;get(subject) -&gt; %s\\n&quot;, get(&quot;subject&quot;))&#125;\nä¸»é€»è¾‘éå¸¸ç®€å•ï¼Œå¯åŠ¨ä¸€ä¸ªkvå­˜å‚¨çš„rpcæœåŠ¡ï¼Œç„¶åè¿è¡Œç®€å•çš„è¯»å†™åŠŸèƒ½æµ‹è¯•ã€‚\nserver()func server() &#123;    kv := new(KV)    kv.data = map[string]string&#123;&#125;    rpcs := rpc.NewServer()    rpcs.Register(kv)    l, e := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)    if e != nil &#123;        log.Fatal(&quot;listen error:&quot;, e)    &#125;    go func() &#123;        for &#123;            conn, err := l.Accept()            if err == nil &#123;                go rpcs.ServeConn(conn)            &#125; else &#123;                break            &#125;        &#125;        l.Close()    &#125;()&#125;\nå¯åŠ¨æœåŠ¡ï¼Œç›‘å¬1234ç«¯å£ï¼Œå¹¶å¼€å§‹æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥\nclientfunc get(key string) string &#123;    client := connect()    args := GetArgs&#123;key&#125;    reply := GetReply&#123;&#125;    err := client.Call(&quot;KV.Get&quot;, &amp;args, &amp;reply)    if err != nil &#123;        log.Fatal(&quot;error:&quot;, err)    &#125;    client.Close()    return reply.Value&#125;func put(key string, val string) &#123;    client := connect()    args := PutArgs&#123;key, val&#125;    reply := PutReply&#123;&#125;    err := client.Call(&quot;KV.Put&quot;, &amp;args, &amp;reply)    if err != nil &#123;        log.Fatal(&quot;error:&quot;, err)    &#125;    client.Close()&#125;\nå®¢æˆ·ç«¯æ–¹æ³•æ€»ä½“é€»è¾‘æ˜¯ä¸€è‡´ï¼Œé¦–å…ˆè¿›è¡Œtcpè¿æ¥çš„å»ºç«‹ï¼Œç„¶åè¿›è¡Œrpcæ–¹æ³•è°ƒç”¨ï¼Œæœ€åå…³é—­è¿æ¥\nè§£æè¿‡ç¨‹å¦‚æœä½ è¿è¡Œè¯¥ç¨‹åºï¼Œä¼šå‘ç°æ‰“å°å¦‚ä¸‹ï¼š\n$ go run kv.goPut(subject, 6.824) doneget(subject) -&gt; 6.824$\n\nä¸ºä»€ä¹ˆç¨‹åºæœ€åä¼šé€€å‡ºï¼Œè€Œä¸æ˜¯å› ä¸ºserveråœ¨ç›‘å¬é˜»å¡ä½ã€‚æˆ‘è‡ªå·±çš„è§£é‡Šæ˜¯ï¼šé¦–å…ˆæ˜¯å› ä¸ºserver()ä¸­çš„æ— é™æ¥æ”¶è¯·æ±‚çš„å¾ªç¯æ˜¯è¿è¡Œåœ¨goroutineå½“ä¸­ï¼Œæ‰€ä»¥ä¹‹åçš„å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥å¹¶å‘çš„è¿è¡Œï¼›å…¶æ¬¡å› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰å…¶ä»–æ–¹æ³•çš„é˜»å¡ï¼Œæ‰€ä»¥ä¼šåœ¨æ‰€æœ‰é€»è¾‘ç»“æŸåé€€å‡ºï¼Œä¹Ÿæ„å‘³è¯¥è¿›ç¨‹é€€å‡ºäº†ï¼Œè¿™æ ·å…¶ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç»“æŸï¼ŒåŒ…æ‹¬å…¶ä¸­åˆ›å»ºçš„goroutineã€‚\nå¦‚æœè¯»è€…æœ‰æ›´å¥½çš„è§£é‡Šæ¬¢è¿ç•™è¨€è®¨è®ºã€‚\n\nåœ¨è¯¥ç¨‹åºçš„ä¸»é€»è¾‘ä¸­ï¼Œå®é™…å‘ç”Ÿäº†ä¸¤æ¬¡tcpè¿æ¥ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€æ¬¡tcpåè®®çš„è¿è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥åˆ›å»ºã€æ•°æ®ä¼ é€å’Œè¿æ¥ç»ˆæ­¢ã€‚server()ä¸‹å¼€å¯çš„rpcæœåŠ¡ç›‘å¬ç€1234ç«¯å£ï¼Œè€Œgetå’Œput()ä¸­çš„connect()åˆ™å®Œæˆä¸€æ¬¡tcpè¿æ¥åˆ›å»ºçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚å›¾ä¸‹\n\næ­¤æ—¶é€šè¿‡netstatå‘½ä»¤æŸ¥çœ‹ä¼šå‡ºç°æœ‰ä¸¤ä¸ªè¿æ¥ä»¥åŠä¸€ä¸ªç›‘å¬  \n\nå½“æ•°æ®ä¼ é€å®Œæ¯•ï¼Œgetå’Œput()è°ƒç”¨Close()æ–¹æ³•è¿›å…¥è¿æ¥ç»ˆæ­¢é˜¶æ®µï¼ˆå››æ¬¡æ¡æ‰‹ï¼‰åï¼Œå®¢æˆ·ç«¯çŠ¶æ€åˆ™ä¼šè¿›å…¥TIME_WAITçŠ¶æ€\n\n\nç­‰å¾…2MSLåï¼Œå®¢æˆ·ç«¯Closeã€‚\n\nå¦‚æœå¸Œæœ›å¯¹TCPçš„è®¾è®¡æƒ³è¦æ›´æ·±å…¥äº†è§£ï¼Œå¯ä»¥å‚è€ƒ  \n\nä¸ºä»€ä¹ˆ TCP åè®®æœ‰ TIME_WAIT çŠ¶æ€  \nä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹  \nWhy is the TCP connection terminated in a 4-way handshake?\n\n\nREFERENCE[1] 6.824 kv.go[2] ç»´åŸºç™¾ç§‘  \n","categories":["è®¡ç®—æœºç½‘ç»œ"],"tags":["go","network","socket","tcp"]},{"title":"Leetcode ç»„åˆæ€»å’Œé—®é¢˜æ€»ç»“","url":"/2022/04/18/summary-of-combination-sum/","content":"ç»„åˆæ€»å’Œç³»åˆ—é¢˜æ€»ç»“.\n\n39. ç»„åˆæ€»å’Œ\n40. ç»„åˆæ€»å’ŒII\n216. ç»„åˆæ€»å’ŒIII\n377. ç»„åˆæ€»å’ŒIV\n\nç»„åˆæ€»å’Œæœ¬é¢˜æ³¨æ„candidatesæ˜¯æ— é‡å¤å…ƒç´ ,ä¸”å…ƒç´ éƒ½å¤§äº0, åˆ©ç”¨backtraceçš„æ€æƒ³æ±‚è§£å³å¯\nfunc combinationSum(candidates []int, target int) [][]int &#123;    ans := [][]int&#123;&#125;    path := []int&#123;&#125;    pathSum := 0    var backtrace func(idx int)    backtrace = func(idx int) &#123;        if idx == len(candidates) || pathSum &gt;= target &#123;            if pathSum == target &#123;                tmp := make([]int, len(path))                copy(tmp, path)                ans = append(ans, tmp)            &#125;            return        &#125;        backtrace(idx+1)        for i:=1;i&lt;=target/candidates[idx];i++&#123;            if candidates[idx]*i+pathSum&lt;=target &#123;                pathSum+=candidates[idx]*i                for k:=0;k&lt;i;k++&#123;                    path = append(path, candidates[idx])                &#125;                backtrace(idx+1)                pathSum-=candidates[idx]*i                path = path[:len(path)-i]            &#125;else &#123;                break            &#125;        &#125;    &#125;    backtrace(0)    return ans&#125;\n\nç»„åˆæ€»å’ŒIIæœ¬é¢˜çš„å…³é”®æ˜¯å¦‚ä½•å»é‡, æ€è·¯ä¾æ—§æ˜¯backtrace. å…·ä½“å»é‡çš„æ€æƒ³å¦‚ä¸‹:\n\nå¯¹äºcandidateså’Œtargetä»¥åŠå½“å‰ç´¢å¼•idx, æˆ‘ä»¬ä¿è¯candidates[idx]åªèƒ½è¢«é€‰å–ä¸€æ¬¡æ¥æ‰£å‡target, ä»è€Œä¿è¯å½“å‰æƒ…å†µä¸‹æ²¡æœ‰é‡å¤, å¹¶å°†é—®é¢˜è½¬åŒ–ä¸ºcandidates[idx+1:]å‡‘æˆtarget-candicates[idx]çš„å­é—®é¢˜.\nä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿çš„é¿å…é‡å¤candidatesçš„é€‰å–, æˆ‘ä»¬å°†candidatesé¦–å…ˆè¿›è¡Œæ’åº\n\nfunc combinationSum2(candidates []int, target int) [][]int &#123;    var (        ans = make([][]int, 0)        path = make([]int, 0)        backtrace func(int, int)        n = len(candidates)    )    sort.Ints(candidates)    backtrace = func(begin int, remain int) &#123;        if remain==0 &#123;            ans = append(ans, append([]int&#123;&#125;, path...))            return        &#125;        for i:=begin;i&lt;n;i++&#123;            if candidates[i]&gt;remain&#123;                // å½“å‰å€™é€‰å€¼å¤ªå¤§ï¼Œå‰ªæ                break            &#125;            if i&gt;begin&amp;&amp;candidates[i]==candidates[i-1]&#123;                // å› ä¸ºcandidates[i-1]å­˜åœ¨è¢«é€‰å–çš„æƒ…å†µ, ä¸ºé¿å…é‡å¤è·³è¿‡åç»­çš„é‡å¤å…ƒç´                 continue            &#125;            path = append(path, candidates[i])            backtrace(i+1, remain-candidates[i])            path = path[:len(path)-1]        &#125;    &#125;    backtrace(0, target)    return ans&#125;\n\nç»„åˆæ€»å’ŒIIIæ³¨æ„æ¡ä»¶ä¸­éœ€è¦ç»„åˆåˆ—è¡¨ä¸ªæ•°ç­‰äºk, å› æ­¤å›æº¯çš„è¿”å›æ¡ä»¶å› åŠ å…¥åˆ¤æ–­.\nfunc combinationSum3(k int, n int) (ans [][]int) &#123;    path := []int&#123;&#125;    var backtrace func(idx, remain int)    backtrace = func(idx, remain int) &#123;        if idx &gt; 9 || remain == 0 || len(path) == k &#123;            // idxè¡¨ç¤ºå½“å‰éå†åˆ°çš„æ•°å­—, å¤§äº9åˆ™è¿‡ç•Œ            // åŒæ—¶å¦‚æœremainç­‰äº0, æˆ–è€…pathçš„é•¿åº¦è¾¾åˆ°käº†éƒ½å±äºåˆ°è¾¾è¾¹ç•Œçš„æƒ…å†µ            if remain == 0 &amp;&amp; len(path) == k &#123;                ans = append(ans, append([]int&#123;&#125;, path...))            &#125;            return        &#125;        for i:=idx;i&lt;=9;i++&#123;            if i&gt;remain &#123;                break            &#125;            path = append(path, i)            backtrace(i+1, remain-i)            path = path[:len(path)-1]        &#125;    &#125;    backtrace(1, n)    return&#125;\n\nç»„åˆæ€»å’ŒIV(*)æœ¬é¢˜ä½¿ç”¨backtraceä¼šè¶…æ—¶, å› æ­¤éœ€è¦ä½¿ç”¨dpæ¥è§£, æœ¬é¢˜çš„dpè§£æ³•ç±»ä¼¼äºå®Œå…¨èƒŒåŒ…é—®é¢˜, ä½†éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºtarget=7, nums=[1,2,3]çš„è¾“å…¥, å®Œå…¨èƒŒåŒ…è®¤ä¸º[1,2,3], [1,3,2], [2,1,3], [2,3,1], [3,1,2], [3,2,1]å…­ç§æƒ…å†µæ˜¯ä¸€ç§æ–¹æ¡ˆ, è€Œæœ¬é¢˜è®¤ä¸ºæ˜¯å…­ç§æ–¹æ¡ˆ, è¿™ä¸€ç‚¹æ˜¯æœ¬é¢˜è§£æ³•çš„å…³é”®.\nfunc combinationSum4(nums []int, target int) int &#123;    n := target    // dpçš„å«ä¹‰, dp[i][j]å¯¹äºé•¿åº¦içš„ç»„åˆ, æ€»å’Œä¸ºjçš„æ–¹æ¡ˆæ•°, æœ¬é¢˜ç”±äºnumså…¨éƒ¨ä¸ºæ­£æ•°, å› æ­¤iæœ€å¤§ä¸ºtarget    dp := make([][]int, n+1)    for i:=range dp &#123;        dp[i] = make([]int, target+1)    &#125;    dp[0][0]=1    ans := 0    for i:=1;i&lt;=n;i++&#123;        for j:=0;j&lt;=target;j++&#123;            for _, u := range nums &#123;                if j&gt;=u &#123;                    dp[i][j]+=dp[i-1][j-u]                &#125;            &#125;        &#125;        // å¯¹äºä¸åŒé•¿åº¦çš„ç»„åˆ, æ€»å’Œä¸ºtargetçš„æ–¹æ¡ˆ, æˆ‘ä»¬ç´¯åŠ         ans += dp[i][target]    &#125;    return ans&#125;\n\næ•°ç»„é™ç»´, å‡å°‘ç©ºé—´å¤æ‚åº¦\nfunc combinationSum4(nums []int, target int) int &#123;    n := target    dp := make([]int, target+1)    dp[0]=1    ans := 0    for i:=1;i&lt;=n;i++&#123;        for j:=target;j&gt;=0;j--&#123;            dp[j] = 0            for _, u := range nums &#123;                if j&gt;=u &#123;                    dp[j]+=dp[j-u]                &#125;            &#125;        &#125;        ans += dp[target]    &#125;    return ans&#125;\n\nè¿›ä¸€æ­¥å‡å°‘æ—¶é—´å¤æ‚åº¦\nfunc combinationSum4(nums []int, target int) int &#123;    // è¿™ä¸ªè§£æ³•ç±»ä¼¼äºçˆ¬æ¥¼æ¢¯, å¯¹äºæ¯ä¸ªæ€»å’Œjè€Œè¨€, numsä¸ºæ¯æ¬¡æ”€çˆ¬çš„æ¥¼æ¢¯æ•°    // æ‰€ä»¥ dp[j] = sum of &#123; dp[j-nums[i]] for each i belong to 0..len(nums) &#125;    dp := make([]int, target+1)    dp[0]=1    for j:=1;j&lt;=target;j++&#123;        for _, u := range nums &#123;            if j&gt;=u &#123;                dp[j]+=dp[j-u]            &#125;        &#125;    &#125;    return dp[target]&#125;\n","categories":["ç®—æ³•"],"tags":["algorithm","leetcode","backtrace"]},{"title":"Leetcode æœ€å¤§çŸ©å½¢é—®é¢˜æ€»ç»“","url":"/2022/05/27/summary-of-largest-rectangle/","content":"æ¦‚è¿°è¯¥èŠ‚è®¾è®¡çš„Leetcodeé¢˜ç›®ä¸º:\n\n84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢\n85. æœ€å¤§çŸ©å½¢\n\nå®é™…ä¸Š, 85é¢˜å¯ä»¥çœ‹ä½œæ˜¯åŸºäº84é¢˜æ¥æ‹“å±•äº†ä¸€ç»´çš„é—®é¢˜.é¦–å…ˆæ¥çœ‹84é¢˜,å¦‚ä¸‹å›¾,å¯ä»¥çœ‹åˆ°é¢˜ç›®çš„æ„æ€å°±æ˜¯ç»™å®šä¸€ç»„å®½åº¦ä¸º1çš„çŸ©å½¢å—,æ±‚å‡ºå…¶ä¸­å¯ä»¥æ„æˆçš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯.\n84.æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ä¸éš¾çœ‹å‡º,è¿™é‡Œé¢æœ‰ä¸ªéšå«çš„æç¤º,åŠå¯¹äºæŸä¸ªçŸ©å½¢å—(é«˜åº¦ä¸ºx)è€Œè¨€,è¦æƒ³ä»¥å®ƒä½œä¸ºæœ€å¤§çŸ©å½¢çš„é«˜åº¦,é‚£ä¹ˆå°±å¿…é¡»ä¿è¯æ„æˆçŸ©é˜µçš„ç›¸é‚»é«˜åº¦éƒ½å¤§äºç­‰äºx.\næ¯”å¦‚è¯´ä¸Šå›¾ä¸­,æˆ‘ä»¬å¦‚æœè¦ä»¥çŸ©å½¢é«˜åº¦ä¸º5çš„å—ä½œä¸ºæœ€å¤§çŸ©å½¢çš„é«˜,åˆ™å·¦ä¾§å·²ç»æ²¡æœ‰å—é«˜åº¦å¤§äºç­‰äº5,æ‰€ä»¥å·¦ä¾§æ— æ³•æ‹“å±•,è€Œå³ä¾§å› ä¸ºæœ‰é«˜åº¦6çš„å—,æ‰€ä»¥å¯ä»¥æ‹“å±•ä¸€æ¬¡,æœ€ç»ˆæ„é€ å‡ºæ¥çš„çŸ©å½¢é¢ç§¯ä¸º2*5=10.\nå› æ­¤è§£æ³•å³ä¸ºéå†æ¯ä¸€ä¸ªå—é«˜åº¦,å¹¶ä»¥å®ƒä¸ºä¸­å¿ƒå‘ä¸¤ä¾§æ‹“å±•å¹¶è®¡ç®—å…¶æ‹“å±•åçš„çŸ©å½¢é¢ç§¯,å–å…¶ä¸­æœ€å¤§å€¼.ä½†æ˜¯æ˜¾ç„¶è¿™ç§åšæ³•æ—¶é—´å¤æ‚åº¦è¾ƒé«˜,å› ä¸ºå®ƒé‡å¤éå†ä¸¤ä¾§çš„å…ƒç´ .\nä¸Šè¿°è¿™ç§è§£æ³•æ¢ä¸ªè§’åº¦çœ‹å¯ä»¥è®¤ä¸ºæ˜¯æ‰¾åˆ°æŸä¸ªé«˜åº¦ä¸ºxçš„çŸ©å½¢å—å·¦ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºxçš„å—iå’Œå³ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºxå—j,åˆ™æ„æˆçš„çŸ©å½¢é¢ç§¯ä¸ºarea = x*(j-i-1).å¯å‘è‡ªå•è°ƒæ ˆçš„æ€æƒ³,æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªä¸¥æ ¼é€’å¢çš„æ ˆ,è¯¥æ ˆé‡Œé¢å­˜å‚¨çŸ©å½¢å—çš„ç´¢å¼•index,æ ˆä¸­å…ƒç´ æ»¡è¶³ä»åº•åˆ°é¡¶çš„çŸ©å½¢å—é«˜åº¦ä¸¥æ ¼é€’å¢.\n\nå•è°ƒæ ˆå¦‚ä½•å®ç°ä¸Šè¿°è§£æ³•?\n\nä¿è¯æ ˆå•è°ƒçš„åŒæ—¶å…¥æ ˆå½“å‰çš„çŸ©é˜µå—ç´¢å¼•i, è¿™æ ·å¯ä»¥ä¿è¯å·¦ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºheights[i]çš„çŸ©å½¢å—ç´¢å¼•å°±æ˜¯åº•ä¸‹çš„é‚£ä¸ªå…ƒç´ \nå¦ä¸€æ–¹é¢,å•è°ƒæ ˆå…¥æ ˆå‰éœ€è¦å¼¹å‡ºå…¶ä¸­é«˜åº¦å¤§äºç­‰äºå½“å‰å—ié«˜åº¦çš„ç´¢å¼•,è¿™ä¸€æ­¥å®é™…ä¸Šå¯¹äºæ¯ä¸ªå¼¹å‡ºçš„çŸ©é˜µå—kæ˜¯æ‰¾åˆ°äº†å³ä¾§ç¬¬ä¸€ä¸ªé«˜åº¦ä½äºheights[k]çš„çŸ©å½¢å—ç´¢å¼•,å³i.\n\n\nå› æ­¤,è§£æ³•å°±å¾ˆç›´æ¥,ç»´æŠ¤å•è°ƒæ ˆçš„è¿‡ç¨‹ä¸­,æ¯å¼¹å‡ºä¸€ä¸ªçŸ©å½¢å—ç´¢å¼•i,åˆ™ä»¥å…¶é«˜åº¦heights[i]ä¸ºçŸ©å½¢é«˜åº¦,å®½åº¦ä¸º(i-peek()-1)æ¥è®¡ç®—å½“å‰é¢ç§¯,å¦‚æ­¤å…¶ä¸­çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆ.å…·ä½“ä»£ç è¿‡ç¨‹å¦‚ä¸‹:\npublic int largestRectangleArea(int[] heights) &#123;    Deque&lt;Integer&gt; stk = new ArrayDeque&lt;&gt;();    var ans = 0;    for (int i = 0; i &lt; heights.length; i++) &#123;        while (!stk.isEmpty() &amp;&amp; heights[stk.peek()] &gt;= heights[i]) &#123;            var curIdx = stk.pop();            var leftIdx = stk.isEmpty() ? -1 : stk.peek();            ans = Math.max(ans, heights[curIdx] * (i - leftIdx - 1));        &#125;        stk.push(i);    &#125;    var rightIdx = heights.length;    while (!stk.isEmpty()) &#123;        var curIdx = stk.pop();        var leftIdx = stk.isEmpty() ? -1 : stk.peek();        ans = Math.max(ans, heights[curIdx] * (rightIdx - leftIdx - 1));    &#125;    return ans;&#125;\n\nç¨å¾®æ³¨æ„ä¸€ä¸‹è¾¹ç•Œé—®é¢˜, å½“å¼¹å‡ºæ ˆé¡¶çš„æ—¶å€™, å¦‚æœå·¦ä¾§æ²¡æœ‰å…ƒç´ ,å³æ ˆç©ºçš„æƒ…å†µä¸‹,å·¦ä¾§ç´¢å¼•å–-1. è€Œåœ¨éå†å®Œæˆå,æ ˆä¸ä¸ºç©º,åˆ™è¯´æ˜æ ˆä¸­æ¯ä¸ªå…ƒç´ çš„å³ä¾§ç´¢å¼•ä¸ºæ•°ç»„é•¿åº¦n(n=heights.length).\n\n85.æœ€å¤§çŸ©å½¢è¿™ä¸€é¢˜æˆ‘ä»¬å°†å…¶æ¯ä¸€è¡Œçœ‹ä½œä¸€ä¸ª84é¢˜ä¸­çš„heightsæ•°ç»„,å› æ­¤åªéœ€è¦éå†æ¯ä¸€è¡Œçš„å­—ç¬¦,å¦‚æœä¸ºâ€™1â€™åˆ™æ›´æ–°heightsä¸­å¯¹åº”ç´¢å¼•çš„é«˜åº¦(+1),å¦‚æœä¸ºâ€™0â€™,åˆ™ç½®0.ç„¶ååº”ç”¨84çš„ç®—æ³•è®¡ç®—è¯¥è¡Œçš„æœ€å¤§çŸ©å½¢é¢ç§¯.æœ€ç»ˆå–æ¯ä¸€è¡Œè®¡ç®—çš„é¢ç§¯æœ€å¤§å€¼ä¸ºç­”æ¡ˆ. ä»£ç å¦‚ä¸‹:\npublic int maximalRectangle(char[][] matrix) &#123;    if (matrix.length == 0) &#123;        return 0;    &#125;    var heights = new int[matrix[0].length];    var ans = 0;    for (int i = 0; i &lt; matrix.length; i++) &#123;        for (int j = 0; j &lt; matrix[i].length; j++) &#123;            if (matrix[i][j] == &#x27;1&#x27;) &#123;                heights[j]++;            &#125; else &#123;                heights[j] = 0;            &#125;        &#125;        ans = Math.max(ans, maxRec(heights));    &#125;    return ans;&#125;// 84.int maxRec(int[] heights) &#123;    var ans = 0;    Deque&lt;Integer&gt; stk = new ArrayDeque&lt;&gt;();    for (int i = 0; i &lt; heights.length; i++) &#123;        while (!stk.isEmpty() &amp;&amp; heights[stk.peek()] &gt;= heights[i]) &#123;            var curIdx = stk.pop();            var leftIdx = stk.isEmpty() ? -1 : stk.peek();            ans = Math.max(ans, heights[curIdx] * (i - leftIdx - 1));        &#125;        stk.push(i);    &#125;    var rightIdx = heights.length;    while (!stk.isEmpty()) &#123;        var curIdx = stk.pop();        var leftIdx = stk.isEmpty() ? -1 : stk.peek();        ans = Math.max(ans, heights[curIdx] * (rightIdx - leftIdx - 1));    &#125;    return ans;&#125;\n","categories":["ç®—æ³•"],"tags":["algorithm","leetcode","å•è°ƒæ ˆ"]},{"title":"Leetcode æ—‹è½¬æ’åºæ•°ç»„æœç´¢é—®é¢˜æ€»ç»“","url":"/2022/04/14/summary-of-search-in-rotated-sorted-array/","content":"æœ¬ç¯‡æ–‡ç« ä¸»è¦å¯¹leetcodeä¸Šå…³äºæ—‹è½¬æ’åºæ•°ç»„æœç´¢é—®é¢˜çš„äºŒåˆ†è§£æ³•ä¸€ä¸ªæ€»ç»“, å…·ä½“é¢˜ç›®é›†æœ‰ä»¥ä¸‹å‡ ä¸ªé¢˜ç›®\n\n33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„\n81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II\n153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼\n154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II\n\næˆ‘ä»¬å¯ä»¥æ ¹æ®æ’åºæ•°ç»„æ˜¯å¦å…è®¸é‡å¤å…ƒç´ å°†å…¶åˆ†ä¸ºå…ƒç´ ä¸å¯é‡å¤å’Œå¯é‡å¤ä¸¤ç±».\nå…ƒç´ ä¸å¯é‡å¤æ‰¾ç›®æ ‡å€¼å¯¹äºæ¯ä¸ªmidä½ç½®,æˆ‘ä»¬éƒ½æ ¹æ®ä»–å·¦ä¾§æœ‰åºè¿˜æ˜¯å³ä¾§æœ‰åºæ¥è€ƒè™‘æ˜¯å¦ç¼©å‡å·¦è¾¹ç•Œè¿˜æ˜¯å³è¾¹ç•Œ,æ¯”å¦‚è¯´å¯¹äºmidçš„å·¦ä¾§æœ‰åº(æ»¡è¶³nums[l]&lt;=nums[mid])åˆ™åˆ¤æ–­targetæ˜¯å¦è½åœ¨è¿™ä¸ªæœ‰åºåŒºé—´ä¸­,å¦‚æœæ˜¯åˆ™æ”¶ç¼©å³è¾¹ç•Œ,å¦åˆ™æ”¶ç¼©å·¦è¾¹ç•Œ,å…¶ä»–æƒ…å†µåŒç†.\n// [33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„](https://leetcode-cn.com/problems/search-in-rotated-sorted-array/)func search(nums []int, target int) int &#123;\tl, r := 0, len(nums)-1\tfor l &lt; r &#123;\t\tmid := l + (r-l)/2\t\tif nums[mid]==target &#123;\t\t\treturn mid\t\t&#125;\t\tif nums[l]&lt;=nums[mid] &#123;\t\t\tif target&lt;nums[mid]&amp;&amp;target&gt;=nums[l] &#123;\t\t\t\tr = mid-1\t\t\t&#125;else &#123;\t\t\t\tl = mid+1\t\t\t&#125;\t\t&#125;else &#123;\t\t\tif nums[mid]&lt;target&amp;&amp;target&lt;=nums[r]&#123;\t\t\t\tl = mid+1\t\t\t&#125;else &#123;\t\t\t\tr = mid-1\t\t\t&#125;\t\t&#125;\t&#125;\tif target!=nums[l] &#123;\t\treturn -1\t&#125;\treturn l&#125;\n\næ‰¾æœ€å°å€¼ä¸æ‰¾ç›®æ ‡å€¼ä¸åŒ,æ‰¾æœ€å°å€¼æˆ‘ä»¬åº”è¯¥å°†æ•°ç»„çœ‹ä½œä¸ºå±±,æ²¿ç€ä¸‹å¡çš„æ–¹å‘è¿›è¡Œç§»åŠ¨,å¯¹äºä¸€ä¸ªmid,å¦‚æœå·¦ä¾§æœ‰åº,å·¦ä¾§å’Œå³ä¾§éƒ½å¯èƒ½æ˜¯æœ€å°å€¼å­˜åœ¨çš„åŒºé—´,å› æ­¤æˆ‘ä»¬åº”è¯¥é€šè¿‡åˆ¤æ–­å³ä¾§æ˜¯å¦æœ‰åº,å¦‚æœæœ‰åº,åˆ™å½“å‰midåŠå·¦ä¾§ä¸ºæœ€å°å€¼å­˜åœ¨çš„åŒºé—´,å› æ­¤æ”¶ç¼©å³è¾¹ç•Œå³å¯.åä¹‹å½“å‰midåŠå·¦ä¾§å¿…å®šä¸å¯èƒ½ä¸ºæœ€å°å€¼å­˜åœ¨çš„åŒºé—´.\n// [153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/)func findMin(nums []int) int &#123;    l, r := 0, len(nums)-1    for l &lt; r &#123;        mid := l + (r-l)/2        if nums[mid]&lt;nums[r] &#123;            r = mid        &#125; else &#123;            l = mid+1        &#125;    &#125;    return nums[l]&#125;\n\nå…ƒç´ å¯é‡å¤æ‰¾ç›®æ ‡å€¼åœ¨ä¸å¯é‡å¤çš„åŸºç¡€ä¸Šåªéœ€è¦å¤šåˆ¤æ–­ä¸€ä¸‹mid, l, rä¸‰è€…ä½ç½®çš„å€¼æ˜¯ä¸æ˜¯ä¸€æ ·, å½“ä¸€æ ·çš„æ—¶å€™æ— æ³•åˆ¤æ–­æ”¶ç¼©å·¦ä¾§è¿˜æ˜¯å³ä¾§, ä½†æ˜¯å¯ä»¥ç¡®å®šl, rä¸¤ä¸ªä½ç½®è‚¯å®šä¸æ˜¯target, å› æ­¤ç›´æ¥å·¦ç§»lå’Œå³ç§»rå³å¯\n// [81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II](https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/)func search(nums []int, target int) bool &#123;    l, r := 0, len(nums)-1    for l &lt; r &#123;        mid := l + (r-l)/2        if nums[mid]==target &#123;            return true        &#125;        if nums[mid]==nums[l]&amp;&amp;nums[mid]==nums[r] &#123;            l++            r--        &#125;else if nums[l]&lt;=nums[mid] &#123;            if nums[l]&lt;=target &amp;&amp; target &lt; nums[mid] &#123;                r = mid-1            &#125;else&#123;                l = mid+1            &#125;        &#125;else &#123;            if nums[mid]&lt;target&amp;&amp;target&lt;=nums[r] &#123;                l = mid+1            &#125;else &#123;                r = mid-1            &#125;        &#125;    &#125;    return nums[l]==target&#125;\n\næ‰¾æœ€å°å€¼å’Œæ‰¾ç›®æ ‡å€¼ç±»ä¼¼,åœ¨ä¸å¯é‡å¤çš„åŸºç¡€,åŠ ä¸€ä¸ªmid, l, rä¸‰è€…çš„åˆ¤æ–­å³å¯.\n// [154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/)func findMin(nums []int) int &#123;    l, r := 0, len(nums)-1    for l &lt; r &#123;        mid := l + (r-l)/2        if nums[l]==nums[mid]&amp;&amp;nums[r]==nums[mid]&#123;            l++            r--        &#125;else if nums[mid]&lt;=nums[r]&#123;            r = mid        &#125;else &#123;            l = mid+1        &#125;    &#125;    return nums[l]&#125;","categories":["ç®—æ³•"],"tags":["algorithm","leetcode","binary search"]},{"title":"ä¸¤ç§ç¿»è½¬sliceçš„æ–¹å¼å¯¹æ¯”","url":"/2021/04/16/two-way-to-reverse-slice/","content":"åˆ·é¢˜æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼šå¯¹ä¸€ä¸ªsliceè¿›è¡Œç¿»è½¬ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä½¿ç”¨äº†ä¸¤ç§æ–¹å¼ï¼š\n\næ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œä½¿ç”¨appendå·¦æ’å…¥çš„æ–¹å¼\nå…ˆæ­£å¸¸appendå³æ’å…¥ï¼Œæœ€åå†å¯¹è¿™ä¸ªsliceè¿›è¡Œç¿»è½¬\n\n\n\nä¸¤ç§æ–¹å¼çš„å®ç°åŠæ—¶é—´å’Œç©ºé—´æ¶ˆè€—çš„å¯¹æ¯”å®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å®ç°çš„åŠŸèƒ½æ˜¯ä¸€è‡´çš„\n\næ–¹æ³•1ä½¿ç”¨å·¦æ’å…¥æ³•æ¥å®ç°ç¿»è½¬ï¼Œå¦‚ä¸‹æ‰€ç¤º\nfunc method1() &#123;    result := make([][]int, 0)    for i := 0; i &lt; 100; i++ &#123;        item := make([]int, 0)        for j := 0; j &lt; 10; j++ &#123;            item = append(item, i*j)        &#125;        // å·¦æ’å…¥        join := [][]int&#123;item&#125;        result = append(join, result...)    &#125;&#125;\næ–¹æ³•2å…ˆæ­£å¸¸appendï¼Œå†ç¿»è½¬\nfunc method2() &#123;    result := make([][]int, 0)    for i := 0; i &lt; 100; i++ &#123;        item := make([]int, 0)        for j := 0; j &lt; 10; j++ &#123;            item = append(item, i*j)        &#125;        result = append(result, item)    &#125;    tmp := result    result = make([][]int, 0)    for i := len(tmp) - 1; i &gt;= 0; i-- &#123;        result = append(result, tmp[i])    &#125;&#125;\n\næ€§èƒ½å¯¹æ¯”\næ—¶é—´\ngoos: darwingoarch: amd64BenchmarkMethod1-4         17006             69558 ns/opBenchmarkMethod2-4         43002             27851 ns/op\næ—¶é—´ä¸Šï¼Œæ–¹æ³•2è¦å¥½äºæ–¹æ³•1\n\nç©ºé—´\n\n\n\nç©ºé—´ä¸Šï¼Œæ–¹æ³•2ä¹Ÿè¦ä¼˜äºæ–¹æ³•1\nåˆ†æé€šè¿‡pprofå·¥å…·å¯¹å…¶æºç è¿›è¡Œåˆ†æå¦‚ä¸‹\nä»ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼Œresult = append(join, result...)è¯­å¥çš„å†…å­˜æ¶ˆè€—éå¸¸ä¸¥é‡ï¼ŒåŒæ—¶è¿™ç§æ–¹æ³•è¿›è¡Œappendï¼Œä¼šä½¿å¾—åœ°å€é‡æ–°åˆ†é…ï¼ˆå› ä¸ºé¦–åœ°å€æ”¹å˜äº†ï¼‰è‡´ä½¿å¤šä½™å†…å­˜å’Œæ—¶é—´çš„æ¶ˆè€—ã€‚\nè¡¥å……æ–¹æ³•2çš„ç¿»è½¬å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•å®ç°\n\nå¦‚ä¸Šé¢æ‰€ç¤ºï¼Œé€šè¿‡sliceåå‘éå†æ’å…¥å®Œæˆç¿»è½¬\nè¿˜å¯ä»¥é€šè¿‡åŒæŒ‡é’ˆæ³•æ¥ç¿»è½¬\n\nè¿™é‡Œé€šè¿‡ä¸€ä¸ªç®€å•ä¾‹å­æ¯”è¾ƒä¸‹åŒæ–¹çš„æ€§èƒ½\nfunc method1() &#123;    var input = make([]int, 0, 100)    for i := 0; i &lt; len(input); i++ &#123;        input = append(input, i)    &#125;    // method1    for i := 0; i &lt; len(input)/2; i++ &#123;        j := len(input) - 1 - i        input[i], input[j] = input[j], input[i]    &#125;&#125;func method2() &#123;    var input = make([]int, 0, 100)    for i := 0; i &lt; len(input); i++ &#123;        input = append(input, i)    &#125;    // method2    tmp := input    input = make([]int, 0, 100)    for i := len(tmp) - 1; i &gt;= 0; i-- &#123;        input = append(input, tmp[i])    &#125;&#125;\nç»“æœè¡¨ç¤ºï¼ŒåŒæŒ‡é’ˆæ³•ä¼šæ›´å¥½ä¸€äº›ï¼Œç†ç”±å¾ˆç®€å•ï¼Œå› ä¸ºåŒæŒ‡é’ˆæ˜¯O(N/2)çš„\n$ go test -run=. -bench=. -benchmemgoos: darwingoarch: amd64BenchmarkMethod1-4      71840024                16.9 ns/op             0 B/op          0 allocs/opBenchmarkMethod2-4      26362216                39.7 ns/op             0 B/op          0 allocs/opPASS\n\n\nç»“è®ºè¿™ç§æƒ…å†µä¸‹æ¨èä½¿ç”¨æ–¹æ³•2ï¼ŒåŒæ—¶å¯¹äºæ–¹æ³•1(å·¦æ’å…¥)çš„ä½¿ç”¨è¦æ ¼å¤–è°¨æ…ï¼Œä¸å½“çš„ä½¿ç”¨ä¼šä½¿å¾—ç¨‹åºçš„æ—¶/ç©ºé—´æ¶ˆè€—åŠ å‰§ã€‚\n\nå¦‚æœæœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…å¯¹ä¸Šè¿°ç¨‹åºæœ‰æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿ä¸‹æ–¹è¯„è®º~\n\n","categories":["Golang"],"tags":["go"]},{"title":"unexpected error in pytorch backward","url":"/2022/05/18/unexpected-error-in-pytorch-backward/","content":"åœ¨å†™æ¨¡å‹è®­ç»ƒçš„æ—¶å€™é‡åˆ°å¥‡æ€ªçš„æŠ¥é”™:\nRuntimeError: Trying to backward through the graph a second time, but the saved intermediate results have already been freed. Specify retain_graph=True when calling backward the first time.\nå‚è€ƒä¸€äº›ç½‘ä¸Šçš„è§£ç­”å’ŒæŠ¥é”™æç¤º,æ„æ€å°±æ˜¯æ‰§è¡Œbackwardçš„æ—¶å€™,ä¸­é—´ç»“æœå·²ç»è¢«é‡Šæ”¾äº†.ä¸€å¼€å§‹æ¯”è¾ƒçº³é—·åœ¨äº,æˆ‘ä»…ä»…å¢åŠ äº†ä¸€äº›å·ç§¯å±‚å’Œæ“ä½œåœ¨trainæ–¹æ³•é‡Œé¢,æ€ä¹ˆçªç„¶å°±ä¼šè¿›è¡Œè¯¥æŠ¥é”™å‘¢,å¹¶ä¸”ä¸­é—´ç»“æœéƒ½æ˜¯åœ¨trainæ–¹æ³•ä¸­,ä¸ä¼šå‡ºç°backwardçš„æ—¶å€™å·²ç»è¢«é‡Šæ”¾.\nç»è¿‡ä»”ç»†å®¡æŸ¥,æœ‰ä¸ªåœ°æ–¹å­˜åœ¨æ¯”è¾ƒå¤§çš„é—®é¢˜, åœ¨æˆ‘çš„ä»£ç å‡ºæœ‰è¿™æ ·ä¸€ä¸ªé€»è¾‘\nfor j, batch in enumerate(loader, 1):    self.optimizer.zero_grad()    # pre-handle some thing    for i in range(1, len(images)):        s = self.model(images[i])        y = label[i]        acc = self.compute_accuracy(s.detach(), y)        loss = self.compute_loss(s, y)        loss.backward()    self.optimizer.step()\nä¸Šé¢è¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡å•¥é—®é¢˜, ä½†æ˜¯æ³¨æ„å¦‚æœpre-handleéƒ¨åˆ†å­˜åœ¨æœ‰è®¡ç®—å›¾çš„æ¢¯åº¦è®¡ç®—, è¿™ä¸€éƒ¨åˆ†ä¸­é—´ç»“æœåœ¨loss.backwardçš„æ—¶å€™å°±å·²ç»freeæ‰äº†,ç”±æ­¤ä¼šå¯¼è‡´ä¸€å¼€å§‹çš„é‚£ä¸ªæŠ¥é”™,è€Œæˆ‘æ­£å¥½åœ¨è¿™ä¸€éƒ¨åˆ†ä½œäº†ä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„æ“ä½œ:\nfor j, batch in enumerate(loader, 1):    self.optimizer.zero_grad()    # pre-handle some thing    # warning: æ³¨æ„è¿™ä¸€æ­¥    self.prev_ft = self.feature_extractor(images[0])    for i in range(1, len(images)):        s = self.model(images[i])        y = label[i]        acc = self.compute_accuracy(s.detach(), y)        loss = self.compute_loss(s, y)        loss.backward()    self.optimizer.step()\nä¸Šè¿°ä½¿ç”¨feature_extractoræŠ½å–images[0]çš„ç‰¹å¾, å› ä¸ºä¸æ˜¯å¤„äºtorch.no_grad()çš„wrapç¯å¢ƒä¸‹,å› æ­¤ä¼šè¿›è¡Œæ¢¯åº¦è®¡ç®—. è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•, å°†pre-handleçš„éƒ¨åˆ†ç”¨torch.no_grad()åŒ…æ‹¬èµ·æ¥å³å¯.\nfor j, batch in enumerate(loader, 1):    self.optimizer.zero_grad()    # pre-handle some thing    with torch.no_grad():        self.prev_ft = self.feature_extractor(images[0])    for i in range(1, len(images)):        s = self.model(images[i])        y = label[i]        acc = self.compute_accuracy(s.detach(), y)        loss = self.compute_loss(s, y)        loss.backward()    self.optimizer.step()\n","categories":["pytorch"],"tags":["pytorch","python"]}]